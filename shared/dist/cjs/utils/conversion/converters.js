"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./errors.js");const r={pdf:{name:"PDF Document",extensions:[".pdf"],mimeTypes:["application/pdf"],maxSize:104857600},docx:{name:"Word Document",extensions:[".docx",".doc"],mimeTypes:["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"],maxSize:52428800},pptx:{name:"PowerPoint Presentation",extensions:[".pptx",".ppt"],mimeTypes:["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint"],maxSize:52428800},xlsx:{name:"Excel Spreadsheet",extensions:[".xlsx",".xls"],mimeTypes:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],maxSize:52428800},csv:{name:"CSV Spreadsheet",extensions:[".csv"],mimeTypes:["text/csv","application/csv","text/comma-separated-values","application/vnd.ms-excel"],maxSize:52428800},url:{name:"Web Page",extensions:[".url",".html",".htm"],mimeTypes:["text/html","application/x-url"],maxSize:10485760},parenturl:{name:"Website",extensions:[".url",".html",".htm"],mimeTypes:["text/html","application/x-url"],maxSize:10485760},mp3:{name:"MP3 Audio",extensions:[".mp3"],mimeTypes:["audio/mpeg"],maxSize:524288e3},wav:{name:"WAV Audio",extensions:[".wav"],mimeTypes:["audio/wav","audio/x-wav"],maxSize:524288e3},mp4:{name:"MP4 Video",extensions:[".mp4"],mimeTypes:["video/mp4"],maxSize:1073741824},webm:{name:"WebM Video",extensions:[".webm"],mimeTypes:["video/webm"],maxSize:1073741824}};function t(e){try{if(["url","parenturl"].includes(e.toLowerCase()))return{type:e.toLowerCase(),config:r[e.toLowerCase()]};const t=e.startsWith(".")?e.toLowerCase():`.${e.toLowerCase()}`,[o,n]=Object.entries(r).find((([e,r])=>r?.extensions?.includes(t)))||[];return n?{type:o,config:n}:(console.warn(`No converter found for extension: ${e}`),null)}catch(r){return console.error(`Error in getConverterByExtension for ${e}:`,r),null}}function o(e){try{const t=e.toLowerCase(),[o,n]=Object.entries(r).find((([e,r])=>r.mimeTypes.includes(t)))||[];return n?{type:o,config:n}:(console.warn(`No converter found for MIME type: ${e}`),null)}catch(r){return console.error(`Error in getConverterByMimeType for ${e}:`,r),null}}function n(){return Object.values(r).flatMap((e=>e.extensions))}function s(){return Object.values(r).flatMap((e=>e.mimeTypes))}function i(e,r){if(!r||Buffer.isBuffer(r)&&0===r.length||"string"==typeof r&&""===r.trim())return!1;switch(e.toLowerCase()){case"url":case"parenturl":return"string"==typeof r&&r.length>0;case"pdf":return!!Buffer.isBuffer(r)&&(r.length>4&&"%PDF"===r.toString("ascii",0,4));case"docx":case"xlsx":case"pptx":case"mp3":case"wav":case"mp4":case"webm":return Buffer.isBuffer(r)&&r.length>0;case"csv":return(Buffer.isBuffer(r)||"string"==typeof r)&&r.length>0;default:return!0}}const a={convert:async(r,t,o,n={})=>{throw new e.ConversionError("Convert method not implemented",e.ERROR_TYPES.CONVERSION_ERROR)},validate:e=>!1,config:{name:"Base Converter",extensions:[],mimeTypes:[],maxSize:0}},c={};async function p(r,t,o={}){const n=r.toLowerCase().replace(/^\./,"");if(!i(n,t))throw new e.ConversionError(`Invalid content for ${n} conversion`,e.ERROR_TYPES.INVALID_FILE_TYPE,{type:n});const s=c[n];if(!s)throw new e.ConversionError(`No converter registered for type: ${n}`,e.ERROR_TYPES.CONVERSION_ERROR,{type:n});try{if(["mp3","wav","ogg","flac"].includes(n)&&"function"==typeof s){const e=new s;return await e.convertToMarkdown(t,{name:o.name,apiKey:o.apiKey,onProgress:o.onProgress})}if(["mp4","webm","avi","mov"].includes(n)&&"function"==typeof s){const e=new s;return await e.convertToMarkdown(t,{name:o.name,apiKey:o.apiKey,onProgress:o.onProgress})}if("url"===n||"parenturl"===n){if(s.convertToMarkdown)return await s.convertToMarkdown(t,o);if(s.convert)return await s.convert(t,o)}if(s.convert)return await s.convert(t,o.name,o.apiKey,o);const r=c.textFactory;if(r&&r.convertToMarkdown)return await r.convertToMarkdown(n,t,{name:o.name,apiKey:o.apiKey,mimeType:o.mimeType,...o});throw new e.ConversionError(`Converter for ${n} does not implement required methods`,e.ERROR_TYPES.CONVERSION_ERROR,{type:n})}catch(r){if(r instanceof e.ConversionError)throw r;throw new e.ConversionError(`Conversion failed: ${r.message}`,e.ERROR_TYPES.CONVERSION_ERROR,{originalError:r.message,type:n})}}var m={FILE_CONVERTERS:r,getConverterByExtension:t,getConverterByMimeType:o,getSupportedExtensions:n,getSupportedMimeTypes:s,validateContent:i,convertToMarkdown:p};exports.ConverterInterface=a,exports.FILE_CONVERTERS=r,exports.backendConverters=c,exports.convertToMarkdown=p,exports.default=m,exports.getConverterByExtension=t,exports.getConverterByMimeType=o,exports.getSupportedExtensions=n,exports.getSupportedMimeTypes=s,exports.registerConverter=function(e,r){if(!e||"string"!=typeof e)throw new Error("Converter type must be a string");if(!r||"object"!=typeof r)throw new Error("Converter must be an object");return c[e]=r,console.log(`✅ Registered converter for ${e}`),!0},exports.registerConverterFactory=function(e,r){if(!e||"string"!=typeof e)throw new Error("Factory name must be a string");if(!r||"object"!=typeof r)throw new Error("Factory must be an object");return c[e]=r,console.log(`✅ Registered converter factory: ${e}`),r.converters&&Object.entries(r.converters).forEach((([e,r])=>{c[e]=r,console.log(`✅ Registered converter from factory: ${e}`)})),!0},exports.validateContent=i;
