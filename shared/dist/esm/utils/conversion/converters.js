import{ConversionError as e,ERROR_TYPES as n}from"./errors.js";const o={pdf:{name:"PDF Document",extensions:[".pdf"],mimeTypes:["application/pdf"],maxSize:104857600},docx:{name:"Word Document",extensions:[".docx",".doc"],mimeTypes:["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"],maxSize:52428800},pptx:{name:"PowerPoint Presentation",extensions:[".pptx",".ppt"],mimeTypes:["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint"],maxSize:52428800},xlsx:{name:"Excel Spreadsheet",extensions:[".xlsx",".xls"],mimeTypes:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],maxSize:52428800},csv:{name:"CSV Spreadsheet",extensions:[".csv"],mimeTypes:["text/csv","application/csv","text/comma-separated-values","application/vnd.ms-excel"],maxSize:52428800},url:{name:"Web Page",extensions:[".url",".html",".htm"],mimeTypes:["text/html","application/x-url"],maxSize:10485760},parenturl:{name:"Website",extensions:[".url",".html",".htm"],mimeTypes:["text/html","application/x-url"],maxSize:10485760},mp3:{name:"MP3 Audio",extensions:[".mp3"],mimeTypes:["audio/mpeg"],maxSize:524288e3},wav:{name:"WAV Audio",extensions:[".wav"],mimeTypes:["audio/wav","audio/x-wav"],maxSize:524288e3},mp4:{name:"MP4 Video",extensions:[".mp4"],mimeTypes:["video/mp4"],maxSize:1073741824},webm:{name:"WebM Video",extensions:[".webm"],mimeTypes:["video/webm"],maxSize:1073741824}};function t(e){try{if(["url","parenturl"].includes(e.toLowerCase()))return{type:e.toLowerCase(),config:o[e.toLowerCase()]};const n=e.startsWith(".")?e.toLowerCase():`.${e.toLowerCase()}`,[t,r]=Object.entries(o).find((([e,o])=>o?.extensions?.includes(n)))||[];return r?{type:t,config:r}:(console.warn(`No converter found for extension: ${e}`),null)}catch(n){return console.error(`Error in getConverterByExtension for ${e}:`,n),null}}function r(e){try{const n=e.toLowerCase(),[t,r]=Object.entries(o).find((([e,o])=>o.mimeTypes.includes(n)))||[];return r?{type:t,config:r}:(console.warn(`No converter found for MIME type: ${e}`),null)}catch(n){return console.error(`Error in getConverterByMimeType for ${e}:`,n),null}}function i(){return Object.values(o).flatMap((e=>e.extensions))}function a(){return Object.values(o).flatMap((e=>e.mimeTypes))}function s(e,n){if(!n||Buffer.isBuffer(n)&&0===n.length||"string"==typeof n&&""===n.trim())return!1;switch(e.toLowerCase()){case"url":case"parenturl":return"string"==typeof n&&n.length>0;case"pdf":return!!Buffer.isBuffer(n)&&(n.length>4&&"%PDF"===n.toString("ascii",0,4));case"docx":case"xlsx":case"pptx":case"mp3":case"wav":case"mp4":case"webm":return Buffer.isBuffer(n)&&n.length>0;case"csv":return(Buffer.isBuffer(n)||"string"==typeof n)&&n.length>0;default:return!0}}const c={convert:async(o,t,r,i={})=>{throw new e("Convert method not implemented",n.CONVERSION_ERROR)},validate:e=>!1,config:{name:"Base Converter",extensions:[],mimeTypes:[],maxSize:0}},m={};function p(e,n){if(!e||"string"!=typeof e)throw new Error("Converter type must be a string");if(!n)throw new Error("Converter cannot be null or undefined");return m[e]=n,console.log(`âœ… Registered converter for ${e}`),!0}function f(e,n){if(!e||"string"!=typeof e)throw new Error("Factory name must be a string");if(!n)throw new Error("Factory cannot be null or undefined");return m[e]=n,console.log(`âœ… Registered converter factory: ${e}`),n.converters&&Object.entries(n.converters).forEach((([e,n])=>{m[e]=n,console.log(`âœ… Registered converter from factory: ${e}`)})),!0}async function l(o,t,r={}){const i=o.toLowerCase().replace(/^\./,"");if(!s(i,t))throw new e(`Invalid content for ${i} conversion`,n.INVALID_FILE_TYPE,{type:i});const a=m[i];if(!a)throw new e(`No converter registered for type: ${i}`,n.CONVERSION_ERROR,{type:i});try{if(["mp3","wav","ogg","flac"].includes(i)&&"function"==typeof a){const e=new a;return await e.convertToMarkdown(t,{name:r.name,apiKey:r.apiKey,onProgress:r.onProgress})}if(["mp4","webm","avi","mov"].includes(i)&&"function"==typeof a){const e=new a;return await e.convertToMarkdown(t,{name:r.name,apiKey:r.apiKey,onProgress:r.onProgress})}if("url"===i||"parenturl"===i){if(a.convertToMarkdown)return await a.convertToMarkdown(t,r);if(a.convert)return await a.convert(t,r)}if("pdf"===i&&(console.log("ðŸ”„ [convertToMarkdown] Converting PDF with options:",{useOcr:r.useOcr,hasMistralApiKey:!!r.mistralApiKey}),a.convertPdfToMarkdown)){const e={useOcr:!0===r.useOcr,mistralApiKey:r.mistralApiKey,preservePageInfo:!0};return console.log(`PDF conversion using OCR: ${e.useOcr}, API key available: ${!!e.mistralApiKey}`),await a.convertPdfToMarkdown(t,r.name,e)}if(["csv","xlsx"].includes(i)){if(console.log(`ðŸ”„ [convertToMarkdown] Converting data file (${i}) with options:`,{name:r.name,contentType:"string"==typeof t?"string":Buffer.isBuffer(t)?"buffer":typeof t}),a.convertToMarkdown)return await a.convertToMarkdown(t,r.name,r.apiKey);if(a.convert)return await a.convert(t,r.name,r.apiKey,r)}if(a.convert)return await a.convert(t,r.name,r.apiKey,r);if(a.convertToMarkdown)return await a.convertToMarkdown(t,r);const o=m.textFactory;if(o&&o.convertToMarkdown)return await o.convertToMarkdown(i,t,{name:r.name,apiKey:r.apiKey,mimeType:r.mimeType,...r});throw new e(`Converter for ${i} does not implement required methods`,n.CONVERSION_ERROR,{type:i})}catch(o){if(o instanceof e)throw o;throw new e(`Conversion failed: ${o.message}`,n.CONVERSION_ERROR,{originalError:o.message,type:i})}}var u={FILE_CONVERTERS:o,getConverterByExtension:t,getConverterByMimeType:r,getSupportedExtensions:i,getSupportedMimeTypes:a,validateContent:s,convertToMarkdown:l};export{c as ConverterInterface,o as FILE_CONVERTERS,m as backendConverters,l as convertToMarkdown,u as default,t as getConverterByExtension,r as getConverterByMimeType,i as getSupportedExtensions,a as getSupportedMimeTypes,p as registerConverter,f as registerConverterFactory,s as validateContent};
