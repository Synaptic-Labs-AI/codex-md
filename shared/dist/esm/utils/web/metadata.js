import t from"cheerio";let e;async function r(r){try{e||(e=await import("node-fetch"));const n=e.default,a=await n(r);if(!a.ok)throw new Error(`Failed to fetch URL: ${a.status}`);const o=await a.text(),c=t.load(o),i={title:"",description:"",author:"",date:"",source:r,site:"",captured:(new Date).toISOString()};i.title=c('meta[property="og:title"]').attr("content")||c('meta[name="twitter:title"]').attr("content")||c("title").text()||new URL(r).hostname,i.description=c('meta[property="og:description"]').attr("content")||c('meta[name="description"]').attr("content")||c('meta[name="twitter:description"]').attr("content")||"",i.author=c('meta[name="author"]').attr("content")||c('meta[property="article:author"]').attr("content")||"",i.date=c('meta[property="article:published_time"]').attr("content")||c('meta[name="publication_date"]').attr("content")||"",i.site=c('meta[property="og:site_name"]').attr("content")||new URL(r).hostname,i.images=[c('meta[property="og:image"]').attr("content"),c('meta[name="twitter:image"]').attr("content")].filter(Boolean);const s=c('meta[name="keywords"]').attr("content");return s&&(i.keywords=s.split(",").map((t=>t.trim()))),function(t){const e={};return Object.entries(t).forEach((([t,r])=>{if("string"==typeof r){const n=r.trim();n&&(e[t]=n)}else Array.isArray(r)?r.length>0&&(e[t]=r.filter(Boolean)):null!=r&&(e[t]=r)})),e}(i)}catch(t){return console.error("Metadata extraction error:",t),{title:new URL(r).hostname,source:r,captured:(new Date).toISOString()}}}function n(e){try{const r=t.load(e);r("script, style, meta, link, noscript").remove();let n=r("article").text()||r("main").text();return n||(n=r(".content, .post-content, .entry-content").text()),n||(n=r("body").text()),n.replace(/\s+/g," ").replace(/\n+/g,"\n\n").trim()}catch(t){return console.error("Content extraction error:",t),""}}async function a(e,r){try{const n=t.load(e),a=[],o=new Set;return n("a[href]").each(((t,e)=>{const c=n(e),i=c.attr("href");if(i)try{const t=new URL(i,r).href;!o.has(t)&&t.match(/^https?:\/\//)&&(o.add(t),a.push({url:t,text:c.text().trim()}))}catch(t){}})),a}catch(t){return console.error("Link extraction error:",t),[]}}var o={extractMetadata:r,extractContent:n,extractLinks:a};export{o as default,n as extractContent,a as extractLinks,r as extractMetadata};
