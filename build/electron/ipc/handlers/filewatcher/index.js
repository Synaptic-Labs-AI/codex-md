"use strict";

/**
 * File Watcher IPC Handlers
 * Implements handlers for file watching operations.
 * 
 * These handlers expose the FileWatcherService functionality to the
 * renderer process through secure IPC channels. They manage file watching,
 * lock management, and event notifications.
 * 
 * Related files:
 * - services/FileWatcherService.js: Core file watching functionality
 * - ipc/types.js: TypeScript definitions
 */

const {
  ipcMain,
  BrowserWindow
} = require('electron');
const {
  IPCChannels
} = require('../../types');
const FileWatcherService = require('../../../services/FileWatcherService');

// Store event listeners by window ID
const windowListeners = new Map();

/**
 * Registers all file watcher IPC handlers
 */
function registerFileWatcherHandlers() {
  // Start watching files/directories
  ipcMain.handle(IPCChannels.WATCH_START, async (event, request) => {
    if (!request?.paths) {
      return {
        success: false,
        error: 'Invalid request: paths is required'
      };
    }
    const result = await FileWatcherService.watch(request.paths, request.options || {});

    // Set up event forwarding for this window if successful
    if (result.success) {
      setupEventForwarding(event.sender, result.watchId);
    }
    return result;
  });

  // Stop watching files/directories
  ipcMain.handle(IPCChannels.WATCH_STOP, async (event, request) => {
    if (!request?.watchId) {
      return {
        success: false,
        error: 'Invalid request: watchId is required'
      };
    }
    const result = await FileWatcherService.unwatch(request.watchId);

    // Remove event forwarding for this window if successful
    if (result.success) {
      removeEventForwarding(event.sender, request.watchId);
    }
    return result;
  });

  // Acquire a file lock
  ipcMain.handle('codex:watch:lock', async (event, request) => {
    if (!request?.path) {
      return {
        success: false,
        error: 'Invalid request: path is required'
      };
    }
    return await FileWatcherService.acquireLock(request.path, request.options || {});
  });

  // Release a file lock
  ipcMain.handle('codex:watch:unlock', async (event, request) => {
    if (!request?.path) {
      return {
        success: false,
        error: 'Invalid request: path is required'
      };
    }
    return await FileWatcherService.releaseLock(request.path);
  });

  // Check if a file is locked
  ipcMain.handle('codex:watch:is-locked', async (event, request) => {
    if (!request?.path) {
      return {
        success: false,
        error: 'Invalid request: path is required'
      };
    }
    return await FileWatcherService.isLocked(request.path);
  });
}

/**
 * Set up event forwarding from FileWatcherService to a renderer window
 * @private
 * @param {Electron.WebContents} sender - Renderer web contents
 * @param {string} watchId - Watch ID
 */
function setupEventForwarding(sender, watchId) {
  const windowId = getWindowIdFromSender(sender);
  if (!windowId) return;

  // Create a listener for this window if it doesn't exist
  if (!windowListeners.has(windowId)) {
    windowListeners.set(windowId, new Map());
  }

  // Don't add duplicate listeners
  const windowWatchers = windowListeners.get(windowId);
  if (windowWatchers.has(watchId)) return;

  // Create event listener
  const listener = eventData => {
    if (sender.isDestroyed()) {
      // Clean up if window is destroyed
      removeEventForwarding(sender, watchId);
      return;
    }

    // Forward event to renderer
    sender.send(IPCChannels.WATCH_EVENT, eventData);
  };

  // Store listener reference
  windowWatchers.set(watchId, listener);

  // Add listener to service
  FileWatcherService.addListener(listener);
}

/**
 * Remove event forwarding for a renderer window
 * @private
 * @param {Electron.WebContents} sender - Renderer web contents
 * @param {string} watchId - Watch ID
 */
function removeEventForwarding(sender, watchId) {
  const windowId = getWindowIdFromSender(sender);
  if (!windowId) return;

  // Check if we have listeners for this window
  if (!windowListeners.has(windowId)) return;
  const windowWatchers = windowListeners.get(windowId);

  // Check if we have a listener for this watch ID
  if (!windowWatchers.has(watchId)) return;

  // Get listener
  const listener = windowWatchers.get(watchId);

  // Remove listener from service
  FileWatcherService.removeListener(listener);

  // Remove listener reference
  windowWatchers.delete(watchId);

  // Clean up window entry if no more watchers
  if (windowWatchers.size === 0) {
    windowListeners.delete(windowId);
  }
}

/**
 * Get window ID from sender
 * @private
 * @param {Electron.WebContents} sender - Renderer web contents
 * @returns {number|null} Window ID or null if not found
 */
function getWindowIdFromSender(sender) {
  const allWindows = BrowserWindow.getAllWindows();
  for (const window of allWindows) {
    if (window.webContents === sender) {
      return window.id;
    }
  }
  return null;
}

/**
 * Clean up all watchers when app is quitting
 */
function cleanupFileWatchers() {
  return FileWatcherService.cleanup();
}
module.exports = {
  registerFileWatcherHandlers,
  cleanupFileWatchers
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpcGNNYWluIiwiQnJvd3NlcldpbmRvdyIsInJlcXVpcmUiLCJJUENDaGFubmVscyIsIkZpbGVXYXRjaGVyU2VydmljZSIsIndpbmRvd0xpc3RlbmVycyIsIk1hcCIsInJlZ2lzdGVyRmlsZVdhdGNoZXJIYW5kbGVycyIsImhhbmRsZSIsIldBVENIX1NUQVJUIiwiZXZlbnQiLCJyZXF1ZXN0IiwicGF0aHMiLCJzdWNjZXNzIiwiZXJyb3IiLCJyZXN1bHQiLCJ3YXRjaCIsIm9wdGlvbnMiLCJzZXR1cEV2ZW50Rm9yd2FyZGluZyIsInNlbmRlciIsIndhdGNoSWQiLCJXQVRDSF9TVE9QIiwidW53YXRjaCIsInJlbW92ZUV2ZW50Rm9yd2FyZGluZyIsInBhdGgiLCJhY3F1aXJlTG9jayIsInJlbGVhc2VMb2NrIiwiaXNMb2NrZWQiLCJ3aW5kb3dJZCIsImdldFdpbmRvd0lkRnJvbVNlbmRlciIsImhhcyIsInNldCIsIndpbmRvd1dhdGNoZXJzIiwiZ2V0IiwibGlzdGVuZXIiLCJldmVudERhdGEiLCJpc0Rlc3Ryb3llZCIsInNlbmQiLCJXQVRDSF9FVkVOVCIsImFkZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJkZWxldGUiLCJzaXplIiwiYWxsV2luZG93cyIsImdldEFsbFdpbmRvd3MiLCJ3aW5kb3ciLCJ3ZWJDb250ZW50cyIsImlkIiwiY2xlYW51cEZpbGVXYXRjaGVycyIsImNsZWFudXAiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2VsZWN0cm9uL2lwYy9oYW5kbGVycy9maWxld2F0Y2hlci9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRmlsZSBXYXRjaGVyIElQQyBIYW5kbGVyc1xyXG4gKiBJbXBsZW1lbnRzIGhhbmRsZXJzIGZvciBmaWxlIHdhdGNoaW5nIG9wZXJhdGlvbnMuXHJcbiAqIFxyXG4gKiBUaGVzZSBoYW5kbGVycyBleHBvc2UgdGhlIEZpbGVXYXRjaGVyU2VydmljZSBmdW5jdGlvbmFsaXR5IHRvIHRoZVxyXG4gKiByZW5kZXJlciBwcm9jZXNzIHRocm91Z2ggc2VjdXJlIElQQyBjaGFubmVscy4gVGhleSBtYW5hZ2UgZmlsZSB3YXRjaGluZyxcclxuICogbG9jayBtYW5hZ2VtZW50LCBhbmQgZXZlbnQgbm90aWZpY2F0aW9ucy5cclxuICogXHJcbiAqIFJlbGF0ZWQgZmlsZXM6XHJcbiAqIC0gc2VydmljZXMvRmlsZVdhdGNoZXJTZXJ2aWNlLmpzOiBDb3JlIGZpbGUgd2F0Y2hpbmcgZnVuY3Rpb25hbGl0eVxyXG4gKiAtIGlwYy90eXBlcy5qczogVHlwZVNjcmlwdCBkZWZpbml0aW9uc1xyXG4gKi9cclxuXHJcbmNvbnN0IHsgaXBjTWFpbiwgQnJvd3NlcldpbmRvdyB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTtcclxuY29uc3QgeyBJUENDaGFubmVscyB9ID0gcmVxdWlyZSgnLi4vLi4vdHlwZXMnKTtcclxuY29uc3QgRmlsZVdhdGNoZXJTZXJ2aWNlID0gcmVxdWlyZSgnLi4vLi4vLi4vc2VydmljZXMvRmlsZVdhdGNoZXJTZXJ2aWNlJyk7XHJcblxyXG4vLyBTdG9yZSBldmVudCBsaXN0ZW5lcnMgYnkgd2luZG93IElEXHJcbmNvbnN0IHdpbmRvd0xpc3RlbmVycyA9IG5ldyBNYXAoKTtcclxuXHJcbi8qKlxyXG4gKiBSZWdpc3RlcnMgYWxsIGZpbGUgd2F0Y2hlciBJUEMgaGFuZGxlcnNcclxuICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyRmlsZVdhdGNoZXJIYW5kbGVycygpIHtcclxuICAvLyBTdGFydCB3YXRjaGluZyBmaWxlcy9kaXJlY3Rvcmllc1xyXG4gIGlwY01haW4uaGFuZGxlKElQQ0NoYW5uZWxzLldBVENIX1NUQVJULCBhc3luYyAoZXZlbnQsIHJlcXVlc3QpID0+IHtcclxuICAgIGlmICghcmVxdWVzdD8ucGF0aHMpIHtcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgIGVycm9yOiAnSW52YWxpZCByZXF1ZXN0OiBwYXRocyBpcyByZXF1aXJlZCcgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRmlsZVdhdGNoZXJTZXJ2aWNlLndhdGNoKFxyXG4gICAgICByZXF1ZXN0LnBhdGhzLCBcclxuICAgICAgcmVxdWVzdC5vcHRpb25zIHx8IHt9XHJcbiAgICApO1xyXG5cclxuICAgIC8vIFNldCB1cCBldmVudCBmb3J3YXJkaW5nIGZvciB0aGlzIHdpbmRvdyBpZiBzdWNjZXNzZnVsXHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgc2V0dXBFdmVudEZvcndhcmRpbmcoZXZlbnQuc2VuZGVyLCByZXN1bHQud2F0Y2hJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9KTtcclxuXHJcbiAgLy8gU3RvcCB3YXRjaGluZyBmaWxlcy9kaXJlY3Rvcmllc1xyXG4gIGlwY01haW4uaGFuZGxlKElQQ0NoYW5uZWxzLldBVENIX1NUT1AsIGFzeW5jIChldmVudCwgcmVxdWVzdCkgPT4ge1xyXG4gICAgaWYgKCFyZXF1ZXN0Py53YXRjaElkKSB7XHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICBlcnJvcjogJ0ludmFsaWQgcmVxdWVzdDogd2F0Y2hJZCBpcyByZXF1aXJlZCcgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRmlsZVdhdGNoZXJTZXJ2aWNlLnVud2F0Y2gocmVxdWVzdC53YXRjaElkKTtcclxuICAgIFxyXG4gICAgLy8gUmVtb3ZlIGV2ZW50IGZvcndhcmRpbmcgZm9yIHRoaXMgd2luZG93IGlmIHN1Y2Nlc3NmdWxcclxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICByZW1vdmVFdmVudEZvcndhcmRpbmcoZXZlbnQuc2VuZGVyLCByZXF1ZXN0LndhdGNoSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfSk7XHJcblxyXG4gIC8vIEFjcXVpcmUgYSBmaWxlIGxvY2tcclxuICBpcGNNYWluLmhhbmRsZSgnY29kZXg6d2F0Y2g6bG9jaycsIGFzeW5jIChldmVudCwgcmVxdWVzdCkgPT4ge1xyXG4gICAgaWYgKCFyZXF1ZXN0Py5wYXRoKSB7XHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICBlcnJvcjogJ0ludmFsaWQgcmVxdWVzdDogcGF0aCBpcyByZXF1aXJlZCcgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF3YWl0IEZpbGVXYXRjaGVyU2VydmljZS5hY3F1aXJlTG9jayhcclxuICAgICAgcmVxdWVzdC5wYXRoLCBcclxuICAgICAgcmVxdWVzdC5vcHRpb25zIHx8IHt9XHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICAvLyBSZWxlYXNlIGEgZmlsZSBsb2NrXHJcbiAgaXBjTWFpbi5oYW5kbGUoJ2NvZGV4OndhdGNoOnVubG9jaycsIGFzeW5jIChldmVudCwgcmVxdWVzdCkgPT4ge1xyXG4gICAgaWYgKCFyZXF1ZXN0Py5wYXRoKSB7XHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICBlcnJvcjogJ0ludmFsaWQgcmVxdWVzdDogcGF0aCBpcyByZXF1aXJlZCcgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF3YWl0IEZpbGVXYXRjaGVyU2VydmljZS5yZWxlYXNlTG9jayhyZXF1ZXN0LnBhdGgpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBDaGVjayBpZiBhIGZpbGUgaXMgbG9ja2VkXHJcbiAgaXBjTWFpbi5oYW5kbGUoJ2NvZGV4OndhdGNoOmlzLWxvY2tlZCcsIGFzeW5jIChldmVudCwgcmVxdWVzdCkgPT4ge1xyXG4gICAgaWYgKCFyZXF1ZXN0Py5wYXRoKSB7XHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICBlcnJvcjogJ0ludmFsaWQgcmVxdWVzdDogcGF0aCBpcyByZXF1aXJlZCcgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF3YWl0IEZpbGVXYXRjaGVyU2VydmljZS5pc0xvY2tlZChyZXF1ZXN0LnBhdGgpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IHVwIGV2ZW50IGZvcndhcmRpbmcgZnJvbSBGaWxlV2F0Y2hlclNlcnZpY2UgdG8gYSByZW5kZXJlciB3aW5kb3dcclxuICogQHByaXZhdGVcclxuICogQHBhcmFtIHtFbGVjdHJvbi5XZWJDb250ZW50c30gc2VuZGVyIC0gUmVuZGVyZXIgd2ViIGNvbnRlbnRzXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB3YXRjaElkIC0gV2F0Y2ggSURcclxuICovXHJcbmZ1bmN0aW9uIHNldHVwRXZlbnRGb3J3YXJkaW5nKHNlbmRlciwgd2F0Y2hJZCkge1xyXG4gIGNvbnN0IHdpbmRvd0lkID0gZ2V0V2luZG93SWRGcm9tU2VuZGVyKHNlbmRlcik7XHJcbiAgaWYgKCF3aW5kb3dJZCkgcmV0dXJuO1xyXG5cclxuICAvLyBDcmVhdGUgYSBsaXN0ZW5lciBmb3IgdGhpcyB3aW5kb3cgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gIGlmICghd2luZG93TGlzdGVuZXJzLmhhcyh3aW5kb3dJZCkpIHtcclxuICAgIHdpbmRvd0xpc3RlbmVycy5zZXQod2luZG93SWQsIG5ldyBNYXAoKSk7XHJcbiAgfVxyXG5cclxuICAvLyBEb24ndCBhZGQgZHVwbGljYXRlIGxpc3RlbmVyc1xyXG4gIGNvbnN0IHdpbmRvd1dhdGNoZXJzID0gd2luZG93TGlzdGVuZXJzLmdldCh3aW5kb3dJZCk7XHJcbiAgaWYgKHdpbmRvd1dhdGNoZXJzLmhhcyh3YXRjaElkKSkgcmV0dXJuO1xyXG5cclxuICAvLyBDcmVhdGUgZXZlbnQgbGlzdGVuZXJcclxuICBjb25zdCBsaXN0ZW5lciA9IChldmVudERhdGEpID0+IHtcclxuICAgIGlmIChzZW5kZXIuaXNEZXN0cm95ZWQoKSkge1xyXG4gICAgICAvLyBDbGVhbiB1cCBpZiB3aW5kb3cgaXMgZGVzdHJveWVkXHJcbiAgICAgIHJlbW92ZUV2ZW50Rm9yd2FyZGluZyhzZW5kZXIsIHdhdGNoSWQpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9yd2FyZCBldmVudCB0byByZW5kZXJlclxyXG4gICAgc2VuZGVyLnNlbmQoSVBDQ2hhbm5lbHMuV0FUQ0hfRVZFTlQsIGV2ZW50RGF0YSk7XHJcbiAgfTtcclxuXHJcbiAgLy8gU3RvcmUgbGlzdGVuZXIgcmVmZXJlbmNlXHJcbiAgd2luZG93V2F0Y2hlcnMuc2V0KHdhdGNoSWQsIGxpc3RlbmVyKTtcclxuXHJcbiAgLy8gQWRkIGxpc3RlbmVyIHRvIHNlcnZpY2VcclxuICBGaWxlV2F0Y2hlclNlcnZpY2UuYWRkTGlzdGVuZXIobGlzdGVuZXIpO1xyXG59XHJcblxyXG4vKipcclxuICogUmVtb3ZlIGV2ZW50IGZvcndhcmRpbmcgZm9yIGEgcmVuZGVyZXIgd2luZG93XHJcbiAqIEBwcml2YXRlXHJcbiAqIEBwYXJhbSB7RWxlY3Ryb24uV2ViQ29udGVudHN9IHNlbmRlciAtIFJlbmRlcmVyIHdlYiBjb250ZW50c1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gd2F0Y2hJZCAtIFdhdGNoIElEXHJcbiAqL1xyXG5mdW5jdGlvbiByZW1vdmVFdmVudEZvcndhcmRpbmcoc2VuZGVyLCB3YXRjaElkKSB7XHJcbiAgY29uc3Qgd2luZG93SWQgPSBnZXRXaW5kb3dJZEZyb21TZW5kZXIoc2VuZGVyKTtcclxuICBpZiAoIXdpbmRvd0lkKSByZXR1cm47XHJcblxyXG4gIC8vIENoZWNrIGlmIHdlIGhhdmUgbGlzdGVuZXJzIGZvciB0aGlzIHdpbmRvd1xyXG4gIGlmICghd2luZG93TGlzdGVuZXJzLmhhcyh3aW5kb3dJZCkpIHJldHVybjtcclxuXHJcbiAgY29uc3Qgd2luZG93V2F0Y2hlcnMgPSB3aW5kb3dMaXN0ZW5lcnMuZ2V0KHdpbmRvd0lkKTtcclxuICBcclxuICAvLyBDaGVjayBpZiB3ZSBoYXZlIGEgbGlzdGVuZXIgZm9yIHRoaXMgd2F0Y2ggSURcclxuICBpZiAoIXdpbmRvd1dhdGNoZXJzLmhhcyh3YXRjaElkKSkgcmV0dXJuO1xyXG5cclxuICAvLyBHZXQgbGlzdGVuZXJcclxuICBjb25zdCBsaXN0ZW5lciA9IHdpbmRvd1dhdGNoZXJzLmdldCh3YXRjaElkKTtcclxuXHJcbiAgLy8gUmVtb3ZlIGxpc3RlbmVyIGZyb20gc2VydmljZVxyXG4gIEZpbGVXYXRjaGVyU2VydmljZS5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcik7XHJcblxyXG4gIC8vIFJlbW92ZSBsaXN0ZW5lciByZWZlcmVuY2VcclxuICB3aW5kb3dXYXRjaGVycy5kZWxldGUod2F0Y2hJZCk7XHJcblxyXG4gIC8vIENsZWFuIHVwIHdpbmRvdyBlbnRyeSBpZiBubyBtb3JlIHdhdGNoZXJzXHJcbiAgaWYgKHdpbmRvd1dhdGNoZXJzLnNpemUgPT09IDApIHtcclxuICAgIHdpbmRvd0xpc3RlbmVycy5kZWxldGUod2luZG93SWQpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCB3aW5kb3cgSUQgZnJvbSBzZW5kZXJcclxuICogQHByaXZhdGVcclxuICogQHBhcmFtIHtFbGVjdHJvbi5XZWJDb250ZW50c30gc2VuZGVyIC0gUmVuZGVyZXIgd2ViIGNvbnRlbnRzXHJcbiAqIEByZXR1cm5zIHtudW1iZXJ8bnVsbH0gV2luZG93IElEIG9yIG51bGwgaWYgbm90IGZvdW5kXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRXaW5kb3dJZEZyb21TZW5kZXIoc2VuZGVyKSB7XHJcbiAgY29uc3QgYWxsV2luZG93cyA9IEJyb3dzZXJXaW5kb3cuZ2V0QWxsV2luZG93cygpO1xyXG4gIGZvciAoY29uc3Qgd2luZG93IG9mIGFsbFdpbmRvd3MpIHtcclxuICAgIGlmICh3aW5kb3cud2ViQ29udGVudHMgPT09IHNlbmRlcikge1xyXG4gICAgICByZXR1cm4gd2luZG93LmlkO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFuIHVwIGFsbCB3YXRjaGVycyB3aGVuIGFwcCBpcyBxdWl0dGluZ1xyXG4gKi9cclxuZnVuY3Rpb24gY2xlYW51cEZpbGVXYXRjaGVycygpIHtcclxuICByZXR1cm4gRmlsZVdhdGNoZXJTZXJ2aWNlLmNsZWFudXAoKTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcmVnaXN0ZXJGaWxlV2F0Y2hlckhhbmRsZXJzLFxyXG4gIGNsZWFudXBGaWxlV2F0Y2hlcnNcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNO0VBQUVBLE9BQU87RUFBRUM7QUFBYyxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDdEQsTUFBTTtFQUFFQztBQUFZLENBQUMsR0FBR0QsT0FBTyxDQUFDLGFBQWEsQ0FBQztBQUM5QyxNQUFNRSxrQkFBa0IsR0FBR0YsT0FBTyxDQUFDLHNDQUFzQyxDQUFDOztBQUUxRTtBQUNBLE1BQU1HLGVBQWUsR0FBRyxJQUFJQyxHQUFHLENBQUMsQ0FBQzs7QUFFakM7QUFDQTtBQUNBO0FBQ0EsU0FBU0MsMkJBQTJCQSxDQUFBLEVBQUc7RUFDckM7RUFDQVAsT0FBTyxDQUFDUSxNQUFNLENBQUNMLFdBQVcsQ0FBQ00sV0FBVyxFQUFFLE9BQU9DLEtBQUssRUFBRUMsT0FBTyxLQUFLO0lBQ2hFLElBQUksQ0FBQ0EsT0FBTyxFQUFFQyxLQUFLLEVBQUU7TUFDbkIsT0FBTztRQUNMQyxPQUFPLEVBQUUsS0FBSztRQUNkQyxLQUFLLEVBQUU7TUFDVCxDQUFDO0lBQ0g7SUFFQSxNQUFNQyxNQUFNLEdBQUcsTUFBTVgsa0JBQWtCLENBQUNZLEtBQUss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