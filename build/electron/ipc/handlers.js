"use strict";

/**
 * IPC Main Process Handlers
 * Implements handlers for all IPC channels exposed through preload.js
 * 
 * Related files:
 * - main.js: Main process setup
 * - preload.js: API exposure to renderer
 * - types.js: TypeScript definitions
 */

const {
  shell,
  ipcMain,
  app
} = require('electron');
const {
  createStore
} = require('../utils/storeFactory');
const {
  registerFileSystemHandlers,
  cleanupFileSystemHandlers
} = require('./handlers/filesystem');
const {
  registerConversionHandlers
} = require('./handlers/conversion');
const {
  registerFileWatcherHandlers,
  cleanupFileWatchers
} = require('./handlers/filewatcher');
const {
  registerOfflineHandlers,
  cleanupOfflineHandlers
} = require('./handlers/offline');
const {
  registerApiKeyHandlers,
  cleanupApiKeyHandlers
} = require('./handlers/apikey');
const {
  registerTranscriptionHandlers,
  cleanupTranscriptionHandlers
} = require('./handlers/transcription');
const {
  registerHandlers: registerSettingsHandlers
} = require('./handlers/settings');

// Initialize encrypted store with error handling
const store = createStore('ipc-handlers', {
  encryptionKey: process.env.STORE_ENCRYPTION_KEY
});

/**
 * Setup basic IPC handlers that don't require window access
 * @param {Electron.App} app The Electron app instance
 */
function setupBasicHandlers(app) {
  // Register handlers
  registerFileSystemHandlers();
  registerApiKeyHandlers();
  registerSettingsHandlers();
  registerOfflineHandlers();
  registerTranscriptionHandlers();

  // Clean up resources on app quit
  app.on('will-quit', async () => {
    await cleanupFileWatchers();
    await cleanupOfflineHandlers();
    await cleanupApiKeyHandlers();
    await cleanupTranscriptionHandlers();
    await cleanupFileSystemHandlers();
  });

  // Application
  ipcMain.handle('codex:get-version', () => {
    return app.getVersion();
  });
  ipcMain.handle('codex:check-updates', async () => {
    // Will be implemented in phase 4 with auto-updater
    throw new Error('Not implemented yet');
  });

  // System Integration
  ipcMain.handle('codex:show-item-in-folder', (event, filePath) => {
    shell.showItemInFolder(filePath);
  });
  ipcMain.handle('codex:open-external', (event, url) => {
    return shell.openExternal(url);
  });
}

// Store references to cleanup functions for window-specific handlers
let currentWindowHandlers = new Map();

/**
 * Setup handlers that require window access
 * @param {Electron.BrowserWindow} mainWindow The main application window
 */
function setupWindowHandlers(mainWindow) {
  if (!mainWindow?.webContents) {
    throw new Error('Window not initialized for handler setup');
  }

  // Clean up any existing window handlers
  cleanupWindowHandlers();

  // Register conversion handlers that need window access
  const conversionCleanup = registerConversionHandlers();
  const watcherCleanup = registerFileWatcherHandlers();

  // Store cleanup functions
  if (conversionCleanup) currentWindowHandlers.set('conversion', conversionCleanup);
  if (watcherCleanup) currentWindowHandlers.set('watcher', watcherCleanup);

  // File Drop Event Handling
  const navigateHandler = (event, url) => {
    event.preventDefault();
  };
  const dropHandler = (event, files) => {
    event.preventDefault();
    mainWindow.webContents.send('codex:file-dropped', files);
  };
  mainWindow.webContents.on('will-navigate', navigateHandler);
  mainWindow.webContents.on('drop', dropHandler);

  // Store cleanup functions for event listeners
  currentWindowHandlers.set('events', () => {
    mainWindow.webContents.removeListener('will-navigate', navigateHandler);
    mainWindow.webContents.removeListener('drop', dropHandler);
  });

  // Add window-closed cleanup
  mainWindow.once('closed', () => {
    cleanupWindowHandlers();
  });
}

/**
 * Clean up window-specific handlers
 */
function cleanupWindowHandlers() {
  for (const cleanup of currentWindowHandlers.values()) {
    if (typeof cleanup === 'function') {
      try {
        cleanup();
      } catch (error) {
        console.error('Error during window handler cleanup:', error);
      }
    }
  }
  currentWindowHandlers.clear();
}
module.exports = {
  setupBasicHandlers,
  setupWindowHandlers,
  cleanupWindowHandlers
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzaGVsbCIsImlwY01haW4iLCJhcHAiLCJyZXF1aXJlIiwiY3JlYXRlU3RvcmUiLCJyZWdpc3RlckZpbGVTeXN0ZW1IYW5kbGVycyIsImNsZWFudXBGaWxlU3lzdGVtSGFuZGxlcnMiLCJyZWdpc3RlckNvbnZlcnNpb25IYW5kbGVycyIsInJlZ2lzdGVyRmlsZVdhdGNoZXJIYW5kbGVycyIsImNsZWFudXBGaWxlV2F0Y2hlcnMiLCJyZWdpc3Rlck9mZmxpbmVIYW5kbGVycyIsImNsZWFudXBPZmZsaW5lSGFuZGxlcnMiLCJyZWdpc3RlckFwaUtleUhhbmRsZXJzIiwiY2xlYW51cEFwaUtleUhhbmRsZXJzIiwicmVnaXN0ZXJUcmFuc2NyaXB0aW9uSGFuZGxlcnMiLCJjbGVhbnVwVHJhbnNjcmlwdGlvbkhhbmRsZXJzIiwicmVnaXN0ZXJIYW5kbGVycyIsInJlZ2lzdGVyU2V0dGluZ3NIYW5kbGVycyIsInN0b3JlIiwiZW5jcnlwdGlvbktleSIsInByb2Nlc3MiLCJlbnYiLCJTVE9SRV9FTkNSWVBUSU9OX0tFWSIsInNldHVwQmFzaWNIYW5kbGVycyIsIm9uIiwiaGFuZGxlIiwiZ2V0VmVyc2lvbiIsIkVycm9yIiwiZXZlbnQiLCJmaWxlUGF0aCIsInNob3dJdGVtSW5Gb2xkZXIiLCJ1cmwiLCJvcGVuRXh0ZXJuYWwiLCJjdXJyZW50V2luZG93SGFuZGxlcnMiLCJNYXAiLCJzZXR1cFdpbmRvd0hhbmRsZXJzIiwibWFpbldpbmRvdyIsIndlYkNvbnRlbnRzIiwiY2xlYW51cFdpbmRvd0hhbmRsZXJzIiwiY29udmVyc2lvbkNsZWFudXAiLCJ3YXRjaGVyQ2xlYW51cCIsInNldCIsIm5hdmlnYXRlSGFuZGxlciIsInByZXZlbnREZWZhdWx0IiwiZHJvcEhhbmRsZXIiLCJmaWxlcyIsInNlbmQiLCJyZW1vdmVMaXN0ZW5lciIsIm9uY2UiLCJjbGVhbnVwIiwidmFsdWVzIiwiZXJyb3IiLCJjb25zb2xlIiwiY2xlYXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2VsZWN0cm9uL2lwYy9oYW5kbGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogSVBDIE1haW4gUHJvY2VzcyBIYW5kbGVyc1xyXG4gKiBJbXBsZW1lbnRzIGhhbmRsZXJzIGZvciBhbGwgSVBDIGNoYW5uZWxzIGV4cG9zZWQgdGhyb3VnaCBwcmVsb2FkLmpzXHJcbiAqIFxyXG4gKiBSZWxhdGVkIGZpbGVzOlxyXG4gKiAtIG1haW4uanM6IE1haW4gcHJvY2VzcyBzZXR1cFxyXG4gKiAtIHByZWxvYWQuanM6IEFQSSBleHBvc3VyZSB0byByZW5kZXJlclxyXG4gKiAtIHR5cGVzLmpzOiBUeXBlU2NyaXB0IGRlZmluaXRpb25zXHJcbiAqL1xyXG5cclxuY29uc3QgeyBzaGVsbCwgaXBjTWFpbiwgYXBwIH0gPSByZXF1aXJlKCdlbGVjdHJvbicpO1xyXG5jb25zdCB7IGNyZWF0ZVN0b3JlIH0gPSByZXF1aXJlKCcuLi91dGlscy9zdG9yZUZhY3RvcnknKTtcclxuY29uc3QgeyByZWdpc3RlckZpbGVTeXN0ZW1IYW5kbGVycywgY2xlYW51cEZpbGVTeXN0ZW1IYW5kbGVycyB9ID0gcmVxdWlyZSgnLi9oYW5kbGVycy9maWxlc3lzdGVtJyk7XHJcbmNvbnN0IHsgcmVnaXN0ZXJDb252ZXJzaW9uSGFuZGxlcnMgfSA9IHJlcXVpcmUoJy4vaGFuZGxlcnMvY29udmVyc2lvbicpO1xyXG5jb25zdCB7IHJlZ2lzdGVyRmlsZVdhdGNoZXJIYW5kbGVycywgY2xlYW51cEZpbGVXYXRjaGVycyB9ID0gcmVxdWlyZSgnLi9oYW5kbGVycy9maWxld2F0Y2hlcicpO1xyXG5jb25zdCB7IHJlZ2lzdGVyT2ZmbGluZUhhbmRsZXJzLCBjbGVhbnVwT2ZmbGluZUhhbmRsZXJzIH0gPSByZXF1aXJlKCcuL2hhbmRsZXJzL29mZmxpbmUnKTtcclxuY29uc3QgeyByZWdpc3RlckFwaUtleUhhbmRsZXJzLCBjbGVhbnVwQXBpS2V5SGFuZGxlcnMgfSA9IHJlcXVpcmUoJy4vaGFuZGxlcnMvYXBpa2V5Jyk7XHJcbmNvbnN0IHsgcmVnaXN0ZXJUcmFuc2NyaXB0aW9uSGFuZGxlcnMsIGNsZWFudXBUcmFuc2NyaXB0aW9uSGFuZGxlcnMgfSA9IHJlcXVpcmUoJy4vaGFuZGxlcnMvdHJhbnNjcmlwdGlvbicpO1xyXG5jb25zdCB7IHJlZ2lzdGVySGFuZGxlcnM6IHJlZ2lzdGVyU2V0dGluZ3NIYW5kbGVycyB9ID0gcmVxdWlyZSgnLi9oYW5kbGVycy9zZXR0aW5ncycpO1xyXG5cclxuLy8gSW5pdGlhbGl6ZSBlbmNyeXB0ZWQgc3RvcmUgd2l0aCBlcnJvciBoYW5kbGluZ1xyXG5jb25zdCBzdG9yZSA9IGNyZWF0ZVN0b3JlKCdpcGMtaGFuZGxlcnMnLCB7XHJcbiAgZW5jcnlwdGlvbktleTogcHJvY2Vzcy5lbnYuU1RPUkVfRU5DUllQVElPTl9LRVlcclxufSk7XHJcblxyXG4vKipcclxuICogU2V0dXAgYmFzaWMgSVBDIGhhbmRsZXJzIHRoYXQgZG9uJ3QgcmVxdWlyZSB3aW5kb3cgYWNjZXNzXHJcbiAqIEBwYXJhbSB7RWxlY3Ryb24uQXBwfSBhcHAgVGhlIEVsZWN0cm9uIGFwcCBpbnN0YW5jZVxyXG4gKi9cclxuZnVuY3Rpb24gc2V0dXBCYXNpY0hhbmRsZXJzKGFwcCkge1xyXG4gIC8vIFJlZ2lzdGVyIGhhbmRsZXJzXHJcbiAgcmVnaXN0ZXJGaWxlU3lzdGVtSGFuZGxlcnMoKTtcclxuICByZWdpc3RlckFwaUtleUhhbmRsZXJzKCk7XHJcbiAgcmVnaXN0ZXJTZXR0aW5nc0hhbmRsZXJzKCk7XHJcbiAgcmVnaXN0ZXJPZmZsaW5lSGFuZGxlcnMoKTtcclxuICByZWdpc3RlclRyYW5zY3JpcHRpb25IYW5kbGVycygpO1xyXG4gIFxyXG4gIC8vIENsZWFuIHVwIHJlc291cmNlcyBvbiBhcHAgcXVpdFxyXG4gIGFwcC5vbignd2lsbC1xdWl0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgYXdhaXQgY2xlYW51cEZpbGVXYXRjaGVycygpO1xyXG4gICAgYXdhaXQgY2xlYW51cE9mZmxpbmVIYW5kbGVycygpO1xyXG4gICAgYXdhaXQgY2xlYW51cEFwaUtleUhhbmRsZXJzKCk7XHJcbiAgICBhd2FpdCBjbGVhbnVwVHJhbnNjcmlwdGlvbkhhbmRsZXJzKCk7XHJcbiAgICBhd2FpdCBjbGVhbnVwRmlsZVN5c3RlbUhhbmRsZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIEFwcGxpY2F0aW9uXHJcbiAgaXBjTWFpbi5oYW5kbGUoJ2NvZGV4OmdldC12ZXJzaW9uJywgKCkgPT4ge1xyXG4gICAgcmV0dXJuIGFwcC5nZXRWZXJzaW9uKCk7XHJcbiAgfSk7XHJcblxyXG4gIGlwY01haW4uaGFuZGxlKCdjb2RleDpjaGVjay11cGRhdGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gV2lsbCBiZSBpbXBsZW1lbnRlZCBpbiBwaGFzZSA0IHdpdGggYXV0by11cGRhdGVyXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCB5ZXQnKTtcclxuICB9KTtcclxuXHJcbiAgLy8gU3lzdGVtIEludGVncmF0aW9uXHJcbiAgaXBjTWFpbi5oYW5kbGUoJ2NvZGV4OnNob3ctaXRlbS1pbi1mb2xkZXInLCAoZXZlbnQsIGZpbGVQYXRoKSA9PiB7XHJcbiAgICBzaGVsbC5zaG93SXRlbUluRm9sZGVyKGZpbGVQYXRoKTtcclxuICB9KTtcclxuXHJcbiAgaXBjTWFpbi5oYW5kbGUoJ2NvZGV4Om9wZW4tZXh0ZXJuYWwnLCAoZXZlbnQsIHVybCkgPT4ge1xyXG4gICAgcmV0dXJuIHNoZWxsLm9wZW5FeHRlcm5hbCh1cmwpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vLyBTdG9yZSByZWZlcmVuY2VzIHRvIGNsZWFudXAgZnVuY3Rpb25zIGZvciB3aW5kb3ctc3BlY2lmaWMgaGFuZGxlcnNcclxubGV0IGN1cnJlbnRXaW5kb3dIYW5kbGVycyA9IG5ldyBNYXAoKTtcclxuXHJcbi8qKlxyXG4gKiBTZXR1cCBoYW5kbGVycyB0aGF0IHJlcXVpcmUgd2luZG93IGFjY2Vzc1xyXG4gKiBAcGFyYW0ge0VsZWN0cm9uLkJyb3dzZXJXaW5kb3d9IG1haW5XaW5kb3cgVGhlIG1haW4gYXBwbGljYXRpb24gd2luZG93XHJcbiAqL1xyXG5mdW5jdGlvbiBzZXR1cFdpbmRvd0hhbmRsZXJzKG1haW5XaW5kb3cpIHtcclxuICBpZiAoIW1haW5XaW5kb3c/LndlYkNvbnRlbnRzKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1dpbmRvdyBub3QgaW5pdGlhbGl6ZWQgZm9yIGhhbmRsZXIgc2V0dXAnKTtcclxuICB9XHJcblxyXG4gIC8vIENsZWFuIHVwIGFueSBleGlzdGluZyB3aW5kb3cgaGFuZGxlcnNcclxuICBjbGVhbnVwV2luZG93SGFuZGxlcnMoKTtcclxuXHJcbiAgLy8gUmVnaXN0ZXIgY29udmVyc2lvbiBoYW5kbGVycyB0aGF0IG5lZWQgd2luZG93IGFjY2Vzc1xyXG4gIGNvbnN0IGNvbnZlcnNpb25DbGVhbnVwID0gcmVnaXN0ZXJDb252ZXJzaW9uSGFuZGxlcnMoKTtcclxuICBjb25zdCB3YXRjaGVyQ2xlYW51cCA9IHJlZ2lzdGVyRmlsZVdhdGNoZXJIYW5kbGVycygpO1xyXG4gIFxyXG4gIC8vIFN0b3JlIGNsZWFudXAgZnVuY3Rpb25zXHJcbiAgaWYgKGNvbnZlcnNpb25DbGVhbnVwKSBjdXJyZW50V2luZG93SGFuZGxlcnMuc2V0KCdjb252ZXJzaW9uJywgY29udmVyc2lvbkNsZWFudXApO1xyXG4gIGlmICh3YXRjaGVyQ2xlYW51cCkgY3VycmVudFdpbmRvd0hhbmRsZXJzLnNldCgnd2F0Y2hlcicsIHdhdGNoZXJDbGVhbnVwKTtcclxuXHJcbiAgLy8gRmlsZSBEcm9wIEV2ZW50IEhhbmRsaW5nXHJcbiAgY29uc3QgbmF2aWdhdGVIYW5kbGVyID0gKGV2ZW50LCB1cmwpID0+IHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgfTtcclxuICBcclxuICBjb25zdCBkcm9wSGFuZGxlciA9IChldmVudCwgZmlsZXMpID0+IHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBtYWluV2luZG93LndlYkNvbnRlbnRzLnNlbmQoJ2NvZGV4OmZpbGUtZHJvcHBlZCcsIGZpbGVzKTtcclxuICB9O1xyXG5cclxuICBtYWluV2luZG93LndlYkNvbnRlbnRzLm9uKCd3aWxsLW5hdmlnYXRlJywgbmF2aWdhdGVIYW5kbGVyKTtcclxuICBtYWluV2luZG93LndlYkNvbnRlbnRzLm9uKCdkcm9wJywgZHJvcEhhbmRsZXIpO1xyXG5cclxuICAvLyBTdG9yZSBjbGVhbnVwIGZ1bmN0aW9ucyBmb3IgZXZlbnQgbGlzdGVuZXJzXHJcbiAgY3VycmVudFdpbmRvd0hhbmRsZXJzLnNldCgnZXZlbnRzJywgKCkgPT4ge1xyXG4gICAgbWFpbldpbmRvdy53ZWJDb250ZW50cy5yZW1vdmVMaXN0ZW5lcignd2lsbC1uYXZpZ2F0ZScsIG5hdmlnYXRlSGFuZGxlcik7XHJcbiAgICBtYWluV2luZG93LndlYkNvbnRlbnRzLnJlbW92ZUxpc3RlbmVyKCdkcm9wJywgZHJvcEhhbmRsZXIpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBBZGQgd2luZG93LWNsb3NlZCBjbGVhbnVwXHJcbiAgbWFpbldpbmRvdy5vbmNlKCdjbG9zZWQnLCAoKSA9PiB7XHJcbiAgICBjbGVhbnVwV2luZG93SGFuZGxlcnMoKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFuIHVwIHdpbmRvdy1zcGVjaWZpYyBoYW5kbGVyc1xyXG4gKi9cclxuZnVuY3Rpb24gY2xlYW51cFdpbmRvd0hhbmRsZXJzKCkge1xyXG4gIGZvciAoY29uc3QgY2xlYW51cCBvZiBjdXJyZW50V2luZG93SGFuZGxlcnMudmFsdWVzKCkpIHtcclxuICAgIGlmICh0eXBlb2YgY2xlYW51cCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNsZWFudXAoKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgd2luZG93IGhhbmRsZXIgY2xlYW51cDonLCBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgY3VycmVudFdpbmRvd0hhbmRsZXJzLmNsZWFyKCk7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHNldHVwQmFzaWNIYW5kbGVycyxcclxuICBzZXR1cFdpbmRvd0hhbmRsZXJzLFxyXG4gIGNsZWFudXBXaW5kb3dIYW5kbGVyc1xyXG59O1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU07RUFBRUEsS0FBSztFQUFFQyxPQUFPO0VBQUVDO0FBQUksQ0FBQyxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBQ25ELE1BQU07RUFBRUM7QUFBWSxDQUFDLEdBQUdELE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQztBQUN4RCxNQUFNO0VBQUVFLDBCQUEwQjtFQUFFQztBQUEwQixDQUFDLEdBQUdILE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQztBQUNsRyxNQUFNO0VBQUVJO0FBQTJCLENBQUMsR0FBR0osT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQ3ZFLE1BQU07RUFBRUssMkJBQTJCO0VBQUVDO0FBQW9CLENBQUMsR0FBR04sT0FBTyxDQUFDLHdCQUF3QixDQUFDO0FBQzlGLE1BQU07RUFBRU8sdUJBQXVCO0VBQUVDO0FBQXVCLENBQUMsR0FBR1IsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQ3pGLE1BQU07RUFBRVMsc0JBQXNCO0VBQUVDO0FBQXNCLENBQUMsR0FBR1YsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQ3RGLE1BQU07RUFBRVcsNkJBQTZCO0VBQUVDO0FBQTZCLENBQUMsR0FBR1osT0FBTyxDQUFDLDBCQUEwQixDQUFDO0FBQzNHLE1BQU07RUFBRWEsZ0JBQWdCLEVBQUVDO0FBQXlCLENBQUMsR0FBR2QsT0FBTyxDQUFDLHFCQUFxQixDQUFDOztBQUVyRjtBQUNBLE1BQU1lLEtBQUssR0FBR2QsV0FBVyxD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