"use strict";

/**
 * IPC Main Process Handlers
 * Implements handlers for all IPC channels exposed through preload.js
 * 
 * Related files:
 * - main.js: Main process setup
 * - preload.js: API exposure to renderer
 * - types.js: TypeScript definitions
 */

const {
  shell,
  ipcMain,
  app
} = require('electron');
const {
  createStore
} = require('../utils/storeFactory');
const {
  registerFileSystemHandlers,
  cleanupFileSystemHandlers
} = require('./handlers/filesystem');
const {
  registerConversionHandlers
} = require('./handlers/conversion');
const {
  registerFileWatcherHandlers,
  cleanupFileWatchers
} = require('./handlers/filewatcher');
const {
  registerOfflineHandlers,
  cleanupOfflineHandlers
} = require('./handlers/offline');
const {
  registerApiKeyHandlers,
  cleanupApiKeyHandlers
} = require('./handlers/apikey');
const {
  registerTranscriptionHandlers,
  cleanupTranscriptionHandlers
} = require('./handlers/transcription');
const {
  registerHandlers: registerSettingsHandlers
} = require('./handlers/settings');

// Initialize encrypted store with error handling
const store = createStore('ipc-handlers', {
  encryptionKey: process.env.STORE_ENCRYPTION_KEY
});

/**
 * Setup basic IPC handlers that don't require window access
 * @param {Electron.App} app The Electron app instance
 */
function setupBasicHandlers(app) {
  // Register handlers
  registerFileSystemHandlers();
  registerApiKeyHandlers();
  registerSettingsHandlers();
  registerOfflineHandlers();
  registerTranscriptionHandlers();

  // Clean up resources on app quit
  app.on('will-quit', async () => {
    await cleanupFileWatchers();
    await cleanupOfflineHandlers();
    await cleanupApiKeyHandlers();
    await cleanupTranscriptionHandlers();
    await cleanupFileSystemHandlers();
  });

  // Application
  ipcMain.handle('codex:get-version', () => {
    return app.getVersion();
  });
  ipcMain.handle('codex:check-updates', async () => {
    // Will be implemented in phase 4 with auto-updater
    throw new Error('Not implemented yet');
  });

  // System Integration
  ipcMain.handle('codex:show-item-in-folder', async (event, filePath) => {
    const fs = require('fs').promises;
    try {
      // Check if the path is a directory
      const stats = await fs.stat(filePath);
      if (stats.isDirectory()) {
        // Open the directory itself
        shell.openPath(filePath);
      } else {
        // Show the file in its containing folder
        shell.showItemInFolder(filePath);
      }
    } catch (error) {
      console.error('Error checking path:', error);
      // Fallback to showItemInFolder if we can't determine the type
      shell.showItemInFolder(filePath);
    }
  });
  ipcMain.handle('codex:open-external', (event, url) => {
    return shell.openExternal(url);
  });
}

// Store references to cleanup functions for window-specific handlers
let currentWindowHandlers = new Map();

/**
 * Setup handlers that require window access
 * @param {Electron.BrowserWindow} mainWindow The main application window
 */
function setupWindowHandlers(mainWindow) {
  if (!mainWindow?.webContents) {
    throw new Error('Window not initialized for handler setup');
  }

  // Clean up any existing window handlers
  cleanupWindowHandlers();

  // Register conversion handlers that need window access
  const conversionCleanup = registerConversionHandlers();
  const watcherCleanup = registerFileWatcherHandlers();

  // Store cleanup functions
  if (conversionCleanup) currentWindowHandlers.set('conversion', conversionCleanup);
  if (watcherCleanup) currentWindowHandlers.set('watcher', watcherCleanup);

  // File Drop Event Handling
  const navigateHandler = (event, url) => {
    event.preventDefault();
  };
  const dropHandler = (event, files) => {
    event.preventDefault();
    mainWindow.webContents.send('codex:file-dropped', files);
  };
  mainWindow.webContents.on('will-navigate', navigateHandler);
  mainWindow.webContents.on('drop', dropHandler);

  // Store cleanup functions for event listeners
  currentWindowHandlers.set('events', () => {
    mainWindow.webContents.removeListener('will-navigate', navigateHandler);
    mainWindow.webContents.removeListener('drop', dropHandler);
  });

  // Add window-closed cleanup
  mainWindow.once('closed', () => {
    cleanupWindowHandlers();
  });
}

/**
 * Clean up window-specific handlers
 */
function cleanupWindowHandlers() {
  for (const cleanup of currentWindowHandlers.values()) {
    if (typeof cleanup === 'function') {
      try {
        cleanup();
      } catch (error) {
        console.error('Error during window handler cleanup:', error);
      }
    }
  }
  currentWindowHandlers.clear();
}
module.exports = {
  setupBasicHandlers,
  setupWindowHandlers,
  cleanupWindowHandlers
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzaGVsbCIsImlwY01haW4iLCJhcHAiLCJyZXF1aXJlIiwiY3JlYXRlU3RvcmUiLCJyZWdpc3RlckZpbGVTeXN0ZW1IYW5kbGVycyIsImNsZWFudXBGaWxlU3lzdGVtSGFuZGxlcnMiLCJyZWdpc3RlckNvbnZlcnNpb25IYW5kbGVycyIsInJlZ2lzdGVyRmlsZVdhdGNoZXJIYW5kbGVycyIsImNsZWFudXBGaWxlV2F0Y2hlcnMiLCJyZWdpc3Rlck9mZmxpbmVIYW5kbGVycyIsImNsZWFudXBPZmZsaW5lSGFuZGxlcnMiLCJyZWdpc3RlckFwaUtleUhhbmRsZXJzIiwiY2xlYW51cEFwaUtleUhhbmRsZXJzIiwicmVnaXN0ZXJUcmFuc2NyaXB0aW9uSGFuZGxlcnMiLCJjbGVhbnVwVHJhbnNjcmlwdGlvbkhhbmRsZXJzIiwicmVnaXN0ZXJIYW5kbGVycyIsInJlZ2lzdGVyU2V0dGluZ3NIYW5kbGVycyIsInN0b3JlIiwiZW5jcnlwdGlvbktleSIsInByb2Nlc3MiLCJlbnYiLCJTVE9SRV9FTkNSWVBUSU9OX0tFWSIsInNldHVwQmFzaWNIYW5kbGVycyIsIm9uIiwiaGFuZGxlIiwiZ2V0VmVyc2lvbiIsIkVycm9yIiwiZXZlbnQiLCJmaWxlUGF0aCIsImZzIiwicHJvbWlzZXMiLCJzdGF0cyIsInN0YXQiLCJpc0RpcmVjdG9yeSIsIm9wZW5QYXRoIiwic2hvd0l0ZW1JbkZvbGRlciIsImVycm9yIiwiY29uc29sZSIsInVybCIsIm9wZW5FeHRlcm5hbCIsImN1cnJlbnRXaW5kb3dIYW5kbGVycyIsIk1hcCIsInNldHVwV2luZG93SGFuZGxlcnMiLCJtYWluV2luZG93Iiwid2ViQ29udGVudHMiLCJjbGVhbnVwV2luZG93SGFuZGxlcnMiLCJjb252ZXJzaW9uQ2xlYW51cCIsIndhdGNoZXJDbGVhbnVwIiwic2V0IiwibmF2aWdhdGVIYW5kbGVyIiwicHJldmVudERlZmF1bHQiLCJkcm9wSGFuZGxlciIsImZpbGVzIiwic2VuZCIsInJlbW92ZUxpc3RlbmVyIiwib25jZSIsImNsZWFudXAiLCJ2YWx1ZXMiLCJjbGVhciIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZWxlY3Ryb24vaXBjL2hhbmRsZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBJUEMgTWFpbiBQcm9jZXNzIEhhbmRsZXJzXHJcbiAqIEltcGxlbWVudHMgaGFuZGxlcnMgZm9yIGFsbCBJUEMgY2hhbm5lbHMgZXhwb3NlZCB0aHJvdWdoIHByZWxvYWQuanNcclxuICogXHJcbiAqIFJlbGF0ZWQgZmlsZXM6XHJcbiAqIC0gbWFpbi5qczogTWFpbiBwcm9jZXNzIHNldHVwXHJcbiAqIC0gcHJlbG9hZC5qczogQVBJIGV4cG9zdXJlIHRvIHJlbmRlcmVyXHJcbiAqIC0gdHlwZXMuanM6IFR5cGVTY3JpcHQgZGVmaW5pdGlvbnNcclxuICovXHJcblxyXG5jb25zdCB7IHNoZWxsLCBpcGNNYWluLCBhcHAgfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7XHJcbmNvbnN0IHsgY3JlYXRlU3RvcmUgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL3N0b3JlRmFjdG9yeScpO1xyXG5jb25zdCB7IHJlZ2lzdGVyRmlsZVN5c3RlbUhhbmRsZXJzLCBjbGVhbnVwRmlsZVN5c3RlbUhhbmRsZXJzIH0gPSByZXF1aXJlKCcuL2hhbmRsZXJzL2ZpbGVzeXN0ZW0nKTtcclxuY29uc3QgeyByZWdpc3RlckNvbnZlcnNpb25IYW5kbGVycyB9ID0gcmVxdWlyZSgnLi9oYW5kbGVycy9jb252ZXJzaW9uJyk7XHJcbmNvbnN0IHsgcmVnaXN0ZXJGaWxlV2F0Y2hlckhhbmRsZXJzLCBjbGVhbnVwRmlsZVdhdGNoZXJzIH0gPSByZXF1aXJlKCcuL2hhbmRsZXJzL2ZpbGV3YXRjaGVyJyk7XHJcbmNvbnN0IHsgcmVnaXN0ZXJPZmZsaW5lSGFuZGxlcnMsIGNsZWFudXBPZmZsaW5lSGFuZGxlcnMgfSA9IHJlcXVpcmUoJy4vaGFuZGxlcnMvb2ZmbGluZScpO1xyXG5jb25zdCB7IHJlZ2lzdGVyQXBpS2V5SGFuZGxlcnMsIGNsZWFudXBBcGlLZXlIYW5kbGVycyB9ID0gcmVxdWlyZSgnLi9oYW5kbGVycy9hcGlrZXknKTtcclxuY29uc3QgeyByZWdpc3RlclRyYW5zY3JpcHRpb25IYW5kbGVycywgY2xlYW51cFRyYW5zY3JpcHRpb25IYW5kbGVycyB9ID0gcmVxdWlyZSgnLi9oYW5kbGVycy90cmFuc2NyaXB0aW9uJyk7XHJcbmNvbnN0IHsgcmVnaXN0ZXJIYW5kbGVyczogcmVnaXN0ZXJTZXR0aW5nc0hhbmRsZXJzIH0gPSByZXF1aXJlKCcuL2hhbmRsZXJzL3NldHRpbmdzJyk7XHJcblxyXG4vLyBJbml0aWFsaXplIGVuY3J5cHRlZCBzdG9yZSB3aXRoIGVycm9yIGhhbmRsaW5nXHJcbmNvbnN0IHN0b3JlID0gY3JlYXRlU3RvcmUoJ2lwYy1oYW5kbGVycycsIHtcclxuICBlbmNyeXB0aW9uS2V5OiBwcm9jZXNzLmVudi5TVE9SRV9FTkNSWVBUSU9OX0tFWVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBTZXR1cCBiYXNpYyBJUEMgaGFuZGxlcnMgdGhhdCBkb24ndCByZXF1aXJlIHdpbmRvdyBhY2Nlc3NcclxuICogQHBhcmFtIHtFbGVjdHJvbi5BcHB9IGFwcCBUaGUgRWxlY3Ryb24gYXBwIGluc3RhbmNlXHJcbiAqL1xyXG5mdW5jdGlvbiBzZXR1cEJhc2ljSGFuZGxlcnMoYXBwKSB7XHJcbiAgLy8gUmVnaXN0ZXIgaGFuZGxlcnNcclxuICByZWdpc3RlckZpbGVTeXN0ZW1IYW5kbGVycygpO1xyXG4gIHJlZ2lzdGVyQXBpS2V5SGFuZGxlcnMoKTtcclxuICByZWdpc3RlclNldHRpbmdzSGFuZGxlcnMoKTtcclxuICByZWdpc3Rlck9mZmxpbmVIYW5kbGVycygpO1xyXG4gIHJlZ2lzdGVyVHJhbnNjcmlwdGlvbkhhbmRsZXJzKCk7XHJcbiAgXHJcbiAgLy8gQ2xlYW4gdXAgcmVzb3VyY2VzIG9uIGFwcCBxdWl0XHJcbiAgYXBwLm9uKCd3aWxsLXF1aXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBhd2FpdCBjbGVhbnVwRmlsZVdhdGNoZXJzKCk7XHJcbiAgICBhd2FpdCBjbGVhbnVwT2ZmbGluZUhhbmRsZXJzKCk7XHJcbiAgICBhd2FpdCBjbGVhbnVwQXBpS2V5SGFuZGxlcnMoKTtcclxuICAgIGF3YWl0IGNsZWFudXBUcmFuc2NyaXB0aW9uSGFuZGxlcnMoKTtcclxuICAgIGF3YWl0IGNsZWFudXBGaWxlU3lzdGVtSGFuZGxlcnMoKTtcclxuICB9KTtcclxuXHJcbiAgLy8gQXBwbGljYXRpb25cclxuICBpcGNNYWluLmhhbmRsZSgnY29kZXg6Z2V0LXZlcnNpb24nLCAoKSA9PiB7XHJcbiAgICByZXR1cm4gYXBwLmdldFZlcnNpb24oKTtcclxuICB9KTtcclxuXHJcbiAgaXBjTWFpbi5oYW5kbGUoJ2NvZGV4OmNoZWNrLXVwZGF0ZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBXaWxsIGJlIGltcGxlbWVudGVkIGluIHBoYXNlIDQgd2l0aCBhdXRvLXVwZGF0ZXJcclxuICAgIHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkIHlldCcpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBTeXN0ZW0gSW50ZWdyYXRpb25cclxuICBpcGNNYWluLmhhbmRsZSgnY29kZXg6c2hvdy1pdGVtLWluLWZvbGRlcicsIGFzeW5jIChldmVudCwgZmlsZVBhdGgpID0+IHtcclxuICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKS5wcm9taXNlcztcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBhdGggaXMgYSBkaXJlY3RvcnlcclxuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBmcy5zdGF0KGZpbGVQYXRoKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChzdGF0cy5pc0RpcmVjdG9yeSgpKSB7XHJcbiAgICAgICAgLy8gT3BlbiB0aGUgZGlyZWN0b3J5IGl0c2VsZlxyXG4gICAgICAgIHNoZWxsLm9wZW5QYXRoKGZpbGVQYXRoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBTaG93IHRoZSBmaWxlIGluIGl0cyBjb250YWluaW5nIGZvbGRlclxyXG4gICAgICAgIHNoZWxsLnNob3dJdGVtSW5Gb2xkZXIoZmlsZVBhdGgpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBwYXRoOicsIGVycm9yKTtcclxuICAgICAgLy8gRmFsbGJhY2sgdG8gc2hvd0l0ZW1JbkZvbGRlciBpZiB3ZSBjYW4ndCBkZXRlcm1pbmUgdGhlIHR5cGVcclxuICAgICAgc2hlbGwuc2hvd0l0ZW1JbkZvbGRlcihmaWxlUGF0aCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGlwY01haW4uaGFuZGxlKCdjb2RleDpvcGVuLWV4dGVybmFsJywgKGV2ZW50LCB1cmwpID0+IHtcclxuICAgIHJldHVybiBzaGVsbC5vcGVuRXh0ZXJuYWwodXJsKTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gU3RvcmUgcmVmZXJlbmNlcyB0byBjbGVhbnVwIGZ1bmN0aW9ucyBmb3Igd2luZG93LXNwZWNpZmljIGhhbmRsZXJzXHJcbmxldCBjdXJyZW50V2luZG93SGFuZGxlcnMgPSBuZXcgTWFwKCk7XHJcblxyXG4vKipcclxuICogU2V0dXAgaGFuZGxlcnMgdGhhdCByZXF1aXJlIHdpbmRvdyBhY2Nlc3NcclxuICogQHBhcmFtIHtFbGVjdHJvbi5Ccm93c2VyV2luZG93fSBtYWluV2luZG93IFRoZSBtYWluIGFwcGxpY2F0aW9uIHdpbmRvd1xyXG4gKi9cclxuZnVuY3Rpb24gc2V0dXBXaW5kb3dIYW5kbGVycyhtYWluV2luZG93KSB7XHJcbiAgaWYgKCFtYWluV2luZG93Py53ZWJDb250ZW50cykge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdXaW5kb3cgbm90IGluaXRpYWxpemVkIGZvciBoYW5kbGVyIHNldHVwJyk7XHJcbiAgfVxyXG5cclxuICAvLyBDbGVhbiB1cCBhbnkgZXhpc3Rpbmcgd2luZG93IGhhbmRsZXJzXHJcbiAgY2xlYW51cFdpbmRvd0hhbmRsZXJzKCk7XHJcblxyXG4gIC8vIFJlZ2lzdGVyIGNvbnZlcnNpb24gaGFuZGxlcnMgdGhhdCBuZWVkIHdpbmRvdyBhY2Nlc3NcclxuICBjb25zdCBjb252ZXJzaW9uQ2xlYW51cCA9IHJlZ2lzdGVyQ29udmVyc2lvbkhhbmRsZXJzKCk7XHJcbiAgY29uc3Qgd2F0Y2hlckNsZWFudXAgPSByZWdpc3RlckZpbGVXYXRjaGVySGFuZGxlcnMoKTtcclxuICBcclxuICAvLyBTdG9yZSBjbGVhbnVwIGZ1bmN0aW9uc1xyXG4gIGlmIChjb252ZXJzaW9uQ2xlYW51cCkgY3VycmVudFdpbmRvd0hhbmRsZXJzLnNldCgnY29udmVyc2lvbicsIGNvbnZlcnNpb25DbGVhbnVwKTtcclxuICBpZiAod2F0Y2hlckNsZWFudXApIGN1cnJlbnRXaW5kb3dIYW5kbGVycy5zZXQoJ3dhdGNoZXInLCB3YXRjaGVyQ2xlYW51cCk7XHJcblxyXG4gIC8vIEZpbGUgRHJvcCBFdmVudCBIYW5kbGluZ1xyXG4gIGNvbnN0IG5hdmlnYXRlSGFuZGxlciA9IChldmVudCwgdXJsKSA9PiB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIH07XHJcbiAgXHJcbiAgY29uc3QgZHJvcEhhbmRsZXIgPSAoZXZlbnQsIGZpbGVzKSA9PiB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbWFpbldpbmRvdy53ZWJDb250ZW50cy5zZW5kKCdjb2RleDpmaWxlLWRyb3BwZWQnLCBmaWxlcyk7XHJcbiAgfTtcclxuXHJcbiAgbWFpbldpbmRvdy53ZWJDb250ZW50cy5vbignd2lsbC1uYXZpZ2F0ZScsIG5hdmlnYXRlSGFuZGxlcik7XHJcbiAgbWFpbldpbmRvdy53ZWJDb250ZW50cy5vbignZHJvcCcsIGRyb3BIYW5kbGVyKTtcclxuXHJcbiAgLy8gU3RvcmUgY2xlYW51cCBmdW5jdGlvbnMgZm9yIGV2ZW50IGxpc3RlbmVyc1xyXG4gIGN1cnJlbnRXaW5kb3dIYW5kbGVycy5zZXQoJ2V2ZW50cycsICgpID0+IHtcclxuICAgIG1haW5XaW5kb3cud2ViQ29udGVudHMucmVtb3ZlTGlzdGVuZXIoJ3dpbGwtbmF2aWdhdGUnLCBuYXZpZ2F0ZUhhbmRsZXIpO1xyXG4gICAgbWFpbldpbmRvdy53ZWJDb250ZW50cy5yZW1vdmVMaXN0ZW5lcignZHJvcCcsIGRyb3BIYW5kbGVyKTtcclxuICB9KTtcclxuXHJcbiAgLy8gQWRkIHdpbmRvdy1jbG9zZWQgY2xlYW51cFxyXG4gIG1haW5XaW5kb3cub25jZSgnY2xvc2VkJywgKCkgPT4ge1xyXG4gICAgY2xlYW51cFdpbmRvd0hhbmRsZXJzKCk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhbiB1cCB3aW5kb3ctc3BlY2lmaWMgaGFuZGxlcnNcclxuICovXHJcbmZ1bmN0aW9uIGNsZWFudXBXaW5kb3dIYW5kbGVycygpIHtcclxuICBmb3IgKGNvbnN0IGNsZWFudXAgb2YgY3VycmVudFdpbmRvd0hhbmRsZXJzLnZhbHVlcygpKSB7XHJcbiAgICBpZiAodHlwZW9mIGNsZWFudXAgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjbGVhbnVwKCk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIHdpbmRvdyBoYW5kbGVyIGNsZWFudXA6JywgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIGN1cnJlbnRXaW5kb3dIYW5kbGVycy5jbGVhcigpO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICBzZXR1cEJhc2ljSGFuZGxlcnMsXHJcbiAgc2V0dXBXaW5kb3dIYW5kbGVycyxcclxuICBjbGVhbnVwV2luZG93SGFuZGxlcnNcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFF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