"use strict";

/**
 * WindowManager.js
 * 
 * Manages the application's window(s), handling creation,
 * initialization, positioning, and lifecycle.
 * 
 * This module extracts window management logic from main.js to
 * provide a more modular architecture.
 */

const {
  app,
  BrowserWindow
} = require('electron');
const path = require('path');
const fs = require('fs-extra');
const {
  PathUtils
} = require('../utils/paths');
const logger = require('../utils/logger');
const {
  setupWindowHandlers,
  cleanupWindowHandlers
} = require('../ipc/handlers');
class WindowManager {
  constructor() {
    this.mainWindow = null;
    this.isInitialized = false;
  }

  /**
   * Initialize the window manager
   * @returns {Promise<boolean>} Success status
   */
  async initialize() {
    this.isInitialized = true;
    return true;
  }

  /**
   * Create and setup the main application window
   * @returns {Promise<Electron.BrowserWindow|null>} Created window or null on failure
   */
  async createMainWindow() {
    try {
      if (!this.isInitialized) {
        console.warn('WindowManager not initialized. Initializing now...');
        await this.initialize();
      }
      console.log('Creating main window...');
      const window = await this._createWindow();
      if (!window) {
        console.error('❌ Window creation failed: window is null');
        return null;
      }
      console.log('Window created successfully, waiting for initialization...');

      // Wait a moment for the window to initialize fully
      await new Promise(resolve => setTimeout(resolve, 1000));
      console.log('Setting up window handlers...');
      // Setup window handlers
      await setupWindowHandlers(window);
      console.log('✅ Window handlers registered successfully');
      this.mainWindow = window;
      return window;
    } catch (error) {
      console.error('❌ Failed to create and setup window:', error);
      return null;
    }
  }

  /**
   * Internal method to create a window with the proper configuration
   * @private
   * @returns {Promise<Electron.BrowserWindow>} Created window
   */
  async _createWindow() {
    try {
      if (logger.isInitialized) {
        await logger.log('Creating main window');

        // Log app paths for debugging
        const appPaths = {
          appPath: app.getAppPath(),
          appData: app.getPath('appData'),
          userData: app.getPath('userData'),
          exe: app.getPath('exe'),
          module: app.getPath('module'),
          cwd: process.cwd(),
          resourcesPath: process.resourcesPath || 'undefined'
        };
        await logger.debug('Application paths', appPaths);
      }

      // Get platform-specific icon path
      const iconPath = PathUtils.normalizePath(process.env.NODE_ENV === 'development' ? path.join(__dirname, '../../frontend/static/logo.png') : path.join(app.getAppPath(), 'frontend/static/logo.png'));
      if (logger.isInitialized) {
        await logger.debug('Icon path', {
          iconPath
        });

        // Verify icon exists
        try {
          const iconExists = await fs.pathExists(iconPath);
          await logger.debug('Icon file check', {
            exists: iconExists,
            path: iconPath
          });
          if (!iconExists) {
            await logger.warn(`Icon file does not exist: ${iconPath}`);
          }
        } catch (error) {
          await logger.error('Error checking icon file', error);
        }
      }

      // Configure window for platform
      const windowConfig = {
        width: 1200,
        height: 800,
        minWidth: 800,
        minHeight: 600,
        icon: iconPath,
        webPreferences: {
          nodeIntegration: false,
          contextIsolation: true,
          preload: PathUtils.normalizePath(path.join(__dirname, '../preload.js'))
        },
        show: false // Don't show the window until it's ready
      };

      // Platform-specific window settings
      if (process.platform === 'darwin') {
        windowConfig.titleBarStyle = 'hiddenInset';
      } else if (process.platform === 'win32') {
        windowConfig.frame = true;
      }
      if (logger.isInitialized) {
        await logger.logWindowCreation(windowConfig);
      }
      try {
        const window = new BrowserWindow(windowConfig);
        if (logger.isInitialized) {
          await logger.log('BrowserWindow created successfully');
        }

        // Show window when it's ready to avoid white flash
        window.once('ready-to-show', () => {
          if (logger.isInitialized) {
            logger.log('Window ready to show event fired');
          }
          window.show();
        });

        // Load the app
        if (process.env.NODE_ENV === 'development') {
          // Dev mode - load from dev server
          window.loadURL('http://localhost:5173');
          window.webContents.openDevTools();
        } else {
          // Production - load local files using platform-safe paths
          const appPath = PathUtils.normalizePath(process.env.NODE_ENV === 'development' ? path.join(__dirname, '../../frontend/dist/index.html') : path.join(app.getAppPath(), 'frontend/dist/index.html'));

          // Enable dev tools in production for debugging if needed
          window.webContents.openDevTools();

          // Log the path being loaded
          console.log('Loading app from path:', appPath);
          try {
            // Load file using file:// protocol
            window.loadFile(appPath);
          } catch (loadError) {
            console.error('Error loading app:', loadError);
            if (logger.isInitialized) {
              await logger.error('Failed to load app from path', {
                path: appPath,
                error: loadError
              });
            }

            // Fallback to URL loading if file loading fails
            try {
              const fileUrl = url.format({
                pathname: appPath,
                protocol: 'file:',
                slashes: true
              });
              console.log('Falling back to URL loading:', fileUrl);
              window.loadURL(fileUrl);
            } catch (urlError) {
              console.error('Error loading app via URL:', urlError);
              if (logger.isInitialized) {
                await logger.error('Failed to load app via URL', {
                  url: fileUrl,
                  error: urlError
                });
              }
              throw urlError;
            }
          }
        }

        // Set up window close event handler
        window.on('closed', () => {
          if (logger.isInitialized) {
            logger.log('Window closed event fired');
          }

          // Clean up window handlers
          cleanupWindowHandlers();
          if (this.mainWindow === window) {
            this.mainWindow = null;
          }
        });
        return window;
      } catch (error) {
        if (logger.isInitialized) {
          await logger.error('Failed to create BrowserWindow', error);
        }
        throw error;
      }
    } catch (error) {
      console.error('Error creating window:', error);
      throw error;
    }
  }

  /**
   * Ensure the main window exists and is visible, creating it if necessary
   * @returns {Promise<Electron.BrowserWindow|null>} Main window or null on failure
   */
  async ensureMainWindow() {
    if (this.mainWindow) {
      // If window exists but is minimized, restore it
      if (this.mainWindow.isMinimized()) {
        this.mainWindow.restore();
      }

      // Focus the window
      this.mainWindow.focus();
      return this.mainWindow;
    }

    // Create new window if one doesn't exist
    return await this.createMainWindow();
  }

  /**
   * Get the main window instance
   * @returns {Electron.BrowserWindow|null} Main window or null if not created
   */
  getMainWindow() {
    return this.mainWindow;
  }

  /**
   * Close all windows and clean up
   */
  cleanup() {
    if (this.mainWindow) {
      this.mainWindow.close();
      this.mainWindow = null;
    }
  }
}

// Export a singleton instance
module.exports = new WindowManager();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhcHAiLCJCcm93c2VyV2luZG93IiwicmVxdWlyZSIsInBhdGgiLCJmcyIsIlBhdGhVdGlscyIsImxvZ2dlciIsInNldHVwV2luZG93SGFuZGxlcnMiLCJjbGVhbnVwV2luZG93SGFuZGxlcnMiLCJXaW5kb3dNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJtYWluV2luZG93IiwiaXNJbml0aWFsaXplZCIsImluaXRpYWxpemUiLCJjcmVhdGVNYWluV2luZG93IiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJ3aW5kb3ciLCJfY3JlYXRlV2luZG93IiwiZXJyb3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJhcHBQYXRocyIsImFwcFBhdGgiLCJnZXRBcHBQYXRoIiwiYXBwRGF0YSIsImdldFBhdGgiLCJ1c2VyRGF0YSIsImV4ZSIsIm1vZHVsZSIsImN3ZCIsInByb2Nlc3MiLCJyZXNvdXJjZXNQYXRoIiwiZGVidWciLCJpY29uUGF0aCIsIm5vcm1hbGl6ZVBhdGgiLCJlbnYiLCJOT0RFX0VOViIsImpvaW4iLCJfX2Rpcm5hbWUiLCJpY29uRXhpc3RzIiwicGF0aEV4aXN0cyIsImV4aXN0cyIsIndpbmRvd0NvbmZpZyIsIndpZHRoIiwiaGVpZ2h0IiwibWluV2lkdGgiLCJtaW5IZWlnaHQiLCJpY29uIiwid2ViUHJlZmVyZW5jZXMiLCJub2RlSW50ZWdyYXRpb24iLCJjb250ZXh0SXNvbGF0aW9uIiwicHJlbG9hZCIsInNob3ciLCJwbGF0Zm9ybSIsInRpdGxlQmFyU3R5bGUiLCJmcmFtZSIsImxvZ1dpbmRvd0NyZWF0aW9uIiwib25jZSIsImxvYWRVUkwiLCJ3ZWJDb250ZW50cyIsIm9wZW5EZXZUb29scyIsImxvYWRGaWxlIiwibG9hZEVycm9yIiwiZmlsZVVybCIsInVybCIsImZvcm1hdCIsInBhdGhuYW1lIiwicHJvdG9jb2wiLCJzbGFzaGVzIiwidXJsRXJyb3IiLCJvbiIsImVuc3VyZU1haW5XaW5kb3ciLCJpc01pbmltaXplZCIsInJlc3RvcmUiLCJmb2N1cyIsImdldE1haW5XaW5kb3ciLCJjbGVhbnVwIiwiY2xvc2UiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2VsZWN0cm9uL21hbmFnZXJzL1dpbmRvd01hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFdpbmRvd01hbmFnZXIuanNcclxuICogXHJcbiAqIE1hbmFnZXMgdGhlIGFwcGxpY2F0aW9uJ3Mgd2luZG93KHMpLCBoYW5kbGluZyBjcmVhdGlvbixcclxuICogaW5pdGlhbGl6YXRpb24sIHBvc2l0aW9uaW5nLCBhbmQgbGlmZWN5Y2xlLlxyXG4gKiBcclxuICogVGhpcyBtb2R1bGUgZXh0cmFjdHMgd2luZG93IG1hbmFnZW1lbnQgbG9naWMgZnJvbSBtYWluLmpzIHRvXHJcbiAqIHByb3ZpZGUgYSBtb3JlIG1vZHVsYXIgYXJjaGl0ZWN0dXJlLlxyXG4gKi9cclxuXHJcbmNvbnN0IHsgYXBwLCBCcm93c2VyV2luZG93IH0gPSByZXF1aXJlKCdlbGVjdHJvbicpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzLWV4dHJhJyk7XHJcbmNvbnN0IHsgUGF0aFV0aWxzIH0gPSByZXF1aXJlKCcuLi91dGlscy9wYXRocycpO1xyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi91dGlscy9sb2dnZXInKTtcclxuY29uc3QgeyBzZXR1cFdpbmRvd0hhbmRsZXJzLCBjbGVhbnVwV2luZG93SGFuZGxlcnMgfSA9IHJlcXVpcmUoJy4uL2lwYy9oYW5kbGVycycpO1xyXG5cclxuY2xhc3MgV2luZG93TWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLm1haW5XaW5kb3cgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgd2luZG93IG1hbmFnZXJcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBTdWNjZXNzIHN0YXR1c1xyXG4gICAgICovXHJcbiAgICBhc3luYyBpbml0aWFsaXplKCkge1xyXG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgYW5kIHNldHVwIHRoZSBtYWluIGFwcGxpY2F0aW9uIHdpbmRvd1xyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8RWxlY3Ryb24uQnJvd3NlcldpbmRvd3xudWxsPn0gQ3JlYXRlZCB3aW5kb3cgb3IgbnVsbCBvbiBmYWlsdXJlXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGNyZWF0ZU1haW5XaW5kb3coKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignV2luZG93TWFuYWdlciBub3QgaW5pdGlhbGl6ZWQuIEluaXRpYWxpemluZyBub3cuLi4nKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ3JlYXRpbmcgbWFpbiB3aW5kb3cuLi4nKTtcclxuICAgICAgICAgICAgY29uc3Qgd2luZG93ID0gYXdhaXQgdGhpcy5fY3JlYXRlV2luZG93KCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoIXdpbmRvdykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFdpbmRvdyBjcmVhdGlvbiBmYWlsZWQ6IHdpbmRvdyBpcyBudWxsJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1dpbmRvdyBjcmVhdGVkIHN1Y2Nlc3NmdWxseSwgd2FpdGluZyBmb3IgaW5pdGlhbGl6YXRpb24uLi4nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFdhaXQgYSBtb21lbnQgZm9yIHRoZSB3aW5kb3cgdG8gaW5pdGlhbGl6ZSBmdWxseVxyXG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NldHRpbmcgdXAgd2luZG93IGhhbmRsZXJzLi4uJyk7XHJcbiAgICAgICAgICAgIC8vIFNldHVwIHdpbmRvdyBoYW5kbGVyc1xyXG4gICAgICAgICAgICBhd2FpdCBzZXR1cFdpbmRvd0hhbmRsZXJzKHdpbmRvdyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgV2luZG93IGhhbmRsZXJzIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLm1haW5XaW5kb3cgPSB3aW5kb3c7XHJcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3c7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBjcmVhdGUgYW5kIHNldHVwIHdpbmRvdzonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEludGVybmFsIG1ldGhvZCB0byBjcmVhdGUgYSB3aW5kb3cgd2l0aCB0aGUgcHJvcGVyIGNvbmZpZ3VyYXRpb25cclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxFbGVjdHJvbi5Ccm93c2VyV2luZG93Pn0gQ3JlYXRlZCB3aW5kb3dcclxuICAgICAqL1xyXG4gICAgYXN5bmMgX2NyZWF0ZVdpbmRvdygpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci5sb2coJ0NyZWF0aW5nIG1haW4gd2luZG93Jyk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIExvZyBhcHAgcGF0aHMgZm9yIGRlYnVnZ2luZ1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYXBwUGF0aHMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXBwUGF0aDogYXBwLmdldEFwcFBhdGgoKSxcclxuICAgICAgICAgICAgICAgICAgICBhcHBEYXRhOiBhcHAuZ2V0UGF0aCgnYXBwRGF0YScpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJEYXRhOiBhcHAuZ2V0UGF0aCgndXNlckRhdGEnKSxcclxuICAgICAgICAgICAgICAgICAgICBleGU6IGFwcC5nZXRQYXRoKCdleGUnKSxcclxuICAgICAgICAgICAgICAgICAgICBtb2R1bGU6IGFwcC5nZXRQYXRoKCdtb2R1bGUnKSxcclxuICAgICAgICAgICAgICAgICAgICBjd2Q6IHByb2Nlc3MuY3dkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzUGF0aDogcHJvY2Vzcy5yZXNvdXJjZXNQYXRoIHx8ICd1bmRlZmluZWQnXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmRlYnVnKCdBcHBsaWNhdGlvbiBwYXRocycsIGFwcFBhdGhzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gR2V0IHBsYXRmb3JtLXNwZWNpZmljIGljb24gcGF0aFxyXG4gICAgICAgICAgICBjb25zdCBpY29uUGF0aCA9IFBhdGhVdGlscy5ub3JtYWxpemVQYXRoKFxyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCdcclxuICAgICAgICAgICAgICAgICAgICA/IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi9mcm9udGVuZC9zdGF0aWMvbG9nby5wbmcnKVxyXG4gICAgICAgICAgICAgICAgICAgIDogcGF0aC5qb2luKGFwcC5nZXRBcHBQYXRoKCksICdmcm9udGVuZC9zdGF0aWMvbG9nby5wbmcnKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIuZGVidWcoJ0ljb24gcGF0aCcsIHsgaWNvblBhdGggfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVmVyaWZ5IGljb24gZXhpc3RzXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb25FeGlzdHMgPSBhd2FpdCBmcy5wYXRoRXhpc3RzKGljb25QYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIuZGVidWcoJ0ljb24gZmlsZSBjaGVjaycsIHsgZXhpc3RzOiBpY29uRXhpc3RzLCBwYXRoOiBpY29uUGF0aCB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWljb25FeGlzdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLndhcm4oYEljb24gZmlsZSBkb2VzIG5vdCBleGlzdDogJHtpY29uUGF0aH1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci5lcnJvcignRXJyb3IgY2hlY2tpbmcgaWNvbiBmaWxlJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb25maWd1cmUgd2luZG93IGZvciBwbGF0Zm9ybVxyXG4gICAgICAgICAgICBjb25zdCB3aW5kb3dDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMTIwMCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogODAwLFxyXG4gICAgICAgICAgICAgICAgbWluV2lkdGg6IDgwMCxcclxuICAgICAgICAgICAgICAgIG1pbkhlaWdodDogNjAwLFxyXG4gICAgICAgICAgICAgICAgaWNvbjogaWNvblBhdGgsXHJcbiAgICAgICAgICAgICAgICB3ZWJQcmVmZXJlbmNlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGVJbnRlZ3JhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dElzb2xhdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBwcmVsb2FkOiBQYXRoVXRpbHMubm9ybWFsaXplUGF0aChwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vcHJlbG9hZC5qcycpKVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNob3c6IGZhbHNlIC8vIERvbid0IHNob3cgdGhlIHdpbmRvdyB1bnRpbCBpdCdzIHJlYWR5XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyBQbGF0Zm9ybS1zcGVjaWZpYyB3aW5kb3cgc2V0dGluZ3NcclxuICAgICAgICAgICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gPT09ICdkYXJ3aW4nKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3dDb25maWcudGl0bGVCYXJTdHlsZSA9ICdoaWRkZW5JbnNldCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJykge1xyXG4gICAgICAgICAgICAgICAgd2luZG93Q29uZmlnLmZyYW1lID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIubG9nV2luZG93Q3JlYXRpb24od2luZG93Q29uZmlnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdpbmRvdyA9IG5ldyBCcm93c2VyV2luZG93KHdpbmRvd0NvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIubG9nKCdCcm93c2VyV2luZG93IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gU2hvdyB3aW5kb3cgd2hlbiBpdCdzIHJlYWR5IHRvIGF2b2lkIHdoaXRlIGZsYXNoXHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub25jZSgncmVhZHktdG8tc2hvdycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnV2luZG93IHJlYWR5IHRvIHNob3cgZXZlbnQgZmlyZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNob3coKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIExvYWQgdGhlIGFwcFxyXG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRGV2IG1vZGUgLSBsb2FkIGZyb20gZGV2IHNlcnZlclxyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2FkVVJMKCdodHRwOi8vbG9jYWxob3N0OjUxNzMnKTtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cud2ViQ29udGVudHMub3BlbkRldlRvb2xzKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFByb2R1Y3Rpb24gLSBsb2FkIGxvY2FsIGZpbGVzIHVzaW5nIHBsYXRmb3JtLXNhZmUgcGF0aHNcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhcHBQYXRoID0gUGF0aFV0aWxzLm5vcm1hbGl6ZVBhdGgoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi9mcm9udGVuZC9kaXN0L2luZGV4Lmh0bWwnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXRoLmpvaW4oYXBwLmdldEFwcFBhdGgoKSwgJ2Zyb250ZW5kL2Rpc3QvaW5kZXguaHRtbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgZGV2IHRvb2xzIGluIHByb2R1Y3Rpb24gZm9yIGRlYnVnZ2luZyBpZiBuZWVkZWRcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cud2ViQ29udGVudHMub3BlbkRldlRvb2xzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nIHRoZSBwYXRoIGJlaW5nIGxvYWRlZFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIGFwcCBmcm9tIHBhdGg6JywgYXBwUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBmaWxlIHVzaW5nIGZpbGU6Ly8gcHJvdG9jb2xcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvYWRGaWxlKGFwcFBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGxvYWRFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIGFwcDonLCBsb2FkRXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGxvYWQgYXBwIGZyb20gcGF0aCcsIHsgcGF0aDogYXBwUGF0aCwgZXJyb3I6IGxvYWRFcnJvciB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gVVJMIGxvYWRpbmcgaWYgZmlsZSBsb2FkaW5nIGZhaWxzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlVXJsID0gdXJsLmZvcm1hdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IGFwcFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICdmaWxlOicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xhc2hlczogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmFsbGluZyBiYWNrIHRvIFVSTCBsb2FkaW5nOicsIGZpbGVVcmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvYWRVUkwoZmlsZVVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHVybEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIGFwcCB2aWEgVVJMOicsIHVybEVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGxvYWQgYXBwIHZpYSBVUkwnLCB7IHVybDogZmlsZVVybCwgZXJyb3I6IHVybEVycm9yIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgdXJsRXJyb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHVwIHdpbmRvdyBjbG9zZSBldmVudCBoYW5kbGVyXHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub24oJ2Nsb3NlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnV2luZG93IGNsb3NlZCBldmVudCBmaXJlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCB3aW5kb3cgaGFuZGxlcnNcclxuICAgICAgICAgICAgICAgICAgICBjbGVhbnVwV2luZG93SGFuZGxlcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYWluV2luZG93ID09PSB3aW5kb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWluV2luZG93ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93O1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIEJyb3dzZXJXaW5kb3cnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHdpbmRvdzonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEVuc3VyZSB0aGUgbWFpbiB3aW5kb3cgZXhpc3RzIGFuZCBpcyB2aXNpYmxlLCBjcmVhdGluZyBpdCBpZiBuZWNlc3NhcnlcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPEVsZWN0cm9uLkJyb3dzZXJXaW5kb3d8bnVsbD59IE1haW4gd2luZG93IG9yIG51bGwgb24gZmFpbHVyZVxyXG4gICAgICovXHJcbiAgICBhc3luYyBlbnN1cmVNYWluV2luZG93KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1haW5XaW5kb3cpIHtcclxuICAgICAgICAgICAgLy8gSWYgd2luZG93IGV4aXN0cyBidXQgaXMgbWluaW1pemVkLCByZXN0b3JlIGl0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1haW5XaW5kb3cuaXNNaW5pbWl6ZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tYWluV2luZG93LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gRm9jdXMgdGhlIHdpbmRvd1xyXG4gICAgICAgICAgICB0aGlzLm1haW5XaW5kb3cuZm9jdXMoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFpbldpbmRvdztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ3JlYXRlIG5ldyB3aW5kb3cgaWYgb25lIGRvZXNuJ3QgZXhpc3RcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jcmVhdGVNYWluV2luZG93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIG1haW4gd2luZG93IGluc3RhbmNlXHJcbiAgICAgKiBAcmV0dXJucyB7RWxlY3Ryb24uQnJvd3NlcldpbmRvd3xudWxsfSBNYWluIHdpbmRvdyBvciBudWxsIGlmIG5vdCBjcmVhdGVkXHJcbiAgICAgKi9cclxuICAgIGdldE1haW5XaW5kb3coKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFpbldpbmRvdztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENsb3NlIGFsbCB3aW5kb3dzIGFuZCBjbGVhbiB1cFxyXG4gICAgICovXHJcbiAgICBjbGVhbnVwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1haW5XaW5kb3cpIHtcclxuICAgICAgICAgICAgdGhpcy5tYWluV2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMubWFpbldpbmRvdyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgYSBzaW5nbGV0b24gaW5zdGFu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