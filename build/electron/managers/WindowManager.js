"use strict";

/**
 * WindowManager.js
 * 
 * Manages the application's window(s), handling creation,
 * initialization, positioning, and lifecycle.
 * 
 * This module extracts window management logic from main.js to
 * provide a more modular architecture.
 */

const {
  app,
  BrowserWindow
} = require('electron');
const path = require('path');
const fs = require('fs-extra');
const {
  PathUtils
} = require('../utils/paths');
const logger = require('../utils/logger');
const {
  setupWindowHandlers,
  cleanupWindowHandlers
} = require('../ipc/handlers');
class WindowManager {
  constructor() {
    this.mainWindow = null;
    this.isInitialized = false;
  }

  /**
   * Initialize the window manager
   * @returns {Promise<boolean>} Success status
   */
  async initialize() {
    this.isInitialized = true;
    return true;
  }

  /**
   * Create and setup the main application window
   * @returns {Promise<Electron.BrowserWindow|null>} Created window or null on failure
   */
  async createMainWindow() {
    try {
      if (!this.isInitialized) {
        console.warn('WindowManager not initialized. Initializing now...');
        await this.initialize();
      }
      console.log('Creating main window...');
      const window = await this._createWindow();
      if (!window) {
        console.error('❌ Window creation failed: window is null');
        return null;
      }
      console.log('Window created successfully, waiting for initialization...');

      // Wait a moment for the window to initialize fully
      await new Promise(resolve => setTimeout(resolve, 1000));
      console.log('Setting up window handlers...');
      // Setup window handlers
      await setupWindowHandlers(window);
      console.log('✅ Window handlers registered successfully');
      this.mainWindow = window;
      return window;
    } catch (error) {
      console.error('❌ Failed to create and setup window:', error);
      return null;
    }
  }

  /**
   * Internal method to create a window with the proper configuration
   * @private
   * @returns {Promise<Electron.BrowserWindow>} Created window
   */
  async _createWindow() {
    try {
      if (logger.isInitialized) {
        await logger.log('Creating main window');

        // Log app paths for debugging
        const appPaths = {
          appPath: app.getAppPath(),
          appData: app.getPath('appData'),
          userData: app.getPath('userData'),
          exe: app.getPath('exe'),
          module: app.getPath('module'),
          cwd: process.cwd(),
          resourcesPath: process.resourcesPath || 'undefined'
        };
        await logger.debug('Application paths', appPaths);
      }

      // Get platform-specific icon path
      const iconPath = PathUtils.normalizePath(process.env.NODE_ENV === 'development' ? path.join(__dirname, '../../frontend/static/logo.png') : path.join(app.getAppPath(), 'frontend/static/logo.png'));
      if (logger.isInitialized) {
        await logger.debug('Icon path', {
          iconPath
        });

        // Verify icon exists
        try {
          const iconExists = await fs.pathExists(iconPath);
          await logger.debug('Icon file check', {
            exists: iconExists,
            path: iconPath
          });
          if (!iconExists) {
            await logger.warn(`Icon file does not exist: ${iconPath}`);
          }
        } catch (error) {
          await logger.error('Error checking icon file', error);
        }
      }

      // Configure window for platform
      const windowConfig = {
        width: 1200,
        height: 800,
        minWidth: 800,
        minHeight: 600,
        icon: iconPath,
        webPreferences: {
          nodeIntegration: false,
          contextIsolation: true,
          preload: PathUtils.normalizePath(path.join(__dirname, '../preload.js'))
        },
        show: false // Don't show the window until it's ready
      };

      // Platform-specific window settings
      if (process.platform === 'darwin') {
        windowConfig.titleBarStyle = 'hiddenInset';
      } else if (process.platform === 'win32') {
        windowConfig.frame = true;
      }
      if (logger.isInitialized) {
        await logger.logWindowCreation(windowConfig);
      }
      try {
        const window = new BrowserWindow(windowConfig);
        if (logger.isInitialized) {
          await logger.log('BrowserWindow created successfully');
        }

        // Show window when it's ready to avoid white flash
        window.once('ready-to-show', () => {
          if (logger.isInitialized) {
            logger.log('Window ready to show event fired');
          }
          window.show();
        });

        // Load the app
        if (process.env.NODE_ENV === 'development') {
          // Dev mode - load from dev server
          window.loadURL('http://localhost:5173');
          // window.webContents.openDevTools(); // Commented out to prevent auto-opening
        } else {
          // Production - load local files using platform-safe paths
          const appPath = PathUtils.normalizePath(process.env.NODE_ENV === 'development' ? path.join(__dirname, '../../frontend/dist/index.html') : path.join(app.getAppPath(), 'frontend/dist/index.html'));

          // Log the path being loaded
          console.log('Loading app from path:', appPath);
          try {
            // Load file using file:// protocol
            window.loadFile(appPath);
          } catch (loadError) {
            console.error('Error loading app:', loadError);
            if (logger.isInitialized) {
              await logger.error('Failed to load app from path', {
                path: appPath,
                error: loadError
              });
            }

            // Fallback to URL loading if file loading fails
            try {
              const fileUrl = url.format({
                pathname: appPath,
                protocol: 'file:',
                slashes: true
              });
              console.log('Falling back to URL loading:', fileUrl);
              window.loadURL(fileUrl);
            } catch (urlError) {
              console.error('Error loading app via URL:', urlError);
              if (logger.isInitialized) {
                await logger.error('Failed to load app via URL', {
                  url: fileUrl,
                  error: urlError
                });
              }
              throw urlError;
            }
          }
        }

        // Set up window close event handler
        window.on('closed', () => {
          if (logger.isInitialized) {
            logger.log('Window closed event fired');
          }

          // Clean up window handlers
          cleanupWindowHandlers();
          if (this.mainWindow === window) {
            this.mainWindow = null;
          }
        });
        return window;
      } catch (error) {
        if (logger.isInitialized) {
          await logger.error('Failed to create BrowserWindow', error);
        }
        throw error;
      }
    } catch (error) {
      console.error('Error creating window:', error);
      throw error;
    }
  }

  /**
   * Ensure the main window exists and is visible, creating it if necessary
   * @returns {Promise<Electron.BrowserWindow|null>} Main window or null on failure
   */
  async ensureMainWindow() {
    if (this.mainWindow) {
      // If window exists but is minimized, restore it
      if (this.mainWindow.isMinimized()) {
        this.mainWindow.restore();
      }

      // Focus the window
      this.mainWindow.focus();
      return this.mainWindow;
    }

    // Create new window if one doesn't exist
    return await this.createMainWindow();
  }

  /**
   * Get the main window instance
   * @returns {Electron.BrowserWindow|null} Main window or null if not created
   */
  getMainWindow() {
    return this.mainWindow;
  }

  /**
   * Close all windows and clean up
   */
  cleanup() {
    if (this.mainWindow) {
      this.mainWindow.close();
      this.mainWindow = null;
    }
  }
}

// Export a singleton instance
module.exports = new WindowManager();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhcHAiLCJCcm93c2VyV2luZG93IiwicmVxdWlyZSIsInBhdGgiLCJmcyIsIlBhdGhVdGlscyIsImxvZ2dlciIsInNldHVwV2luZG93SGFuZGxlcnMiLCJjbGVhbnVwV2luZG93SGFuZGxlcnMiLCJXaW5kb3dNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJtYWluV2luZG93IiwiaXNJbml0aWFsaXplZCIsImluaXRpYWxpemUiLCJjcmVhdGVNYWluV2luZG93IiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJ3aW5kb3ciLCJfY3JlYXRlV2luZG93IiwiZXJyb3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJhcHBQYXRocyIsImFwcFBhdGgiLCJnZXRBcHBQYXRoIiwiYXBwRGF0YSIsImdldFBhdGgiLCJ1c2VyRGF0YSIsImV4ZSIsIm1vZHVsZSIsImN3ZCIsInByb2Nlc3MiLCJyZXNvdXJjZXNQYXRoIiwiZGVidWciLCJpY29uUGF0aCIsIm5vcm1hbGl6ZVBhdGgiLCJlbnYiLCJOT0RFX0VOViIsImpvaW4iLCJfX2Rpcm5hbWUiLCJpY29uRXhpc3RzIiwicGF0aEV4aXN0cyIsImV4aXN0cyIsIndpbmRvd0NvbmZpZyIsIndpZHRoIiwiaGVpZ2h0IiwibWluV2lkdGgiLCJtaW5IZWlnaHQiLCJpY29uIiwid2ViUHJlZmVyZW5jZXMiLCJub2RlSW50ZWdyYXRpb24iLCJjb250ZXh0SXNvbGF0aW9uIiwicHJlbG9hZCIsInNob3ciLCJwbGF0Zm9ybSIsInRpdGxlQmFyU3R5bGUiLCJmcmFtZSIsImxvZ1dpbmRvd0NyZWF0aW9uIiwib25jZSIsImxvYWRVUkwiLCJsb2FkRmlsZSIsImxvYWRFcnJvciIsImZpbGVVcmwiLCJ1cmwiLCJmb3JtYXQiLCJwYXRobmFtZSIsInByb3RvY29sIiwic2xhc2hlcyIsInVybEVycm9yIiwib24iLCJlbnN1cmVNYWluV2luZG93IiwiaXNNaW5pbWl6ZWQiLCJyZXN0b3JlIiwiZm9jdXMiLCJnZXRNYWluV2luZG93IiwiY2xlYW51cCIsImNsb3NlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9lbGVjdHJvbi9tYW5hZ2Vycy9XaW5kb3dNYW5hZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBXaW5kb3dNYW5hZ2VyLmpzXHJcbiAqIFxyXG4gKiBNYW5hZ2VzIHRoZSBhcHBsaWNhdGlvbidzIHdpbmRvdyhzKSwgaGFuZGxpbmcgY3JlYXRpb24sXHJcbiAqIGluaXRpYWxpemF0aW9uLCBwb3NpdGlvbmluZywgYW5kIGxpZmVjeWNsZS5cclxuICogXHJcbiAqIFRoaXMgbW9kdWxlIGV4dHJhY3RzIHdpbmRvdyBtYW5hZ2VtZW50IGxvZ2ljIGZyb20gbWFpbi5qcyB0b1xyXG4gKiBwcm92aWRlIGEgbW9yZSBtb2R1bGFyIGFyY2hpdGVjdHVyZS5cclxuICovXHJcblxyXG5jb25zdCB7IGFwcCwgQnJvd3NlcldpbmRvdyB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcy1leHRyYScpO1xyXG5jb25zdCB7IFBhdGhVdGlscyB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvcGF0aHMnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XHJcbmNvbnN0IHsgc2V0dXBXaW5kb3dIYW5kbGVycywgY2xlYW51cFdpbmRvd0hhbmRsZXJzIH0gPSByZXF1aXJlKCcuLi9pcGMvaGFuZGxlcnMnKTtcclxuXHJcbmNsYXNzIFdpbmRvd01hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5tYWluV2luZG93ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgdGhlIHdpbmRvdyBtYW5hZ2VyXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gU3VjY2VzcyBzdGF0dXNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgaW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIGFuZCBzZXR1cCB0aGUgbWFpbiBhcHBsaWNhdGlvbiB3aW5kb3dcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPEVsZWN0cm9uLkJyb3dzZXJXaW5kb3d8bnVsbD59IENyZWF0ZWQgd2luZG93IG9yIG51bGwgb24gZmFpbHVyZVxyXG4gICAgICovXHJcbiAgICBhc3luYyBjcmVhdGVNYWluV2luZG93KCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1dpbmRvd01hbmFnZXIgbm90IGluaXRpYWxpemVkLiBJbml0aWFsaXppbmcgbm93Li4uJyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIG1haW4gd2luZG93Li4uJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdpbmRvdyA9IGF3YWl0IHRoaXMuX2NyZWF0ZVdpbmRvdygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKCF3aW5kb3cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBXaW5kb3cgY3JlYXRpb24gZmFpbGVkOiB3aW5kb3cgaXMgbnVsbCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdXaW5kb3cgY3JlYXRlZCBzdWNjZXNzZnVsbHksIHdhaXRpbmcgZm9yIGluaXRpYWxpemF0aW9uLi4uJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBXYWl0IGEgbW9tZW50IGZvciB0aGUgd2luZG93IHRvIGluaXRpYWxpemUgZnVsbHlcclxuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZXR0aW5nIHVwIHdpbmRvdyBoYW5kbGVycy4uLicpO1xyXG4gICAgICAgICAgICAvLyBTZXR1cCB3aW5kb3cgaGFuZGxlcnNcclxuICAgICAgICAgICAgYXdhaXQgc2V0dXBXaW5kb3dIYW5kbGVycyh3aW5kb3cpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFdpbmRvdyBoYW5kbGVycyByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5tYWluV2luZG93ID0gd2luZG93O1xyXG4gICAgICAgICAgICByZXR1cm4gd2luZG93O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gY3JlYXRlIGFuZCBzZXR1cCB3aW5kb3c6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gY3JlYXRlIGEgd2luZG93IHdpdGggdGhlIHByb3BlciBjb25maWd1cmF0aW9uXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8RWxlY3Ryb24uQnJvd3NlcldpbmRvdz59IENyZWF0ZWQgd2luZG93XHJcbiAgICAgKi9cclxuICAgIGFzeW5jIF9jcmVhdGVXaW5kb3coKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIubG9nKCdDcmVhdGluZyBtYWluIHdpbmRvdycpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBMb2cgYXBwIHBhdGhzIGZvciBkZWJ1Z2dpbmdcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFwcFBhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFwcFBhdGg6IGFwcC5nZXRBcHBQYXRoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYXBwRGF0YTogYXBwLmdldFBhdGgoJ2FwcERhdGEnKSxcclxuICAgICAgICAgICAgICAgICAgICB1c2VyRGF0YTogYXBwLmdldFBhdGgoJ3VzZXJEYXRhJyksXHJcbiAgICAgICAgICAgICAgICAgICAgZXhlOiBhcHAuZ2V0UGF0aCgnZXhlJyksXHJcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlOiBhcHAuZ2V0UGF0aCgnbW9kdWxlJyksXHJcbiAgICAgICAgICAgICAgICAgICAgY3dkOiBwcm9jZXNzLmN3ZCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlc1BhdGg6IHByb2Nlc3MucmVzb3VyY2VzUGF0aCB8fCAndW5kZWZpbmVkJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci5kZWJ1ZygnQXBwbGljYXRpb24gcGF0aHMnLCBhcHBQYXRocyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEdldCBwbGF0Zm9ybS1zcGVjaWZpYyBpY29uIHBhdGhcclxuICAgICAgICAgICAgY29uc3QgaWNvblBhdGggPSBQYXRoVXRpbHMubm9ybWFsaXplUGF0aChcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnXHJcbiAgICAgICAgICAgICAgICAgICAgPyBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vZnJvbnRlbmQvc3RhdGljL2xvZ28ucG5nJylcclxuICAgICAgICAgICAgICAgICAgICA6IHBhdGguam9pbihhcHAuZ2V0QXBwUGF0aCgpLCAnZnJvbnRlbmQvc3RhdGljL2xvZ28ucG5nJylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmRlYnVnKCdJY29uIHBhdGgnLCB7IGljb25QYXRoIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFZlcmlmeSBpY29uIGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpY29uRXhpc3RzID0gYXdhaXQgZnMucGF0aEV4aXN0cyhpY29uUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmRlYnVnKCdJY29uIGZpbGUgY2hlY2snLCB7IGV4aXN0czogaWNvbkV4aXN0cywgcGF0aDogaWNvblBhdGggfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpY29uRXhpc3RzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci53YXJuKGBJY29uIGZpbGUgZG9lcyBub3QgZXhpc3Q6ICR7aWNvblBhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIGljb24gZmlsZScsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29uZmlndXJlIHdpbmRvdyBmb3IgcGxhdGZvcm1cclxuICAgICAgICAgICAgY29uc3Qgd2luZG93Q29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IDEyMDAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDgwMCxcclxuICAgICAgICAgICAgICAgIG1pbldpZHRoOiA4MDAsXHJcbiAgICAgICAgICAgICAgICBtaW5IZWlnaHQ6IDYwMCxcclxuICAgICAgICAgICAgICAgIGljb246IGljb25QYXRoLFxyXG4gICAgICAgICAgICAgICAgd2ViUHJlZmVyZW5jZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlSW50ZWdyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHRJc29sYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJlbG9hZDogUGF0aFV0aWxzLm5vcm1hbGl6ZVBhdGgocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3ByZWxvYWQuanMnKSlcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaG93OiBmYWxzZSAvLyBEb24ndCBzaG93IHRoZSB3aW5kb3cgdW50aWwgaXQncyByZWFkeVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gUGxhdGZvcm0tc3BlY2lmaWMgd2luZG93IHNldHRpbmdzXHJcbiAgICAgICAgICAgIGlmIChwcm9jZXNzLnBsYXRmb3JtID09PSAnZGFyd2luJykge1xyXG4gICAgICAgICAgICAgICAgd2luZG93Q29uZmlnLnRpdGxlQmFyU3R5bGUgPSAnaGlkZGVuSW5zZXQnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvd0NvbmZpZy5mcmFtZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmxvZ1dpbmRvd0NyZWF0aW9uKHdpbmRvd0NvbmZpZyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB3aW5kb3cgPSBuZXcgQnJvd3NlcldpbmRvdyh3aW5kb3dDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmxvZygnQnJvd3NlcldpbmRvdyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFNob3cgd2luZG93IHdoZW4gaXQncyByZWFkeSB0byBhdm9pZCB3aGl0ZSBmbGFzaFxyXG4gICAgICAgICAgICAgICAgd2luZG93Lm9uY2UoJ3JlYWR5LXRvLXNob3cnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ1dpbmRvdyByZWFkeSB0byBzaG93IGV2ZW50IGZpcmVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBMb2FkIHRoZSBhcHBcclxuICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIERldiBtb2RlIC0gbG9hZCBmcm9tIGRldiBzZXJ2ZXJcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9hZFVSTCgnaHR0cDovL2xvY2FsaG9zdDo1MTczJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93LndlYkNvbnRlbnRzLm9wZW5EZXZUb29scygpOyAvLyBDb21tZW50ZWQgb3V0IHRvIHByZXZlbnQgYXV0by1vcGVuaW5nXHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAgLy8gUHJvZHVjdGlvbiAtIGxvYWQgbG9jYWwgZmlsZXMgdXNpbmcgcGxhdGZvcm0tc2FmZSBwYXRoc1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcFBhdGggPSBQYXRoVXRpbHMubm9ybWFsaXplUGF0aChcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uL2Zyb250ZW5kL2Rpc3QvaW5kZXguaHRtbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHBhdGguam9pbihhcHAuZ2V0QXBwUGF0aCgpLCAnZnJvbnRlbmQvZGlzdC9pbmRleC5odG1sJylcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIExvZyB0aGUgcGF0aCBiZWluZyBsb2FkZWRcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTG9hZGluZyBhcHAgZnJvbSBwYXRoOicsIGFwcFBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvYWQgZmlsZSB1c2luZyBmaWxlOi8vIHByb3RvY29sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2FkRmlsZShhcHBQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChsb2FkRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBhcHA6JywgbG9hZEVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGFwcCBmcm9tIHBhdGgnLCB7IHBhdGg6IGFwcFBhdGgsIGVycm9yOiBsb2FkRXJyb3IgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIFVSTCBsb2FkaW5nIGlmIGZpbGUgbG9hZGluZyBmYWlsc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVVybCA9IHVybC5mb3JtYXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBhcHBQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAnZmlsZTonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsYXNoZXM6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZhbGxpbmcgYmFjayB0byBVUkwgbG9hZGluZzonLCBmaWxlVXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2FkVVJMKGZpbGVVcmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICh1cmxFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBhcHAgdmlhIFVSTDonLCB1cmxFcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGFwcCB2aWEgVVJMJywgeyB1cmw6IGZpbGVVcmwsIGVycm9yOiB1cmxFcnJvciB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHVybEVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFNldCB1cCB3aW5kb3cgY2xvc2UgZXZlbnQgaGFuZGxlclxyXG4gICAgICAgICAgICAgICAgd2luZG93Lm9uKCdjbG9zZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ1dpbmRvdyBjbG9zZWQgZXZlbnQgZmlyZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYW4gdXAgd2luZG93IGhhbmRsZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYW51cFdpbmRvd0hhbmRsZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWFpbldpbmRvdyA9PT0gd2luZG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFpbldpbmRvdyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdztcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBCcm93c2VyV2luZG93JywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyB3aW5kb3c6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFbnN1cmUgdGhlIG1haW4gd2luZG93IGV4aXN0cyBhbmQgaXMgdmlzaWJsZSwgY3JlYXRpbmcgaXQgaWYgbmVjZXNzYXJ5XHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxFbGVjdHJvbi5Ccm93c2VyV2luZG93fG51bGw+fSBNYWluIHdpbmRvdyBvciBudWxsIG9uIGZhaWx1cmVcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZW5zdXJlTWFpbldpbmRvdygpIHtcclxuICAgICAgICBpZiAodGhpcy5tYWluV2luZG93KSB7XHJcbiAgICAgICAgICAgIC8vIElmIHdpbmRvdyBleGlzdHMgYnV0IGlzIG1pbmltaXplZCwgcmVzdG9yZSBpdFxyXG4gICAgICAgICAgICBpZiAodGhpcy5tYWluV2luZG93LmlzTWluaW1pemVkKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWFpbldpbmRvdy5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEZvY3VzIHRoZSB3aW5kb3dcclxuICAgICAgICAgICAgdGhpcy5tYWluV2luZG93LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1haW5XaW5kb3c7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgd2luZG93IGlmIG9uZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlTWFpbldpbmRvdygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSBtYWluIHdpbmRvdyBpbnN0YW5jZVxyXG4gICAgICogQHJldHVybnMge0VsZWN0cm9uLkJyb3dzZXJXaW5kb3d8bnVsbH0gTWFpbiB3aW5kb3cgb3IgbnVsbCBpZiBub3QgY3JlYXRlZFxyXG4gICAgICovXHJcbiAgICBnZXRNYWluV2luZG93KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1haW5XaW5kb3c7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDbG9zZSBhbGwgd2luZG93cyBhbmQgY2xlYW4gdXBcclxuICAgICAqL1xyXG4gICAgY2xlYW51cCgpIHtcclxuICAgICAgICBpZiAodGhpcy5tYWluV2luZG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFpbldpbmRvdy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLm1haW5XaW5kb3cgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLy8gRXhwb3J0IGEgc2luZ2xldG9uIGluc3RhbmNlXHJcbm1vZHVsZS5leHBvcnRzID0gbmV3IFdpbmRvd01hbmFnZXIoKTsiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU07RUFBRUEsR0FBRztFQUFFQztBQUFjLENBQUMsR0FBR0MsT0FB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