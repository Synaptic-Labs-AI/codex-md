"use strict";

/**
 * PdfConverterFactory.js
 * Factory for creating appropriate PDF converters based on file and options.
 * 
 * This factory:
 * - Analyzes PDF files to determine the best conversion approach
 * - Creates instances of appropriate PDF converters
 * - Provides a unified interface for PDF conversion
 * - Handles fallback between different conversion methods
 * 
 * Related Files:
 * - BasePdfConverter.js: Base class for PDF converters
 * - StandardPdfConverter.js: Text-based PDF converter
 * - MistralPdfConverter.js: OCR-based PDF converter
 * - ConversionService.js: Uses this factory for PDF conversion
 */

const path = require('path');
const fs = require('fs-extra');
const StandardPdfConverter = require('./StandardPdfConverter');
const MistralPdfConverter = require('./MistralPdfConverter');
class PdfConverterFactory {
  constructor(fileProcessor, fileStorage) {
    this.fileProcessor = fileProcessor;
    this.fileStorage = fileStorage;
    this.supportedExtensions = ['.pdf'];

    // Create converter instances - pass true for skipHandlerSetup
    // This prevents duplicate IPC handler registration when used through the factory
    this.standardConverter = new StandardPdfConverter(fileProcessor, fileStorage, true);
    this.mistralConverter = new MistralPdfConverter(fileProcessor, fileStorage, null, true);
  }

  /**
   * Get appropriate converter for PDF file
   * @param {string} filePath - Path to PDF file
   * @param {Object} options - Conversion options
   * @returns {Object} Appropriate PDF converter with convert method
   */
  async getConverter(filePath, options = {}) {
    console.log('[PdfConverterFactory] Getting converter for PDF file');

    // Create a wrapper object that exposes the convert method
    const createConverterWrapper = converter => {
      return {
        convert: async (content, name, apiKey, options) => {
          console.log(`[PdfConverterFactory] Using ${converter.name} for conversion`);
          return await converter.convertToMarkdown(content, {
            ...options,
            name,
            apiKey
          });
        }
      };
    };
    // Check if OCR is explicitly enabled in options
    console.log('[PdfConverterFactory] Checking if OCR is enabled in options:', options);
    console.log(`[PdfConverterFactory] options.useOcr = ${options.useOcr} (type: ${typeof options.useOcr})`);
    if (options.useOcr) {
      console.log('[PdfConverterFactory] Using OCR converter (enabled in settings)');

      // Check if OCR is available using the API key provided in options
      const ocrCheck = await this.isOcrAvailable(options.mistralApiKey);
      console.log(`[PdfConverterFactory] OCR availability check:`, ocrCheck);
      if (!ocrCheck.available) {
        console.log(`[PdfConverterFactory] OCR not available: ${ocrCheck.reason}, using standard converter`);

        // Provide detailed warning in the log about why OCR is not available
        if (ocrCheck.reason.includes('API key')) {
          console.warn('[PdfConverterFactory] WARNING: OCR was requested but API key is invalid or missing');
        }
        return createConverterWrapper(this.standardConverter);
      }
      console.log('[PdfConverterFactory] OCR is available, using Mistral converter');
      return createConverterWrapper(this.mistralConverter);
    } else {
      console.log('[PdfConverterFactory] OCR is not enabled in options, checking other conditions');
    }

    // If force option is specified, use the requested converter
    if (options.forceOcr) {
      console.log('[PdfConverterFactory] Using OCR converter (forced)');
      return createConverterWrapper(this.mistralConverter);
    }
    if (options.forceStandard) {
      console.log('[PdfConverterFactory] Using standard converter (forced)');
      return createConverterWrapper(this.standardConverter);
    }

    // Check if OCR is available using any provided API key
    const ocrCheck = await this.isOcrAvailable(options.mistralApiKey);
    if (!ocrCheck.available) {
      console.log(`[PdfConverterFactory] OCR not available: ${ocrCheck.reason}, using standard converter`);
      return createConverterWrapper(this.standardConverter);
    }

    // Analyze PDF to determine if OCR is needed
    const needsOcr = await this.analyzeNeedsOcr(filePath);
    if (needsOcr) {
      console.log('[PdfConverterFactory] PDF analysis suggests OCR is needed');
      return createConverterWrapper(this.mistralConverter);
    }
    console.log('[PdfConverterFactory] Using standard converter based on analysis');
    return createConverterWrapper(this.standardConverter);
  }

  /**
   * Check if OCR is available
   * @param {string} apiKey - Optional API key to check (will use current key if not provided)
   * @returns {Promise<{available: boolean, reason: string}>} Availability status and reason
   */
  async isOcrAvailable(apiKey = null) {
    try {
      console.log('[PdfConverterFactory] Checking OCR availability');

      // Check if mistralConverter is initialized
      if (!this.mistralConverter) {
        console.error('[PdfConverterFactory] MistralPdfConverter not initialized');
        return {
          available: false,
          reason: 'Mistral OCR converter not initialized'
        };
      }

      // If an API key was provided, temporarily set it for the check
      if (apiKey) {
        this.mistralConverter.setApiKey(apiKey);
      }

      // Check if API key is available
      if (!this.mistralConverter.apiKey) {
        console.log('[PdfConverterFactory] No Mistral API key found in converter');
        return {
          available: false,
          reason: 'No Mistral API key provided'
        };
      }

      // Basic key format validation
      if (typeof this.mistralConverter.apiKey !== 'string' || this.mistralConverter.apiKey.trim().length < 10) {
        console.log('[PdfConverterFactory] Invalid Mistral API key format');
        return {
          available: false,
          reason: 'Invalid Mistral API key format'
        };
      }
      console.log('[PdfConverterFactory] Calling handleCheckApiKey');
      const result = await this.mistralConverter.handleCheckApiKey();
      console.log('[PdfConverterFactory] OCR availability check result:', result);
      if (result.valid) {
        return {
          available: true,
          reason: 'Mistral API key is valid'
        };
      } else {
        return {
          available: false,
          reason: result.error || 'Invalid Mistral API key'
        };
      }
    } catch (error) {
      console.error('[PdfConverterFactory] Error checking OCR availability:', error);
      return {
        available: false,
        reason: error.message || 'Error checking OCR availability'
      };
    }
  }

  /**
   * Analyze PDF to determine if OCR is needed
   * @param {string} filePath - Path to PDF file
   * @returns {Promise<boolean>} True if OCR is recommended
   */
  async analyzeNeedsOcr(filePath) {
    try {
      // Extract text using standard converter
      const pdfData = await fs.readFile(filePath);
      const pdfParse = require('pdf-parse');
      const data = await pdfParse(pdfData);

      // Check if text extraction yielded meaningful results
      const textLength = data.text.trim().length;
      const pageCount = data.numpages;

      // Calculate average text per page
      const avgTextPerPage = textLength / pageCount;

      // If very little text was extracted, OCR might be needed
      if (avgTextPerPage < 100) {
        console.log(`[PdfConverterFactory] Low text content detected (${avgTextPerPage.toFixed(2)} chars/page), suggesting OCR`);
        return true;
      }

      // Check for scanned document indicators
      const hasScannedIndicators = this.checkForScannedIndicators(data.text);
      if (hasScannedIndicators) {
        console.log('[PdfConverterFactory] Scanned document indicators detected, suggesting OCR');
        return true;
      }
      return false;
    } catch (error) {
      console.error('[PdfConverterFactory] Error analyzing PDF:', error);
      // If analysis fails, default to standard converter
      return false;
    }
  }

  /**
   * Check for indicators that a document is scanned
   * @param {string} text - Extracted text
   * @returns {boolean} True if scanned indicators are found
   */
  checkForScannedIndicators(text) {
    // Common indicators in scanned documents
    const indicators = ['scanned', 'scan', 'ocr', 'image', 'digitized', 'digitised'];
    const lowerText = text.toLowerCase();
    return indicators.some(indicator => lowerText.includes(indicator));
  }

  /**
   * Convert PDF file to markdown
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} request - Conversion request
   * @returns {Promise<Object>} Conversion result
   */
  async convertPdf(event, {
    filePath,
    options = {}
  }) {
    try {
      console.log('[PdfConverterFactory] Converting PDF with options:', {
        useOcr: options.useOcr,
        hasMistralApiKey: !!options.mistralApiKey,
        forceOcr: options.forceOcr,
        forceStandard: options.forceStandard
      });

      // If Mistral API key is provided in options, set it on the converter
      if (options.mistralApiKey && this.mistralConverter) {
        console.log('[PdfConverterFactory] Setting Mistral API key from options');
        this.mistralConverter.setApiKey(options.mistralApiKey);
      }
      const converter = await this.getConverter(filePath, options);

      // Log which converter we're using
      console.log(`[PdfConverterFactory] Using converter: ${converter.name}`);

      // Use the appropriate conversion method
      return await converter.handleConvert(event, {
        filePath,
        options
      });
    } catch (error) {
      console.error('[PdfConverterFactory] Conversion failed:', error);
      throw error;
    }
  }

  /**
   * Get PDF metadata
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} request - Metadata request
   * @returns {Promise<Object>} PDF metadata
   */
  async getPdfMetadata(event, {
    filePath
  }) {
    try {
      // For metadata, we can always use the standard converter
      return await this.standardConverter.handleGetMetadata(event, {
        filePath
      });
    } catch (error) {
      console.error('[PdfConverterFactory] Failed to get metadata:', error);
      throw error;
    }
  }

  /**
   * Check if this factory supports the given file
   * @param {string} filePath - Path to file
   * @returns {boolean} True if supported
   */
  supportsFile(filePath) {
    const ext = path.extname(filePath).toLowerCase();
    return this.supportedExtensions.includes(ext);
  }

  /**
   * Get factory information
   * @returns {Object} Factory details
   */
  getInfo() {
    return {
      name: 'PDF Converter Factory',
      extensions: this.supportedExtensions,
      description: 'Factory for PDF converters with automatic selection',
      converters: [this.standardConverter.getInfo(), this.mistralConverter.getInfo()],
      options: {
        forceOcr: 'Force use of OCR converter',
        forceStandard: 'Force use of standard converter'
      }
    };
  }
}
module.exports = PdfConverterFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImZzIiwiU3RhbmRhcmRQZGZDb252ZXJ0ZXIiLCJNaXN0cmFsUGRmQ29udmVydGVyIiwiUGRmQ29udmVydGVyRmFjdG9yeSIsImNvbnN0cnVjdG9yIiwiZmlsZVByb2Nlc3NvciIsImZpbGVTdG9yYWdlIiwic3VwcG9ydGVkRXh0ZW5zaW9ucyIsInN0YW5kYXJkQ29udmVydGVyIiwibWlzdHJhbENvbnZlcnRlciIsImdldENvbnZlcnRlciIsImZpbGVQYXRoIiwib3B0aW9ucyIsImNvbnNvbGUiLCJsb2ciLCJjcmVhdGVDb252ZXJ0ZXJXcmFwcGVyIiwiY29udmVydGVyIiwiY29udmVydCIsImNvbnRlbnQiLCJuYW1lIiwiYXBpS2V5IiwiY29udmVydFRvTWFya2Rvd24iLCJ1c2VPY3IiLCJvY3JDaGVjayIsImlzT2NyQXZhaWxhYmxlIiwibWlzdHJhbEFwaUtleSIsImF2YWlsYWJsZSIsInJlYXNvbiIsImluY2x1ZGVzIiwid2FybiIsImZvcmNlT2NyIiwiZm9yY2VTdGFuZGFyZCIsIm5lZWRzT2NyIiwiYW5hbHl6ZU5lZWRzT2NyIiwiZXJyb3IiLCJzZXRBcGlLZXkiLCJ0cmltIiwibGVuZ3RoIiwicmVzdWx0IiwiaGFuZGxlQ2hlY2tBcGlLZXkiLCJ2YWxpZCIsIm1lc3NhZ2UiLCJwZGZEYXRhIiwicmVhZEZpbGUiLCJwZGZQYXJzZSIsImRhdGEiLCJ0ZXh0TGVuZ3RoIiwidGV4dCIsInBhZ2VDb3VudCIsIm51bXBhZ2VzIiwiYXZnVGV4dFBlclBhZ2UiLCJ0b0ZpeGVkIiwiaGFzU2Nhbm5lZEluZGljYXRvcnMiLCJjaGVja0ZvclNjYW5uZWRJbmRpY2F0b3JzIiwiaW5kaWNhdG9ycyIsImxvd2VyVGV4dCIsInRvTG93ZXJDYXNlIiwic29tZSIsImluZGljYXRvciIsImNvbnZlcnRQZGYiLCJldmVudCIsImhhc01pc3RyYWxBcGlLZXkiLCJoYW5kbGVDb252ZXJ0IiwiZ2V0UGRmTWV0YWRhdGEiLCJoYW5kbGVHZXRNZXRhZGF0YSIsInN1cHBvcnRzRmlsZSIsImV4dCIsImV4dG5hbWUiLCJnZXRJbmZvIiwiZXh0ZW5zaW9ucyIsImRlc2NyaXB0aW9uIiwiY29udmVydGVycyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZWxlY3Ryb24vc2VydmljZXMvY29udmVyc2lvbi9kb2N1bWVudC9QZGZDb252ZXJ0ZXJGYWN0b3J5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBQZGZDb252ZXJ0ZXJGYWN0b3J5LmpzXHJcbiAqIEZhY3RvcnkgZm9yIGNyZWF0aW5nIGFwcHJvcHJpYXRlIFBERiBjb252ZXJ0ZXJzIGJhc2VkIG9uIGZpbGUgYW5kIG9wdGlvbnMuXHJcbiAqIFxyXG4gKiBUaGlzIGZhY3Rvcnk6XHJcbiAqIC0gQW5hbHl6ZXMgUERGIGZpbGVzIHRvIGRldGVybWluZSB0aGUgYmVzdCBjb252ZXJzaW9uIGFwcHJvYWNoXHJcbiAqIC0gQ3JlYXRlcyBpbnN0YW5jZXMgb2YgYXBwcm9wcmlhdGUgUERGIGNvbnZlcnRlcnNcclxuICogLSBQcm92aWRlcyBhIHVuaWZpZWQgaW50ZXJmYWNlIGZvciBQREYgY29udmVyc2lvblxyXG4gKiAtIEhhbmRsZXMgZmFsbGJhY2sgYmV0d2VlbiBkaWZmZXJlbnQgY29udmVyc2lvbiBtZXRob2RzXHJcbiAqIFxyXG4gKiBSZWxhdGVkIEZpbGVzOlxyXG4gKiAtIEJhc2VQZGZDb252ZXJ0ZXIuanM6IEJhc2UgY2xhc3MgZm9yIFBERiBjb252ZXJ0ZXJzXHJcbiAqIC0gU3RhbmRhcmRQZGZDb252ZXJ0ZXIuanM6IFRleHQtYmFzZWQgUERGIGNvbnZlcnRlclxyXG4gKiAtIE1pc3RyYWxQZGZDb252ZXJ0ZXIuanM6IE9DUi1iYXNlZCBQREYgY29udmVydGVyXHJcbiAqIC0gQ29udmVyc2lvblNlcnZpY2UuanM6IFVzZXMgdGhpcyBmYWN0b3J5IGZvciBQREYgY29udmVyc2lvblxyXG4gKi9cclxuXHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMtZXh0cmEnKTtcclxuY29uc3QgU3RhbmRhcmRQZGZDb252ZXJ0ZXIgPSByZXF1aXJlKCcuL1N0YW5kYXJkUGRmQ29udmVydGVyJyk7XHJcbmNvbnN0IE1pc3RyYWxQZGZDb252ZXJ0ZXIgPSByZXF1aXJlKCcuL01pc3RyYWxQZGZDb252ZXJ0ZXInKTtcclxuXHJcbmNsYXNzIFBkZkNvbnZlcnRlckZhY3Rvcnkge1xyXG4gICAgY29uc3RydWN0b3IoZmlsZVByb2Nlc3NvciwgZmlsZVN0b3JhZ2UpIHtcclxuICAgICAgICB0aGlzLmZpbGVQcm9jZXNzb3IgPSBmaWxlUHJvY2Vzc29yO1xyXG4gICAgICAgIHRoaXMuZmlsZVN0b3JhZ2UgPSBmaWxlU3RvcmFnZTtcclxuICAgICAgICB0aGlzLnN1cHBvcnRlZEV4dGVuc2lvbnMgPSBbJy5wZGYnXTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgY29udmVydGVyIGluc3RhbmNlcyAtIHBhc3MgdHJ1ZSBmb3Igc2tpcEhhbmRsZXJTZXR1cFxyXG4gICAgICAgIC8vIFRoaXMgcHJldmVudHMgZHVwbGljYXRlIElQQyBoYW5kbGVyIHJlZ2lzdHJhdGlvbiB3aGVuIHVzZWQgdGhyb3VnaCB0aGUgZmFjdG9yeVxyXG4gICAgICAgIHRoaXMuc3RhbmRhcmRDb252ZXJ0ZXIgPSBuZXcgU3RhbmRhcmRQZGZDb252ZXJ0ZXIoZmlsZVByb2Nlc3NvciwgZmlsZVN0b3JhZ2UsIHRydWUpO1xyXG4gICAgICAgIHRoaXMubWlzdHJhbENvbnZlcnRlciA9IG5ldyBNaXN0cmFsUGRmQ29udmVydGVyKGZpbGVQcm9jZXNzb3IsIGZpbGVTdG9yYWdlLCBudWxsLCB0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCBhcHByb3ByaWF0ZSBjb252ZXJ0ZXIgZm9yIFBERiBmaWxlXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsZVBhdGggLSBQYXRoIHRvIFBERiBmaWxlXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIENvbnZlcnNpb24gb3B0aW9uc1xyXG4gICAgICogQHJldHVybnMge09iamVjdH0gQXBwcm9wcmlhdGUgUERGIGNvbnZlcnRlciB3aXRoIGNvbnZlcnQgbWV0aG9kXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGdldENvbnZlcnRlcihmaWxlUGF0aCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBHZXR0aW5nIGNvbnZlcnRlciBmb3IgUERGIGZpbGUnKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgYSB3cmFwcGVyIG9iamVjdCB0aGF0IGV4cG9zZXMgdGhlIGNvbnZlcnQgbWV0aG9kXHJcbiAgICAgICAgY29uc3QgY3JlYXRlQ29udmVydGVyV3JhcHBlciA9IChjb252ZXJ0ZXIpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGNvbnZlcnQ6IGFzeW5jIChjb250ZW50LCBuYW1lLCBhcGlLZXksIG9wdGlvbnMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW1BkZkNvbnZlcnRlckZhY3RvcnldIFVzaW5nICR7Y29udmVydGVyLm5hbWV9IGZvciBjb252ZXJzaW9uYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGNvbnZlcnRlci5jb252ZXJ0VG9NYXJrZG93bihjb250ZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUtleVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgT0NSIGlzIGV4cGxpY2l0bHkgZW5hYmxlZCBpbiBvcHRpb25zXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBDaGVja2luZyBpZiBPQ1IgaXMgZW5hYmxlZCBpbiBvcHRpb25zOicsIG9wdGlvbnMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBbUGRmQ29udmVydGVyRmFjdG9yeV0gb3B0aW9ucy51c2VPY3IgPSAke29wdGlvbnMudXNlT2NyfSAodHlwZTogJHt0eXBlb2Ygb3B0aW9ucy51c2VPY3J9KWApO1xyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy51c2VPY3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBVc2luZyBPQ1IgY29udmVydGVyIChlbmFibGVkIGluIHNldHRpbmdzKScpO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgT0NSIGlzIGF2YWlsYWJsZSB1c2luZyB0aGUgQVBJIGtleSBwcm92aWRlZCBpbiBvcHRpb25zXHJcbiAgICAgICAgICAgIGNvbnN0IG9jckNoZWNrID0gYXdhaXQgdGhpcy5pc09jckF2YWlsYWJsZShvcHRpb25zLm1pc3RyYWxBcGlLZXkpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW1BkZkNvbnZlcnRlckZhY3RvcnldIE9DUiBhdmFpbGFiaWxpdHkgY2hlY2s6YCwgb2NyQ2hlY2spO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFvY3JDaGVjay5hdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbUGRmQ29udmVydGVyRmFjdG9yeV0gT0NSIG5vdCBhdmFpbGFibGU6ICR7b2NyQ2hlY2sucmVhc29ufSwgdXNpbmcgc3RhbmRhcmQgY29udmVydGVyYCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUHJvdmlkZSBkZXRhaWxlZCB3YXJuaW5nIGluIHRoZSBsb2cgYWJvdXQgd2h5IE9DUiBpcyBub3QgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgICAgICBpZiAob2NyQ2hlY2sucmVhc29uLmluY2x1ZGVzKCdBUEkga2V5JykpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBXQVJOSU5HOiBPQ1Igd2FzIHJlcXVlc3RlZCBidXQgQVBJIGtleSBpcyBpbnZhbGlkIG9yIG1pc3NpbmcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlQ29udmVydGVyV3JhcHBlcih0aGlzLnN0YW5kYXJkQ29udmVydGVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBPQ1IgaXMgYXZhaWxhYmxlLCB1c2luZyBNaXN0cmFsIGNvbnZlcnRlcicpO1xyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlQ29udmVydGVyV3JhcHBlcih0aGlzLm1pc3RyYWxDb252ZXJ0ZXIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gT0NSIGlzIG5vdCBlbmFibGVkIGluIG9wdGlvbnMsIGNoZWNraW5nIG90aGVyIGNvbmRpdGlvbnMnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSWYgZm9yY2Ugb3B0aW9uIGlzIHNwZWNpZmllZCwgdXNlIHRoZSByZXF1ZXN0ZWQgY29udmVydGVyXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZm9yY2VPY3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBVc2luZyBPQ1IgY29udmVydGVyIChmb3JjZWQpJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVDb252ZXJ0ZXJXcmFwcGVyKHRoaXMubWlzdHJhbENvbnZlcnRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChvcHRpb25zLmZvcmNlU3RhbmRhcmQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBVc2luZyBzdGFuZGFyZCBjb252ZXJ0ZXIgKGZvcmNlZCknKTtcclxuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNvbnZlcnRlcldyYXBwZXIodGhpcy5zdGFuZGFyZENvbnZlcnRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENoZWNrIGlmIE9DUiBpcyBhdmFpbGFibGUgdXNpbmcgYW55IHByb3ZpZGVkIEFQSSBrZXlcclxuICAgICAgICBjb25zdCBvY3JDaGVjayA9IGF3YWl0IHRoaXMuaXNPY3JBdmFpbGFibGUob3B0aW9ucy5taXN0cmFsQXBpS2V5KTtcclxuICAgICAgICBpZiAoIW9jckNoZWNrLmF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW1BkZkNvbnZlcnRlckZhY3RvcnldIE9DUiBub3QgYXZhaWxhYmxlOiAke29jckNoZWNrLnJlYXNvbn0sIHVzaW5nIHN0YW5kYXJkIGNvbnZlcnRlcmApO1xyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlQ29udmVydGVyV3JhcHBlcih0aGlzLnN0YW5kYXJkQ29udmVydGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQW5hbHl6ZSBQREYgdG8gZGV0ZXJtaW5lIGlmIE9DUiBpcyBuZWVkZWRcclxuICAgICAgICBjb25zdCBuZWVkc09jciA9IGF3YWl0IHRoaXMuYW5hbHl6ZU5lZWRzT2NyKGZpbGVQYXRoKTtcclxuICAgICAgICBpZiAobmVlZHNPY3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBQREYgYW5hbHlzaXMgc3VnZ2VzdHMgT0NSIGlzIG5lZWRlZCcpO1xyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlQ29udmVydGVyV3JhcHBlcih0aGlzLm1pc3RyYWxDb252ZXJ0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zb2xlLmxvZygnW1BkZkNvbnZlcnRlckZhY3RvcnldIFVzaW5nIHN0YW5kYXJkIGNvbnZlcnRlciBiYXNlZCBvbiBhbmFseXNpcycpO1xyXG4gICAgICAgIHJldHVybiBjcmVhdGVDb252ZXJ0ZXJXcmFwcGVyKHRoaXMuc3RhbmRhcmRDb252ZXJ0ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2sgaWYgT0NSIGlzIGF2YWlsYWJsZVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGFwaUtleSAtIE9wdGlvbmFsIEFQSSBrZXkgdG8gY2hlY2sgKHdpbGwgdXNlIGN1cnJlbnQga2V5IGlmIG5vdCBwcm92aWRlZClcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHthdmFpbGFibGU6IGJvb2xlYW4sIHJlYXNvbjogc3RyaW5nfT59IEF2YWlsYWJpbGl0eSBzdGF0dXMgYW5kIHJlYXNvblxyXG4gICAgICovXHJcbiAgICBhc3luYyBpc09jckF2YWlsYWJsZShhcGlLZXkgPSBudWxsKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBDaGVja2luZyBPQ1IgYXZhaWxhYmlsaXR5Jyk7XHJcblxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBtaXN0cmFsQ29udmVydGVyIGlzIGluaXRpYWxpemVkXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5taXN0cmFsQ29udmVydGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gTWlzdHJhbFBkZkNvbnZlcnRlciBub3QgaW5pdGlhbGl6ZWQnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICByZWFzb246ICdNaXN0cmFsIE9DUiBjb252ZXJ0ZXIgbm90IGluaXRpYWxpemVkJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSWYgYW4gQVBJIGtleSB3YXMgcHJvdmlkZWQsIHRlbXBvcmFyaWx5IHNldCBpdCBmb3IgdGhlIGNoZWNrXHJcbiAgICAgICAgICAgIGlmIChhcGlLZXkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWlzdHJhbENvbnZlcnRlci5zZXRBcGlLZXkoYXBpS2V5KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgQVBJIGtleSBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKCF0aGlzLm1pc3RyYWxDb252ZXJ0ZXIuYXBpS2V5KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1BkZkNvbnZlcnRlckZhY3RvcnldIE5vIE1pc3RyYWwgQVBJIGtleSBmb3VuZCBpbiBjb252ZXJ0ZXInKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICByZWFzb246ICdObyBNaXN0cmFsIEFQSSBrZXkgcHJvdmlkZWQnXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBCYXNpYyBrZXkgZm9ybWF0IHZhbGlkYXRpb25cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm1pc3RyYWxDb252ZXJ0ZXIuYXBpS2V5ICE9PSAnc3RyaW5nJyB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5taXN0cmFsQ29udmVydGVyLmFwaUtleS50cmltKCkubGVuZ3RoIDwgMTApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gSW52YWxpZCBNaXN0cmFsIEFQSSBrZXkgZm9ybWF0Jyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnSW52YWxpZCBNaXN0cmFsIEFQSSBrZXkgZm9ybWF0J1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBDYWxsaW5nIGhhbmRsZUNoZWNrQXBpS2V5Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWlzdHJhbENvbnZlcnRlci5oYW5kbGVDaGVja0FwaUtleSgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW1BkZkNvbnZlcnRlckZhY3RvcnldIE9DUiBhdmFpbGFiaWxpdHkgY2hlY2sgcmVzdWx0OicsIHJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICByZWFzb246ICdNaXN0cmFsIEFQSSBrZXkgaXMgdmFsaWQnXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlYXNvbjogcmVzdWx0LmVycm9yIHx8ICdJbnZhbGlkIE1pc3RyYWwgQVBJIGtleSdcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gRXJyb3IgY2hlY2tpbmcgT0NSIGF2YWlsYWJpbGl0eTonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhdmFpbGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVhc29uOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBjaGVja2luZyBPQ1IgYXZhaWxhYmlsaXR5J1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFuYWx5emUgUERGIHRvIGRldGVybWluZSBpZiBPQ1IgaXMgbmVlZGVkXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsZVBhdGggLSBQYXRoIHRvIFBERiBmaWxlXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBPQ1IgaXMgcmVjb21tZW5kZWRcclxuICAgICAqL1xyXG4gICAgYXN5bmMgYW5hbHl6ZU5lZWRzT2NyKGZpbGVQYXRoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gRXh0cmFjdCB0ZXh0IHVzaW5nIHN0YW5kYXJkIGNvbnZlcnRlclxyXG4gICAgICAgICAgICBjb25zdCBwZGZEYXRhID0gYXdhaXQgZnMucmVhZEZpbGUoZmlsZVBhdGgpO1xyXG4gICAgICAgICAgICBjb25zdCBwZGZQYXJzZSA9IHJlcXVpcmUoJ3BkZi1wYXJzZScpO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcGRmUGFyc2UocGRmRGF0YSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0ZXh0IGV4dHJhY3Rpb24geWllbGRlZCBtZWFuaW5nZnVsIHJlc3VsdHNcclxuICAgICAgICAgICAgY29uc3QgdGV4dExlbmd0aCA9IGRhdGEudGV4dC50cmltKCkubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBwYWdlQ291bnQgPSBkYXRhLm51bXBhZ2VzO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGF2ZXJhZ2UgdGV4dCBwZXIgcGFnZVxyXG4gICAgICAgICAgICBjb25zdCBhdmdUZXh0UGVyUGFnZSA9IHRleHRMZW5ndGggLyBwYWdlQ291bnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiB2ZXJ5IGxpdHRsZSB0ZXh0IHdhcyBleHRyYWN0ZWQsIE9DUiBtaWdodCBiZSBuZWVkZWRcclxuICAgICAgICAgICAgaWYgKGF2Z1RleHRQZXJQYWdlIDwgMTAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW1BkZkNvbnZlcnRlckZhY3RvcnldIExvdyB0ZXh0IGNvbnRlbnQgZGV0ZWN0ZWQgKCR7YXZnVGV4dFBlclBhZ2UudG9GaXhlZCgyKX0gY2hhcnMvcGFnZSksIHN1Z2dlc3RpbmcgT0NSYCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHNjYW5uZWQgZG9jdW1lbnQgaW5kaWNhdG9yc1xyXG4gICAgICAgICAgICBjb25zdCBoYXNTY2FubmVkSW5kaWNhdG9ycyA9IHRoaXMuY2hlY2tGb3JTY2FubmVkSW5kaWNhdG9ycyhkYXRhLnRleHQpO1xyXG4gICAgICAgICAgICBpZiAoaGFzU2Nhbm5lZEluZGljYXRvcnMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gU2Nhbm5lZCBkb2N1bWVudCBpbmRpY2F0b3JzIGRldGVjdGVkLCBzdWdnZXN0aW5nIE9DUicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gRXJyb3IgYW5hbHl6aW5nIFBERjonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIC8vIElmIGFuYWx5c2lzIGZhaWxzLCBkZWZhdWx0IHRvIHN0YW5kYXJkIGNvbnZlcnRlclxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2sgZm9yIGluZGljYXRvcnMgdGhhdCBhIGRvY3VtZW50IGlzIHNjYW5uZWRcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gRXh0cmFjdGVkIHRleHRcclxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHNjYW5uZWQgaW5kaWNhdG9ycyBhcmUgZm91bmRcclxuICAgICAqL1xyXG4gICAgY2hlY2tGb3JTY2FubmVkSW5kaWNhdG9ycyh0ZXh0KSB7XHJcbiAgICAgICAgLy8gQ29tbW9uIGluZGljYXRvcnMgaW4gc2Nhbm5lZCBkb2N1bWVudHNcclxuICAgICAgICBjb25zdCBpbmRpY2F0b3JzID0gW1xyXG4gICAgICAgICAgICAnc2Nhbm5lZCcsXHJcbiAgICAgICAgICAgICdzY2FuJyxcclxuICAgICAgICAgICAgJ29jcicsXHJcbiAgICAgICAgICAgICdpbWFnZScsXHJcbiAgICAgICAgICAgICdkaWdpdGl6ZWQnLFxyXG4gICAgICAgICAgICAnZGlnaXRpc2VkJ1xyXG4gICAgICAgIF07XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgbG93ZXJUZXh0ID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHJldHVybiBpbmRpY2F0b3JzLnNvbWUoaW5kaWNhdG9yID0+IGxvd2VyVGV4dC5pbmNsdWRlcyhpbmRpY2F0b3IpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbnZlcnQgUERGIGZpbGUgdG8gbWFya2Rvd25cclxuICAgICAqIEBwYXJhbSB7RWxlY3Ryb24uSXBjTWFpbkludm9rZUV2ZW50fSBldmVudCAtIElQQyBldmVudFxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3QgLSBDb252ZXJzaW9uIHJlcXVlc3RcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IENvbnZlcnNpb24gcmVzdWx0XHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGNvbnZlcnRQZGYoZXZlbnQsIHsgZmlsZVBhdGgsIG9wdGlvbnMgPSB7fSB9KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQZGZDb252ZXJ0ZXJGYWN0b3J5XSBDb252ZXJ0aW5nIFBERiB3aXRoIG9wdGlvbnM6Jywge1xyXG4gICAgICAgICAgICAgICAgdXNlT2NyOiBvcHRpb25zLnVzZU9jcixcclxuICAgICAgICAgICAgICAgIGhhc01pc3RyYWxBcGlLZXk6ICEhb3B0aW9ucy5taXN0cmFsQXBpS2V5LFxyXG4gICAgICAgICAgICAgICAgZm9yY2VPY3I6IG9wdGlvbnMuZm9yY2VPY3IsXHJcbiAgICAgICAgICAgICAgICBmb3JjZVN0YW5kYXJkOiBvcHRpb25zLmZvcmNlU3RhbmRhcmRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiBNaXN0cmFsIEFQSSBrZXkgaXMgcHJvdmlkZWQgaW4gb3B0aW9ucywgc2V0IGl0IG9uIHRoZSBjb252ZXJ0ZXJcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWlzdHJhbEFwaUtleSAmJiB0aGlzLm1pc3RyYWxDb252ZXJ0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gU2V0dGluZyBNaXN0cmFsIEFQSSBrZXkgZnJvbSBvcHRpb25zJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1pc3RyYWxDb252ZXJ0ZXIuc2V0QXBpS2V5KG9wdGlvbnMubWlzdHJhbEFwaUtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnZlcnRlciA9IGF3YWl0IHRoaXMuZ2V0Q29udmVydGVyKGZpbGVQYXRoLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIExvZyB3aGljaCBjb252ZXJ0ZXIgd2UncmUgdXNpbmdcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYFtQZGZDb252ZXJ0ZXJGYWN0b3J5XSBVc2luZyBjb252ZXJ0ZXI6ICR7Y29udmVydGVyLm5hbWV9YCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBVc2UgdGhlIGFwcHJvcHJpYXRlIGNvbnZlcnNpb24gbWV0aG9kXHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBjb252ZXJ0ZXIuaGFuZGxlQ29udmVydChldmVudCwgeyBmaWxlUGF0aCwgb3B0aW9ucyB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbUGRmQ29udmVydGVyRmFjdG9yeV0gQ29udmVyc2lvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgUERGIG1ldGFkYXRhXHJcbiAgICAgKiBAcGFyYW0ge0VsZWN0cm9uLklwY01haW5JbnZva2VFdmVudH0gZXZlbnQgLSBJUEMgZXZlbnRcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0IC0gTWV0YWRhdGEgcmVxdWVzdFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gUERGIG1ldGFkYXRhXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGdldFBkZk1ldGFkYXRhKGV2ZW50LCB7IGZpbGVQYXRoIH0pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBGb3IgbWV0YWRhdGEsIHdlIGNhbiBhbHdheXMgdXNlIHRoZSBzdGFuZGFyZCBjb252ZXJ0ZXJcclxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc3RhbmRhcmRDb252ZXJ0ZXIuaGFuZGxlR2V0TWV0YWRhdGEoZXZlbnQsIHsgZmlsZVBhdGggfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1BkZkNvbnZlcnRlckZhY3RvcnldIEZhaWxlZCB0byBnZXQgbWV0YWRhdGE6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVjayBpZiB0aGlzIGZhY3Rvcnkgc3VwcG9ydHMgdGhlIGdpdmVuIGZpbGVcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlUGF0aCAtIFBhdGggdG8gZmlsZVxyXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgc3VwcG9ydGVkXHJcbiAgICAgKi9cclxuICAgIHN1cHBvcnRzRmlsZShmaWxlUGF0aCkge1xyXG4gICAgICAgIGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShmaWxlUGF0aCkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zLmluY2x1ZGVzKGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgZmFjdG9yeSBpbmZvcm1hdGlvblxyXG4gICAgICogQHJldHVybnMge09iamVjdH0gRmFjdG9yeSBkZXRhaWxzXHJcbiAgICAgKi9cclxuICAgIGdldEluZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogJ1BERiBDb252ZXJ0ZXIgRmFjdG9yeScsXHJcbiAgICAgICAgICAgIGV4dGVuc2lvbnM6IHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucyxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdGYWN0b3J5IGZvciBQREYgY29udmVydGVycyB3aXRoIGF1dG9tYXRpYyBzZWxlY3Rpb24nLFxyXG4gICAgICAgICAgICBjb252ZXJ0ZXJzOiBbXHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YW5kYXJkQ29udmVydGVyLmdldEluZm8oKSxcclxuICAgICAgICAgICAgICAgIHRoaXMubWlzdHJhbENvbnZlcnRlci5nZXRJbmZvKClcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgZm9yY2VPY3I6ICdGb3JjZSB1c2Ugb2YgT0NSIGNvbnZlcnRlcicsXHJcbiAgICAgICAgICAgICAgICBmb3JjZVN0YW5kYXJkOiAnRm9yY2UgdXNlIG9mIHN0YW5kYXJkIGNvbnZlcnRlcidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUGRmQ29udmVydGVyRmFjdG9yeTsiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU1DLEVBQUUsR0FBR0QsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUM5QixNQUFNRSxvQkFBb0IsR0FBR0YsT0FBTyxDQUFDLHdCQUF3QixDQUFDO0FBQzlELE1BQU1HLG1CQUFtQixHQUFHSCxPQUFPLENBQUMsdUJBQXVCLENBQUM7QUFFNUQsTUFBTUksbUJBQW1CLENBQUM7RUFDdEJDLFdBQVdBLENBQUNDLGFBQWEsRUFBRUMsV0FBVyxFQUFFO0lBQ3BDLElBQUksQ0FBQ0QsYUFBYSxHQUFHQSxhQUFhO0lBQ2xDLElBQUksQ0FBQ0MsV0FBVyxHQUFHQSxXQUFXO0lBQzlCLElBQUksQ0FBQ0MsbUJB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