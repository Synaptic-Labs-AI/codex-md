"use strict";

/**
 * MistralPdfConverter.js
 * Handles conversion of PDF files to markdown using Mistral OCR.
 * 
 * This converter:
 * - Uses Mistral AI for OCR processing of PDF documents
 * - Handles scanned documents and images within PDFs
 * - Extracts text that standard PDF parsers might miss
 * - Creates structured markdown with high-quality text extraction
 * 
 * Related Files:
 * - BasePdfConverter.js: Parent class with common PDF functionality
 * - StandardPdfConverter.js: Alternative text-based converter
 * - FileStorageService.js: For temporary file management
 * - PdfConverterFactory.js: Factory for selecting appropriate converter
 */

const path = require('path');
const fs = require('fs-extra');
const BasePdfConverter = require('./BasePdfConverter');
const mistral = require('./mistral');
class MistralPdfConverter extends BasePdfConverter {
  constructor(fileProcessor, fileStorage, unusedParam, skipHandlerSetup = false) {
    super(fileProcessor, fileStorage);
    this.name = 'Mistral PDF Converter';
    this.description = 'Converts PDF files to markdown using Mistral OCR';
    this.skipHandlerSetup = skipHandlerSetup;

    // Initialize modular components
    this.apiClient = new mistral.MistralApiClient({
      apiEndpoint: process.env.MISTRAL_API_ENDPOINT,
      apiKey: process.env.MISTRAL_API_KEY
    });
    this.ocrProcessor = new mistral.OcrProcessor();
    this.markdownGenerator = new mistral.MarkdownGenerator();
    this.conversionManager = new mistral.ConversionManager({
      fileProcessor,
      fileStorage
    });

    // Set the API key in the conversion manager
    this.conversionManager.setApiKey(process.env.MISTRAL_API_KEY);

    // Log whether handlers will be set up
    if (skipHandlerSetup) {
      console.log('[MistralPdfConverter] Skipping handler setup (skipHandlerSetup=true)');
    } else {
      // Instead of relying on BaseService's setTimeout approach, call setupIpcHandlers directly
      // This ensures we only set up handlers once and explicitly when skipHandlerSetup is false
      this.setupIpcHandlers();
    }
  }

  /**
   * Set up IPC handlers for PDF conversion
   */
  setupIpcHandlers() {
    // If skipHandlerSetup was specified, don't register handlers
    if (this.skipHandlerSetup) {
      console.log('[MistralPdfConverter] Skipping IPC handler setup due to skipHandlerSetup flag');
      return;
    }
    console.log('[MistralPdfConverter] Setting up IPC handlers');

    // Use try-catch to handle cases where handlers are already registered
    try {
      this.registerHandler('convert:pdf:ocr', this.handleConvert.bind(this));
      this.registerHandler('convert:pdf:ocr:metadata', this.handleGetMetadata.bind(this));
      this.registerHandler('convert:pdf:ocr:check', this.handleCheckApiKey.bind(this));
      console.log('[MistralPdfConverter] IPC handlers registered');
    } catch (error) {
      // If a handler is already registered, log the error but don't crash
      console.warn(`[MistralPdfConverter] Error in setupIpcHandlers: ${error.message}`);
    }
  }

  /**
   * Set API key for Mistral API
   * @param {string} apiKey - API key
   */
  setApiKey(apiKey) {
    this.apiClient.setApiKey(apiKey);
    this.conversionManager.setApiKey(apiKey);
  }

  /**
   * Get the API key
   * @returns {string|null} API key or null if not set
   */
  get apiKey() {
    return this.apiClient.apiKey;
  }

  /**
   * Set the API key
   * @param {string} value - The API key to set
   */
  set apiKey(value) {
    this.setApiKey(value);
  }

  /**
   * Handle PDF conversion request
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} request - Conversion request details
   */
  async handleConvert(event, {
    filePath,
    options = {}
  }) {
    try {
      console.log('[MistralPdfConverter] handleConvert called with options:', {
        hasApiKey: !!this.apiClient.apiKey,
        hasOptionsApiKey: !!options.mistralApiKey,
        fileName: options.name || path.basename(filePath)
      });

      // Use API key from options if available
      if (options.mistralApiKey) {
        console.log('[MistralPdfConverter] Using API key from options');
        this.setApiKey(options.mistralApiKey);
      }

      // Start the conversion using the ConversionManager
      return await this.conversionManager.startConversion({
        filePath,
        options,
        window: event.sender.getOwnerBrowserWindow()
      });
    } catch (error) {
      console.error('[MistralPdfConverter] Failed to start conversion:', error);
      throw error;
    }
  }

  /**
   * Handle PDF metadata request
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} request - Metadata request details
   */
  async handleGetMetadata(event, {
    filePath
  }) {
    try {
      // For metadata, we can use the standard PDF parser
      const standardConverter = new (require('./StandardPdfConverter'))(this.fileProcessor, this.fileStorage);
      const metadata = await standardConverter.extractMetadata(filePath);
      return metadata;
    } catch (error) {
      console.error('[MistralPdfConverter] Failed to get metadata:', error);
      throw error;
    }
  }

  /**
   * Handle API key check request
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} options - Options including API key
   */
  async handleCheckApiKey(event, options = {}) {
    try {
      // If API key provided in options, use it for the check
      const apiKey = options?.apiKey || this.apiClient.apiKey;
      return await this.conversionManager.checkApiKey(apiKey);
    } catch (error) {
      console.error('[MistralPdfConverter] API key check failed:', error);
      return {
        valid: false,
        error: error.message
      };
    }
  }

  /**
   * Convert PDF content to markdown - direct method for ConverterRegistry
   * @param {Buffer} content - PDF content as buffer
   * @param {Object} options - Conversion options
   * @returns {Promise<Object>} Conversion result
   */
  async convertToMarkdown(content, options = {}) {
    try {
      console.log(`[MistralPdfConverter] Converting PDF with OCR: ${options.name || 'unnamed'}`);

      // Use API key from options if provided
      if (options.apiKey || options.mistralApiKey) {
        const apiKey = options.apiKey || options.mistralApiKey;
        this.setApiKey(apiKey);
      }

      // Validate that we have an API key
      if (!this.apiClient.apiKey) {
        throw new Error('Missing Mistral API key. Please add your API key in the settings page.');
      }

      // Validate the API key format (basic validation)
      if (typeof this.apiClient.apiKey !== 'string' || this.apiClient.apiKey.trim().length < 10) {
        throw new Error('Invalid Mistral API key format. Please check your API key in settings.');
      }
      console.log(`[MistralPdfConverter] Using API key: ${this.apiClient.apiKey ? '✓ (valid format)' : '✗ (invalid format)'}`);

      // Use the ConversionManager to handle the actual conversion
      return await this.conversionManager.convertToMarkdown(content, options);
    } catch (error) {
      console.error('[MistralPdfConverter] Direct conversion failed:', error);

      // Check for specific API key errors
      if (error.message.includes('API key') || error.message.includes('Unauthorized') || error.message.includes('401')) {
        return {
          success: false,
          error: `PDF OCR conversion failed: ${error.message}`,
          errorDetails: 'API Key Error: Please check your Mistral API key in settings.',
          content: `# Conversion Error\n\nFailed to convert PDF with OCR: Invalid or missing Mistral API key.\n\n## How to Fix\n\n1. Go to Settings\n2. Add a valid Mistral API key\n3. Try the conversion again`
        };
      }

      // Create a more detailed error message
      const errorDetails = error.response ? `API response: ${JSON.stringify(error.response.data || {})}` : error.message;
      return {
        success: false,
        error: `PDF OCR conversion failed: ${error.message}`,
        errorDetails: errorDetails,
        content: `# Conversion Error\n\nFailed to convert PDF with OCR: ${error.message}\n\n## Error Details\n\n${errorDetails}`
      };
    }
  }

  /**
   * Get converter information
   * @returns {Object} Converter details
   */
  getInfo() {
    return {
      name: this.name,
      extensions: this.supportedExtensions,
      description: this.description,
      options: {
        title: 'Optional document title',
        model: 'OCR model to use (default: mistral-ocr-latest)',
        language: 'Language hint for OCR (optional)',
        maxPages: 'Maximum pages to convert (default: all)'
      }
    };
  }
}
module.exports = MistralPdfConverter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImZzIiwiQmFzZVBkZkNvbnZlcnRlciIsIm1pc3RyYWwiLCJNaXN0cmFsUGRmQ29udmVydGVyIiwiY29uc3RydWN0b3IiLCJmaWxlUHJvY2Vzc29yIiwiZmlsZVN0b3JhZ2UiLCJ1bnVzZWRQYXJhbSIsInNraXBIYW5kbGVyU2V0dXAiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJhcGlDbGllbnQiLCJNaXN0cmFsQXBpQ2xpZW50IiwiYXBpRW5kcG9pbnQiLCJwcm9jZXNzIiwiZW52IiwiTUlTVFJBTF9BUElfRU5EUE9JTlQiLCJhcGlLZXkiLCJNSVNUUkFMX0FQSV9LRVkiLCJvY3JQcm9jZXNzb3IiLCJPY3JQcm9jZXNzb3IiLCJtYXJrZG93bkdlbmVyYXRvciIsIk1hcmtkb3duR2VuZXJhdG9yIiwiY29udmVyc2lvbk1hbmFnZXIiLCJDb252ZXJzaW9uTWFuYWdlciIsInNldEFwaUtleSIsImNvbnNvbGUiLCJsb2ciLCJzZXR1cElwY0hhbmRsZXJzIiwicmVnaXN0ZXJIYW5kbGVyIiwiaGFuZGxlQ29udmVydCIsImJpbmQiLCJoYW5kbGVHZXRNZXRhZGF0YSIsImhhbmRsZUNoZWNrQXBpS2V5IiwiZXJyb3IiLCJ3YXJuIiwibWVzc2FnZSIsInZhbHVlIiwiZXZlbnQiLCJmaWxlUGF0aCIsIm9wdGlvbnMiLCJoYXNBcGlLZXkiLCJoYXNPcHRpb25zQXBpS2V5IiwibWlzdHJhbEFwaUtleSIsImZpbGVOYW1lIiwiYmFzZW5hbWUiLCJzdGFydENvbnZlcnNpb24iLCJ3aW5kb3ciLCJzZW5kZXIiLCJnZXRPd25lckJyb3dzZXJXaW5kb3ciLCJzdGFuZGFyZENvbnZlcnRlciIsIm1ldGFkYXRhIiwiZXh0cmFjdE1ldGFkYXRhIiwiY2hlY2tBcGlLZXkiLCJ2YWxpZCIsImNvbnZlcnRUb01hcmtkb3duIiwiY29udGVudCIsIkVycm9yIiwidHJpbSIsImxlbmd0aCIsImluY2x1ZGVzIiwic3VjY2VzcyIsImVycm9yRGV0YWlscyIsInJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsImRhdGEiLCJnZXRJbmZvIiwiZXh0ZW5zaW9ucyIsInN1cHBvcnRlZEV4dGVuc2lvbnMiLCJ0aXRsZSIsIm1vZGVsIiwibGFuZ3VhZ2UiLCJtYXhQYWdlcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZWxlY3Ryb24vc2VydmljZXMvY29udmVyc2lvbi9kb2N1bWVudC9NaXN0cmFsUGRmQ29udmVydGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBNaXN0cmFsUGRmQ29udmVydGVyLmpzXHJcbiAqIEhhbmRsZXMgY29udmVyc2lvbiBvZiBQREYgZmlsZXMgdG8gbWFya2Rvd24gdXNpbmcgTWlzdHJhbCBPQ1IuXHJcbiAqIFxyXG4gKiBUaGlzIGNvbnZlcnRlcjpcclxuICogLSBVc2VzIE1pc3RyYWwgQUkgZm9yIE9DUiBwcm9jZXNzaW5nIG9mIFBERiBkb2N1bWVudHNcclxuICogLSBIYW5kbGVzIHNjYW5uZWQgZG9jdW1lbnRzIGFuZCBpbWFnZXMgd2l0aGluIFBERnNcclxuICogLSBFeHRyYWN0cyB0ZXh0IHRoYXQgc3RhbmRhcmQgUERGIHBhcnNlcnMgbWlnaHQgbWlzc1xyXG4gKiAtIENyZWF0ZXMgc3RydWN0dXJlZCBtYXJrZG93biB3aXRoIGhpZ2gtcXVhbGl0eSB0ZXh0IGV4dHJhY3Rpb25cclxuICogXHJcbiAqIFJlbGF0ZWQgRmlsZXM6XHJcbiAqIC0gQmFzZVBkZkNvbnZlcnRlci5qczogUGFyZW50IGNsYXNzIHdpdGggY29tbW9uIFBERiBmdW5jdGlvbmFsaXR5XHJcbiAqIC0gU3RhbmRhcmRQZGZDb252ZXJ0ZXIuanM6IEFsdGVybmF0aXZlIHRleHQtYmFzZWQgY29udmVydGVyXHJcbiAqIC0gRmlsZVN0b3JhZ2VTZXJ2aWNlLmpzOiBGb3IgdGVtcG9yYXJ5IGZpbGUgbWFuYWdlbWVudFxyXG4gKiAtIFBkZkNvbnZlcnRlckZhY3RvcnkuanM6IEZhY3RvcnkgZm9yIHNlbGVjdGluZyBhcHByb3ByaWF0ZSBjb252ZXJ0ZXJcclxuICovXHJcblxyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzLWV4dHJhJyk7XHJcbmNvbnN0IEJhc2VQZGZDb252ZXJ0ZXIgPSByZXF1aXJlKCcuL0Jhc2VQZGZDb252ZXJ0ZXInKTtcclxuY29uc3QgbWlzdHJhbCA9IHJlcXVpcmUoJy4vbWlzdHJhbCcpO1xyXG5cclxuY2xhc3MgTWlzdHJhbFBkZkNvbnZlcnRlciBleHRlbmRzIEJhc2VQZGZDb252ZXJ0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKGZpbGVQcm9jZXNzb3IsIGZpbGVTdG9yYWdlLCB1bnVzZWRQYXJhbSwgc2tpcEhhbmRsZXJTZXR1cCA9IGZhbHNlKSB7XHJcbiAgICBzdXBlcihmaWxlUHJvY2Vzc29yLCBmaWxlU3RvcmFnZSk7XHJcbiAgICB0aGlzLm5hbWUgPSAnTWlzdHJhbCBQREYgQ29udmVydGVyJztcclxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSAnQ29udmVydHMgUERGIGZpbGVzIHRvIG1hcmtkb3duIHVzaW5nIE1pc3RyYWwgT0NSJztcclxuICAgIHRoaXMuc2tpcEhhbmRsZXJTZXR1cCA9IHNraXBIYW5kbGVyU2V0dXA7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBtb2R1bGFyIGNvbXBvbmVudHNcclxuICAgIHRoaXMuYXBpQ2xpZW50ID0gbmV3IG1pc3RyYWwuTWlzdHJhbEFwaUNsaWVudCh7XHJcbiAgICAgIGFwaUVuZHBvaW50OiBwcm9jZXNzLmVudi5NSVNUUkFMX0FQSV9FTkRQT0lOVCxcclxuICAgICAgYXBpS2V5OiBwcm9jZXNzLmVudi5NSVNUUkFMX0FQSV9LRVlcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMub2NyUHJvY2Vzc29yID0gbmV3IG1pc3RyYWwuT2NyUHJvY2Vzc29yKCk7XHJcbiAgICB0aGlzLm1hcmtkb3duR2VuZXJhdG9yID0gbmV3IG1pc3RyYWwuTWFya2Rvd25HZW5lcmF0b3IoKTtcclxuICAgIHRoaXMuY29udmVyc2lvbk1hbmFnZXIgPSBuZXcgbWlzdHJhbC5Db252ZXJzaW9uTWFuYWdlcih7XHJcbiAgICAgIGZpbGVQcm9jZXNzb3IsXHJcbiAgICAgIGZpbGVTdG9yYWdlXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBTZXQgdGhlIEFQSSBrZXkgaW4gdGhlIGNvbnZlcnNpb24gbWFuYWdlclxyXG4gICAgdGhpcy5jb252ZXJzaW9uTWFuYWdlci5zZXRBcGlLZXkocHJvY2Vzcy5lbnYuTUlTVFJBTF9BUElfS0VZKTtcclxuXHJcbiAgICAvLyBMb2cgd2hldGhlciBoYW5kbGVycyB3aWxsIGJlIHNldCB1cFxyXG4gICAgaWYgKHNraXBIYW5kbGVyU2V0dXApIHtcclxuICAgICAgY29uc29sZS5sb2coJ1tNaXN0cmFsUGRmQ29udmVydGVyXSBTa2lwcGluZyBoYW5kbGVyIHNldHVwIChza2lwSGFuZGxlclNldHVwPXRydWUpJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnN0ZWFkIG9mIHJlbHlpbmcgb24gQmFzZVNlcnZpY2UncyBzZXRUaW1lb3V0IGFwcHJvYWNoLCBjYWxsIHNldHVwSXBjSGFuZGxlcnMgZGlyZWN0bHlcclxuICAgICAgLy8gVGhpcyBlbnN1cmVzIHdlIG9ubHkgc2V0IHVwIGhhbmRsZXJzIG9uY2UgYW5kIGV4cGxpY2l0bHkgd2hlbiBza2lwSGFuZGxlclNldHVwIGlzIGZhbHNlXHJcbiAgICAgIHRoaXMuc2V0dXBJcGNIYW5kbGVycygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHVwIElQQyBoYW5kbGVycyBmb3IgUERGIGNvbnZlcnNpb25cclxuICAgKi9cclxuICBzZXR1cElwY0hhbmRsZXJzKCkge1xyXG4gICAgLy8gSWYgc2tpcEhhbmRsZXJTZXR1cCB3YXMgc3BlY2lmaWVkLCBkb24ndCByZWdpc3RlciBoYW5kbGVyc1xyXG4gICAgaWYgKHRoaXMuc2tpcEhhbmRsZXJTZXR1cCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnW01pc3RyYWxQZGZDb252ZXJ0ZXJdIFNraXBwaW5nIElQQyBoYW5kbGVyIHNldHVwIGR1ZSB0byBza2lwSGFuZGxlclNldHVwIGZsYWcnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbTWlzdHJhbFBkZkNvbnZlcnRlcl0gU2V0dGluZyB1cCBJUEMgaGFuZGxlcnMnKTtcclxuXHJcbiAgICAvLyBVc2UgdHJ5LWNhdGNoIHRvIGhhbmRsZSBjYXNlcyB3aGVyZSBoYW5kbGVycyBhcmUgYWxyZWFkeSByZWdpc3RlcmVkXHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcignY29udmVydDpwZGY6b2NyJywgdGhpcy5oYW5kbGVDb252ZXJ0LmJpbmQodGhpcykpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcignY29udmVydDpwZGY6b2NyOm1ldGFkYXRhJywgdGhpcy5oYW5kbGVHZXRNZXRhZGF0YS5iaW5kKHRoaXMpKTtcclxuICAgICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoJ2NvbnZlcnQ6cGRmOm9jcjpjaGVjaycsIHRoaXMuaGFuZGxlQ2hlY2tBcGlLZXkuYmluZCh0aGlzKSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbTWlzdHJhbFBkZkNvbnZlcnRlcl0gSVBDIGhhbmRsZXJzIHJlZ2lzdGVyZWQnKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIC8vIElmIGEgaGFuZGxlciBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQsIGxvZyB0aGUgZXJyb3IgYnV0IGRvbid0IGNyYXNoXHJcbiAgICAgIGNvbnNvbGUud2FybihgW01pc3RyYWxQZGZDb252ZXJ0ZXJdIEVycm9yIGluIHNldHVwSXBjSGFuZGxlcnM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCBBUEkga2V5IGZvciBNaXN0cmFsIEFQSVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcGlLZXkgLSBBUEkga2V5XHJcbiAgICovXHJcbiAgc2V0QXBpS2V5KGFwaUtleSkge1xyXG4gICAgdGhpcy5hcGlDbGllbnQuc2V0QXBpS2V5KGFwaUtleSk7XHJcbiAgICB0aGlzLmNvbnZlcnNpb25NYW5hZ2VyLnNldEFwaUtleShhcGlLZXkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBBUEkga2V5XHJcbiAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBBUEkga2V5IG9yIG51bGwgaWYgbm90IHNldFxyXG4gICAqL1xyXG4gIGdldCBhcGlLZXkoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hcGlDbGllbnQuYXBpS2V5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBBUEkga2V5XHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIEFQSSBrZXkgdG8gc2V0XHJcbiAgICovXHJcbiAgc2V0IGFwaUtleSh2YWx1ZSkge1xyXG4gICAgdGhpcy5zZXRBcGlLZXkodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIFBERiBjb252ZXJzaW9uIHJlcXVlc3RcclxuICAgKiBAcGFyYW0ge0VsZWN0cm9uLklwY01haW5JbnZva2VFdmVudH0gZXZlbnQgLSBJUEMgZXZlbnRcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVxdWVzdCAtIENvbnZlcnNpb24gcmVxdWVzdCBkZXRhaWxzXHJcbiAgICovXHJcbiAgYXN5bmMgaGFuZGxlQ29udmVydChldmVudCwgeyBmaWxlUGF0aCwgb3B0aW9ucyA9IHt9IH0pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbTWlzdHJhbFBkZkNvbnZlcnRlcl0gaGFuZGxlQ29udmVydCBjYWxsZWQgd2l0aCBvcHRpb25zOicsIHtcclxuICAgICAgICBoYXNBcGlLZXk6ICEhdGhpcy5hcGlDbGllbnQuYXBpS2V5LFxyXG4gICAgICAgIGhhc09wdGlvbnNBcGlLZXk6ICEhb3B0aW9ucy5taXN0cmFsQXBpS2V5LFxyXG4gICAgICAgIGZpbGVOYW1lOiBvcHRpb25zLm5hbWUgfHwgcGF0aC5iYXNlbmFtZShmaWxlUGF0aClcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVc2UgQVBJIGtleSBmcm9tIG9wdGlvbnMgaWYgYXZhaWxhYmxlXHJcbiAgICAgIGlmIChvcHRpb25zLm1pc3RyYWxBcGlLZXkpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnW01pc3RyYWxQZGZDb252ZXJ0ZXJdIFVzaW5nIEFQSSBrZXkgZnJvbSBvcHRpb25zJyk7XHJcbiAgICAgICAgdGhpcy5zZXRBcGlLZXkob3B0aW9ucy5taXN0cmFsQXBpS2V5KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gU3RhcnQgdGhlIGNvbnZlcnNpb24gdXNpbmcgdGhlIENvbnZlcnNpb25NYW5hZ2VyXHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbnZlcnNpb25NYW5hZ2VyLnN0YXJ0Q29udmVyc2lvbih7XHJcbiAgICAgICAgZmlsZVBhdGgsXHJcbiAgICAgICAgb3B0aW9ucyxcclxuICAgICAgICB3aW5kb3c6IGV2ZW50LnNlbmRlci5nZXRPd25lckJyb3dzZXJXaW5kb3coKVxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNaXN0cmFsUGRmQ29udmVydGVyXSBGYWlsZWQgdG8gc3RhcnQgY29udmVyc2lvbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIFBERiBtZXRhZGF0YSByZXF1ZXN0XHJcbiAgICogQHBhcmFtIHtFbGVjdHJvbi5JcGNNYWluSW52b2tlRXZlbnR9IGV2ZW50IC0gSVBDIGV2ZW50XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3QgLSBNZXRhZGF0YSByZXF1ZXN0IGRldGFpbHNcclxuICAgKi9cclxuICBhc3luYyBoYW5kbGVHZXRNZXRhZGF0YShldmVudCwgeyBmaWxlUGF0aCB9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBGb3IgbWV0YWRhdGEsIHdlIGNhbiB1c2UgdGhlIHN0YW5kYXJkIFBERiBwYXJzZXJcclxuICAgICAgY29uc3Qgc3RhbmRhcmRDb252ZXJ0ZXIgPSBuZXcgKHJlcXVpcmUoJy4vU3RhbmRhcmRQZGZDb252ZXJ0ZXInKSkoXHJcbiAgICAgICAgdGhpcy5maWxlUHJvY2Vzc29yLFxyXG4gICAgICAgIHRoaXMuZmlsZVN0b3JhZ2VcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgc3RhbmRhcmRDb252ZXJ0ZXIuZXh0cmFjdE1ldGFkYXRhKGZpbGVQYXRoKTtcclxuICAgICAgcmV0dXJuIG1ldGFkYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW01pc3RyYWxQZGZDb252ZXJ0ZXJdIEZhaWxlZCB0byBnZXQgbWV0YWRhdGE6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZSBBUEkga2V5IGNoZWNrIHJlcXVlc3RcclxuICAgKiBAcGFyYW0ge0VsZWN0cm9uLklwY01haW5JbnZva2VFdmVudH0gZXZlbnQgLSBJUEMgZXZlbnRcclxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIE9wdGlvbnMgaW5jbHVkaW5nIEFQSSBrZXlcclxuICAgKi9cclxuICBhc3luYyBoYW5kbGVDaGVja0FwaUtleShldmVudCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBJZiBBUEkga2V5IHByb3ZpZGVkIGluIG9wdGlvbnMsIHVzZSBpdCBmb3IgdGhlIGNoZWNrXHJcbiAgICAgIGNvbnN0IGFwaUtleSA9IG9wdGlvbnM/LmFwaUtleSB8fCB0aGlzLmFwaUNsaWVudC5hcGlLZXk7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbnZlcnNpb25NYW5hZ2VyLmNoZWNrQXBpS2V5KGFwaUtleSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbTWlzdHJhbFBkZkNvbnZlcnRlcl0gQVBJIGtleSBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0IFBERiBjb250ZW50IHRvIG1hcmtkb3duIC0gZGlyZWN0IG1ldGhvZCBmb3IgQ29udmVydGVyUmVnaXN0cnlcclxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gY29udGVudCAtIFBERiBjb250ZW50IGFzIGJ1ZmZlclxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gQ29udmVyc2lvbiBvcHRpb25zXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gQ29udmVyc2lvbiByZXN1bHRcclxuICAgKi9cclxuICBhc3luYyBjb252ZXJ0VG9NYXJrZG93bihjb250ZW50LCBvcHRpb25zID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbTWlzdHJhbFBkZkNvbnZlcnRlcl0gQ29udmVydGluZyBQREYgd2l0aCBPQ1I6ICR7b3B0aW9ucy5uYW1lIHx8ICd1bm5hbWVkJ31gKTtcclxuXHJcbiAgICAgIC8vIFVzZSBBUEkga2V5IGZyb20gb3B0aW9ucyBpZiBwcm92aWRlZFxyXG4gICAgICBpZiAob3B0aW9ucy5hcGlLZXkgfHwgb3B0aW9ucy5taXN0cmFsQXBpS2V5KSB7XHJcbiAgICAgICAgY29uc3QgYXBpS2V5ID0gb3B0aW9ucy5hcGlLZXkgfHwgb3B0aW9ucy5taXN0cmFsQXBpS2V5O1xyXG4gICAgICAgIHRoaXMuc2V0QXBpS2V5KGFwaUtleSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFZhbGlkYXRlIHRoYXQgd2UgaGF2ZSBhbiBBUEkga2V5XHJcbiAgICAgIGlmICghdGhpcy5hcGlDbGllbnQuYXBpS2V5KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE1pc3RyYWwgQVBJIGtleS4gUGxlYXNlIGFkZCB5b3VyIEFQSSBrZXkgaW4gdGhlIHNldHRpbmdzIHBhZ2UuJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSBBUEkga2V5IGZvcm1hdCAoYmFzaWMgdmFsaWRhdGlvbilcclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmFwaUNsaWVudC5hcGlLZXkgIT09ICdzdHJpbmcnIHx8IHRoaXMuYXBpQ2xpZW50LmFwaUtleS50cmltKCkubGVuZ3RoIDwgMTApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgTWlzdHJhbCBBUEkga2V5IGZvcm1hdC4gUGxlYXNlIGNoZWNrIHlvdXIgQVBJIGtleSBpbiBzZXR0aW5ncy4nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYFtNaXN0cmFsUGRmQ29udmVydGVyXSBVc2luZyBBUEkga2V5OiAke3RoaXMuYXBpQ2xpZW50LmFwaUtleSA/ICfinJMgKHZhbGlkIGZvcm1hdCknIDogJ+KclyAoaW52YWxpZCBmb3JtYXQpJ31gKTtcclxuXHJcbiAgICAgIC8vIFVzZSB0aGUgQ29udmVyc2lvbk1hbmFnZXIgdG8gaGFuZGxlIHRoZSBhY3R1YWwgY29udmVyc2lvblxyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb252ZXJzaW9uTWFuYWdlci5jb252ZXJ0VG9NYXJrZG93bihjb250ZW50LCBvcHRpb25zKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNaXN0cmFsUGRmQ29udmVydGVyXSBEaXJlY3QgY29udmVyc2lvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG5cclxuICAgICAgLy8gQ2hlY2sgZm9yIHNwZWNpZmljIEFQSSBrZXkgZXJyb3JzXHJcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdBUEkga2V5JykgfHxcclxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ1VuYXV0aG9yaXplZCcpIHx8XHJcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCc0MDEnKSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBgUERGIE9DUiBjb252ZXJzaW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWAsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6ICdBUEkgS2V5IEVycm9yOiBQbGVhc2UgY2hlY2sgeW91ciBNaXN0cmFsIEFQSSBrZXkgaW4gc2V0dGluZ3MuJyxcclxuICAgICAgICAgIGNvbnRlbnQ6IGAjIENvbnZlcnNpb24gRXJyb3JcXG5cXG5GYWlsZWQgdG8gY29udmVydCBQREYgd2l0aCBPQ1I6IEludmFsaWQgb3IgbWlzc2luZyBNaXN0cmFsIEFQSSBrZXkuXFxuXFxuIyMgSG93IHRvIEZpeFxcblxcbjEuIEdvIHRvIFNldHRpbmdzXFxuMi4gQWRkIGEgdmFsaWQgTWlzdHJhbCBBUEkga2V5XFxuMy4gVHJ5IHRoZSBjb252ZXJzaW9uIGFnYWluYFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhIG1vcmUgZGV0YWlsZWQgZXJyb3IgbWVzc2FnZVxyXG4gICAgICBjb25zdCBlcnJvckRldGFpbHMgPSBlcnJvci5yZXNwb25zZSA/XHJcbiAgICAgICAgYEFQSSByZXNwb25zZTogJHtKU09OLnN0cmluZ2lmeShlcnJvci5yZXNwb25zZS5kYXRhIHx8IHt9KX1gIDpcclxuICAgICAgICBlcnJvci5tZXNzYWdlO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogYFBERiBPQ1IgY29udmVyc2lvbiBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gLFxyXG4gICAgICAgIGVycm9yRGV0YWlsczogZXJyb3JEZXRhaWxzLFxyXG4gICAgICAgIGNvbnRlbnQ6IGAjIENvbnZlcnNpb24gRXJyb3JcXG5cXG5GYWlsZWQgdG8gY29udmVydCBQREYgd2l0aCBPQ1I6ICR7ZXJyb3IubWVzc2FnZX1cXG5cXG4jIyBFcnJvciBEZXRhaWxzXFxuXFxuJHtlcnJvckRldGFpbHN9YFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGNvbnZlcnRlciBpbmZvcm1hdGlvblxyXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IENvbnZlcnRlciBkZXRhaWxzXHJcbiAgICovXHJcbiAgZ2V0SW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgZXh0ZW5zaW9uczogdGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zLFxyXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcclxuICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgIHRpdGxlOiAnT3B0aW9uYWwgZG9jdW1lbnQgdGl0bGUnLFxyXG4gICAgICAgIG1vZGVsOiAnT0NSIG1vZGVsIHRvIHVzZSAoZGVmYXVsdDogbWlzdHJhbC1vY3ItbGF0ZXN0KScsXHJcbiAgICAgICAgbGFuZ3VhZ2U6ICdMYW5ndWFnZSBoaW50IGZvciBPQ1IgKG9wdGlvbmFsKScsXHJcbiAgICAgICAgbWF4UGFnZXM6ICdNYXhpbXVtIHBhZ2VzIHRvIGNvbnZlcnQgKGRlZmF1bHQ6IGFsbCknXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IE1pc3RyYWxQZGZDb252ZXJ0ZXI7Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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