"use strict";

/**
 * CsvConverter.js
 * Handles conversion of CSV files to markdown format in the Electron main process.
 * 
 * This converter:
 * - Parses CSV files using csv-parse/sync
 * - Extracts table data and metadata
 * - Generates markdown tables
 * - Handles large files efficiently
 * 
 * Related Files:
 * - BaseService.js: Parent class providing IPC handling
 * - FileProcessorService.js: Used for file operations
 * - ConversionService.js: Registers and uses this converter
 */

const path = require('path');
const {
  parse
} = require('csv-parse/sync');
const BaseService = require('../../BaseService');
class CsvConverter extends BaseService {
  constructor(fileProcessor) {
    super();
    this.fileProcessor = fileProcessor;
    this.supportedExtensions = ['.csv'];
  }

  /**
   * Set up IPC handlers for CSV conversion
   */
  setupIpcHandlers() {
    this.registerHandler('convert:csv', this.handleConvert.bind(this));
    this.registerHandler('convert:csv:preview', this.handlePreview.bind(this));
  }

  /**
   * Handle CSV conversion request
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} request - Conversion request details
   */
  async handleConvert(event, {
    filePath,
    options = {}
  }) {
    try {
      console.log(`[CsvConverter] Converting file: ${filePath}`);
      console.log(`[CsvConverter] Options:`, JSON.stringify(options, null, 2));

      // Add error handling for file reading
      let content;
      try {
        console.log(`[CsvConverter] Reading file with encoding: ${options.encoding || 'utf8'}`);
        content = await this.fileProcessor.handleFileRead(null, {
          filePath,
          encoding: options.encoding || 'utf8'
        });
        console.log(`[CsvConverter] File read successful, content length: ${content?.content?.length || 0} bytes`);
      } catch (readError) {
        console.error(`[CsvConverter] Failed to read CSV file: ${filePath}`, readError);
        throw new Error(`Failed to read CSV file: ${readError.message}`);
      }

      // Validate content
      if (!content || !content.content || content.content.trim() === '') {
        console.error(`[CsvConverter] Empty or invalid CSV file: ${filePath}`);
        throw new Error('CSV file is empty or contains no valid content');
      }
      console.log(`[CsvConverter] Starting markdown conversion for CSV content`);
      console.log(`[CsvConverter] First 100 chars of content: ${content.content.substring(0, 100)}...`);
      const result = await this.convertToMarkdown(content.content, options);

      // Validate result
      if (!result || result.trim() === '') {
        console.error(`[CsvConverter] Conversion produced empty content: ${filePath}`);
        throw new Error('CSV conversion produced empty content');
      }
      console.log(`[CsvConverter] Conversion successful, markdown length: ${result.length} bytes`);
      console.log(`[CsvConverter] First 100 chars of markdown: ${result.substring(0, 100)}...`);

      // Return with proper structure
      const response = {
        content: result
      };
      console.log(`[CsvConverter] Returning response with content property`);
      return response;
    } catch (error) {
      console.error('[CsvConverter] Conversion failed:', error);
      throw error;
    }
  }

  /**
   * Handle CSV preview request
   * @param {Electron.IpcMainInvokeEvent} event - IPC event
   * @param {Object} request - Preview request details
   */
  async handlePreview(event, {
    filePath,
    options = {}
  }) {
    try {
      // Read first 10 lines for preview
      const content = await this.fileProcessor.handleFileRead(null, {
        filePath,
        encoding: options.encoding || 'utf8'
      });
      const lines = content.content.split('\n').slice(0, 10).join('\n');
      const result = await this.convertToMarkdown(lines, {
        ...options,
        preview: true
      });
      return {
        content: result
      };
    } catch (error) {
      console.error('[CsvConverter] Preview generation failed:', error);
      throw error;
    }
  }

  /**
   * Convert CSV content to markdown
   * @param {string} content - CSV content
   * @param {Object} options - Conversion options
   * @returns {Promise<string>} Markdown content
   */
  async convertToMarkdown(content, options = {}) {
    try {
      console.log(`[CsvConverter] convertToMarkdown called with content length: ${content?.length || 0} bytes`);
      console.log(`[CsvConverter] convertToMarkdown options:`, JSON.stringify(options, null, 2));

      // Validate input content
      if (!content || content.trim() === '') {
        console.warn('[CsvConverter] Empty content provided for conversion');
        return '> No data found in CSV file.';
      }

      // Check if content has at least one line with comma or tab
      const hasDelimiters = content.includes(',') || content.includes('\t');
      if (!hasDelimiters) {
        console.warn('[CsvConverter] Content appears to lack proper CSV delimiters');
        return '> File does not appear to be a valid CSV (no delimiters found).';
      }

      // Enhanced parsing with better error handling
      let records;
      try {
        console.log(`[CsvConverter] Parsing CSV with options:`, {
          columns: true,
          skip_empty_lines: true,
          trim: true,
          relax_column_count: true,
          ...(options.csvOptions || {})
        });
        records = parse(content, {
          columns: true,
          skip_empty_lines: true,
          trim: true,
          relax_column_count: true,
          // Handle inconsistent column counts
          ...options.csvOptions
        });
        console.log(`[CsvConverter] CSV parsing successful, found ${records?.length || 0} records`);
      } catch (parseError) {
        console.error('[CsvConverter] CSV parsing failed:', parseError);
        console.error('[CsvConverter] First 200 characters of problematic content:', content.substring(0, 200));
        return `> Error parsing CSV: ${parseError.message}\n\n\`\`\`\nFirst 100 characters of content:\n${content.substring(0, 100)}...\n\`\`\``;
      }

      // Handle empty records
      if (!records || records.length === 0) {
        console.warn('[CsvConverter] No records found after parsing');
        return '> No data found in CSV file.';
      }

      // Handle missing headers
      if (!records[0]) {
        console.warn('[CsvConverter] First record is undefined');
        return '> CSV file has invalid structure.';
      }
      const headers = Object.keys(records[0]);
      if (headers.length === 0) {
        console.warn('[CsvConverter] No columns found in parsed data');
        return '> No columns found in CSV file.';
      }
      // Get the original filename without extension
      const fileName = options.originalFileName || options.name || 'csv-data';
      const fileTitle = fileName.replace(/\.[^/.]+$/, ''); // Remove file extension if present

      // Get current datetime
      const now = new Date();
      const convertedDate = now.toISOString().split('.')[0].replace('T', ' ');

      // Build markdown with YAML frontmatter
      let markdown = [];

      // Add standardized frontmatter
      markdown.push('---');
      markdown.push(`title: ${fileTitle}`);
      markdown.push(`converted: ${convertedDate}`);
      markdown.push('type: csv');
      markdown.push('---');
      markdown.push('');

      // Add table metadata as a note
      markdown.push(`> CSV Data${options.preview ? ' (Preview)' : ''}`);
      markdown.push(`> - Columns: ${headers.length}`);
      markdown.push(`> - Rows: ${records.length}`);
      markdown.push('');

      // Build table header
      markdown.push('| ' + headers.join(' | ') + ' |');
      markdown.push('| ' + headers.map(() => '---').join(' | ') + ' |');

      // Build table rows with enhanced error handling
      records.forEach((record, index) => {
        try {
          const row = headers.map(header => {
            try {
              const cell = record[header];
              // Handle null/undefined values
              if (cell === null || cell === undefined) {
                return '';
              }
              // Escape pipe characters and handle line breaks
              return cell.toString().replace(/\|/g, '\\|').replace(/\n/g, '<br>');
            } catch (cellError) {
              console.warn(`[CsvConverter] Error processing cell in column "${header}" at row ${index}:`, cellError);
              return '';
            }
          });
          markdown.push('| ' + row.join(' | ') + ' |');
        } catch (rowError) {
          console.warn(`[CsvConverter] Error processing row ${index}:`, rowError);
          // Skip problematic rows instead of failing the entire conversion
        }
      });
      const result = markdown.join('\n');
      console.log(`[CsvConverter] Markdown generation complete, length: ${result.length} bytes`);
      return result;
    } catch (error) {
      console.error('[CsvConverter] Markdown conversion failed:', error);
      console.error('[CsvConverter] Error details:', error.stack || error);
      throw error;
    }
  }

  /**
   * Check if this converter supports the given file
   * @param {string} filePath - Path to file
   * @returns {boolean} True if supported
   */
  supportsFile(filePath) {
    const ext = path.extname(filePath).toLowerCase();
    return this.supportedExtensions.includes(ext);
  }

  /**
   * Get converter information
   * @returns {Object} Converter details
   */
  getInfo() {
    return {
      name: 'CSV Converter',
      extensions: this.supportedExtensions,
      description: 'Converts CSV files to markdown tables',
      options: {
        encoding: 'File encoding (default: utf8)',
        title: 'Optional table title',
        csvOptions: 'Additional CSV parsing options'
      }
    };
  }
}
module.exports = CsvConverter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsInBhcnNlIiwiQmFzZVNlcnZpY2UiLCJDc3ZDb252ZXJ0ZXIiLCJjb25zdHJ1Y3RvciIsImZpbGVQcm9jZXNzb3IiLCJzdXBwb3J0ZWRFeHRlbnNpb25zIiwic2V0dXBJcGNIYW5kbGVycyIsInJlZ2lzdGVySGFuZGxlciIsImhhbmRsZUNvbnZlcnQiLCJiaW5kIiwiaGFuZGxlUHJldmlldyIsImV2ZW50IiwiZmlsZVBhdGgiLCJvcHRpb25zIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb250ZW50IiwiZW5jb2RpbmciLCJoYW5kbGVGaWxlUmVhZCIsImxlbmd0aCIsInJlYWRFcnJvciIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwidHJpbSIsInN1YnN0cmluZyIsInJlc3VsdCIsImNvbnZlcnRUb01hcmtkb3duIiwicmVzcG9uc2UiLCJsaW5lcyIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwicHJldmlldyIsIndhcm4iLCJoYXNEZWxpbWl0ZXJzIiwiaW5jbHVkZXMiLCJyZWNvcmRzIiwiY29sdW1ucyIsInNraXBfZW1wdHlfbGluZXMiLCJyZWxheF9jb2x1bW5fY291bnQiLCJjc3ZPcHRpb25zIiwicGFyc2VFcnJvciIsImhlYWRlcnMiLCJPYmplY3QiLCJrZXlzIiwiZmlsZU5hbWUiLCJvcmlnaW5hbEZpbGVOYW1lIiwibmFtZSIsImZpbGVUaXRsZSIsInJlcGxhY2UiLCJub3ciLCJEYXRlIiwiY29udmVydGVkRGF0ZSIsInRvSVNPU3RyaW5nIiwibWFya2Rvd24iLCJwdXNoIiwibWFwIiwiZm9yRWFjaCIsInJlY29yZCIsImluZGV4Iiwicm93IiwiaGVhZGVyIiwiY2VsbCIsInVuZGVmaW5lZCIsInRvU3RyaW5nIiwiY2VsbEVycm9yIiwicm93RXJyb3IiLCJzdGFjayIsInN1cHBvcnRzRmlsZSIsImV4dCIsImV4dG5hbWUiLCJ0b0xvd2VyQ2FzZSIsImdldEluZm8iLCJleHRlbnNpb25zIiwiZGVzY3JpcHRpb24iLCJ0aXRsZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZWxlY3Ryb24vc2VydmljZXMvY29udmVyc2lvbi9kYXRhL0NzdkNvbnZlcnRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3N2Q29udmVydGVyLmpzXHJcbiAqIEhhbmRsZXMgY29udmVyc2lvbiBvZiBDU1YgZmlsZXMgdG8gbWFya2Rvd24gZm9ybWF0IGluIHRoZSBFbGVjdHJvbiBtYWluIHByb2Nlc3MuXHJcbiAqIFxyXG4gKiBUaGlzIGNvbnZlcnRlcjpcclxuICogLSBQYXJzZXMgQ1NWIGZpbGVzIHVzaW5nIGNzdi1wYXJzZS9zeW5jXHJcbiAqIC0gRXh0cmFjdHMgdGFibGUgZGF0YSBhbmQgbWV0YWRhdGFcclxuICogLSBHZW5lcmF0ZXMgbWFya2Rvd24gdGFibGVzXHJcbiAqIC0gSGFuZGxlcyBsYXJnZSBmaWxlcyBlZmZpY2llbnRseVxyXG4gKiBcclxuICogUmVsYXRlZCBGaWxlczpcclxuICogLSBCYXNlU2VydmljZS5qczogUGFyZW50IGNsYXNzIHByb3ZpZGluZyBJUEMgaGFuZGxpbmdcclxuICogLSBGaWxlUHJvY2Vzc29yU2VydmljZS5qczogVXNlZCBmb3IgZmlsZSBvcGVyYXRpb25zXHJcbiAqIC0gQ29udmVyc2lvblNlcnZpY2UuanM6IFJlZ2lzdGVycyBhbmQgdXNlcyB0aGlzIGNvbnZlcnRlclxyXG4gKi9cclxuXHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbmNvbnN0IHsgcGFyc2UgfSA9IHJlcXVpcmUoJ2Nzdi1wYXJzZS9zeW5jJyk7XHJcbmNvbnN0IEJhc2VTZXJ2aWNlID0gcmVxdWlyZSgnLi4vLi4vQmFzZVNlcnZpY2UnKTtcclxuXHJcbmNsYXNzIENzdkNvbnZlcnRlciBleHRlbmRzIEJhc2VTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKGZpbGVQcm9jZXNzb3IpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuZmlsZVByb2Nlc3NvciA9IGZpbGVQcm9jZXNzb3I7XHJcbiAgICAgICAgdGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zID0gWycuY3N2J107XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdXAgSVBDIGhhbmRsZXJzIGZvciBDU1YgY29udmVyc2lvblxyXG4gICAgICovXHJcbiAgICBzZXR1cElwY0hhbmRsZXJzKCkge1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKCdjb252ZXJ0OmNzdicsIHRoaXMuaGFuZGxlQ29udmVydC5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcignY29udmVydDpjc3Y6cHJldmlldycsIHRoaXMuaGFuZGxlUHJldmlldy5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhhbmRsZSBDU1YgY29udmVyc2lvbiByZXF1ZXN0XHJcbiAgICAgKiBAcGFyYW0ge0VsZWN0cm9uLklwY01haW5JbnZva2VFdmVudH0gZXZlbnQgLSBJUEMgZXZlbnRcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0IC0gQ29udmVyc2lvbiByZXF1ZXN0IGRldGFpbHNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgaGFuZGxlQ29udmVydChldmVudCwgeyBmaWxlUGF0aCwgb3B0aW9ucyA9IHt9IH0pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NzdkNvbnZlcnRlcl0gQ29udmVydGluZyBmaWxlOiAke2ZpbGVQYXRofWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NzdkNvbnZlcnRlcl0gT3B0aW9uczpgLCBKU09OLnN0cmluZ2lmeShvcHRpb25zLCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcgZm9yIGZpbGUgcmVhZGluZ1xyXG4gICAgICAgICAgICBsZXQgY29udGVudDtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ3N2Q29udmVydGVyXSBSZWFkaW5nIGZpbGUgd2l0aCBlbmNvZGluZzogJHtvcHRpb25zLmVuY29kaW5nIHx8ICd1dGY4J31gKTtcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBhd2FpdCB0aGlzLmZpbGVQcm9jZXNzb3IuaGFuZGxlRmlsZVJlYWQobnVsbCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuY29kaW5nOiBvcHRpb25zLmVuY29kaW5nIHx8ICd1dGY4J1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NzdkNvbnZlcnRlcl0gRmlsZSByZWFkIHN1Y2Nlc3NmdWwsIGNvbnRlbnQgbGVuZ3RoOiAke2NvbnRlbnQ/LmNvbnRlbnQ/Lmxlbmd0aCB8fCAwfSBieXRlc2ApO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChyZWFkRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtDc3ZDb252ZXJ0ZXJdIEZhaWxlZCB0byByZWFkIENTViBmaWxlOiAke2ZpbGVQYXRofWAsIHJlYWRFcnJvcik7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZWFkIENTViBmaWxlOiAke3JlYWRFcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSBjb250ZW50XHJcbiAgICAgICAgICAgIGlmICghY29udGVudCB8fCAhY29udGVudC5jb250ZW50IHx8IGNvbnRlbnQuY29udGVudC50cmltKCkgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbQ3N2Q29udmVydGVyXSBFbXB0eSBvciBpbnZhbGlkIENTViBmaWxlOiAke2ZpbGVQYXRofWApO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDU1YgZmlsZSBpcyBlbXB0eSBvciBjb250YWlucyBubyB2YWxpZCBjb250ZW50Jyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ3N2Q29udmVydGVyXSBTdGFydGluZyBtYXJrZG93biBjb252ZXJzaW9uIGZvciBDU1YgY29udGVudGApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NzdkNvbnZlcnRlcl0gRmlyc3QgMTAwIGNoYXJzIG9mIGNvbnRlbnQ6ICR7Y29udGVudC5jb250ZW50LnN1YnN0cmluZygwLCAxMDApfS4uLmApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb252ZXJ0VG9NYXJrZG93bihjb250ZW50LmNvbnRlbnQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVmFsaWRhdGUgcmVzdWx0XHJcbiAgICAgICAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC50cmltKCkgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbQ3N2Q29udmVydGVyXSBDb252ZXJzaW9uIHByb2R1Y2VkIGVtcHR5IGNvbnRlbnQ6ICR7ZmlsZVBhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NTViBjb252ZXJzaW9uIHByb2R1Y2VkIGVtcHR5IGNvbnRlbnQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYFtDc3ZDb252ZXJ0ZXJdIENvbnZlcnNpb24gc3VjY2Vzc2Z1bCwgbWFya2Rvd24gbGVuZ3RoOiAke3Jlc3VsdC5sZW5ndGh9IGJ5dGVzYCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ3N2Q29udmVydGVyXSBGaXJzdCAxMDAgY2hhcnMgb2YgbWFya2Rvd246ICR7cmVzdWx0LnN1YnN0cmluZygwLCAxMDApfS4uLmApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gUmV0dXJuIHdpdGggcHJvcGVyIHN0cnVjdHVyZVxyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgY29udGVudDogcmVzdWx0IH07XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ3N2Q29udmVydGVyXSBSZXR1cm5pbmcgcmVzcG9uc2Ugd2l0aCBjb250ZW50IHByb3BlcnR5YCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ3N2Q29udmVydGVyXSBDb252ZXJzaW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhhbmRsZSBDU1YgcHJldmlldyByZXF1ZXN0XHJcbiAgICAgKiBAcGFyYW0ge0VsZWN0cm9uLklwY01haW5JbnZva2VFdmVudH0gZXZlbnQgLSBJUEMgZXZlbnRcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0IC0gUHJldmlldyByZXF1ZXN0IGRldGFpbHNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgaGFuZGxlUHJldmlldyhldmVudCwgeyBmaWxlUGF0aCwgb3B0aW9ucyA9IHt9IH0pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBSZWFkIGZpcnN0IDEwIGxpbmVzIGZvciBwcmV2aWV3XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmZpbGVQcm9jZXNzb3IuaGFuZGxlRmlsZVJlYWQobnVsbCwge1xyXG4gICAgICAgICAgICAgICAgZmlsZVBhdGgsXHJcbiAgICAgICAgICAgICAgICBlbmNvZGluZzogb3B0aW9ucy5lbmNvZGluZyB8fCAndXRmOCdcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuY29udGVudC5zcGxpdCgnXFxuJykuc2xpY2UoMCwgMTApLmpvaW4oJ1xcbicpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbnZlcnRUb01hcmtkb3duKGxpbmVzLCB7XHJcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgcHJldmlldzogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7IGNvbnRlbnQ6IHJlc3VsdCB9O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDc3ZDb252ZXJ0ZXJdIFByZXZpZXcgZ2VuZXJhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb252ZXJ0IENTViBjb250ZW50IHRvIG1hcmtkb3duXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29udGVudCAtIENTViBjb250ZW50XHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIENvbnZlcnNpb24gb3B0aW9uc1xyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gTWFya2Rvd24gY29udGVudFxyXG4gICAgICovXHJcbiAgICBhc3luYyBjb252ZXJ0VG9NYXJrZG93bihjb250ZW50LCBvcHRpb25zID0ge30pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NzdkNvbnZlcnRlcl0gY29udmVydFRvTWFya2Rvd24gY2FsbGVkIHdpdGggY29udGVudCBsZW5ndGg6ICR7Y29udGVudD8ubGVuZ3RoIHx8IDB9IGJ5dGVzYCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ3N2Q29udmVydGVyXSBjb252ZXJ0VG9NYXJrZG93biBvcHRpb25zOmAsIEpTT04uc3RyaW5naWZ5KG9wdGlvbnMsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIGlucHV0IGNvbnRlbnRcclxuICAgICAgICAgICAgaWYgKCFjb250ZW50IHx8IGNvbnRlbnQudHJpbSgpID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbQ3N2Q29udmVydGVyXSBFbXB0eSBjb250ZW50IHByb3ZpZGVkIGZvciBjb252ZXJzaW9uJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJz4gTm8gZGF0YSBmb3VuZCBpbiBDU1YgZmlsZS4nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBjb250ZW50IGhhcyBhdCBsZWFzdCBvbmUgbGluZSB3aXRoIGNvbW1hIG9yIHRhYlxyXG4gICAgICAgICAgICBjb25zdCBoYXNEZWxpbWl0ZXJzID0gY29udGVudC5pbmNsdWRlcygnLCcpIHx8IGNvbnRlbnQuaW5jbHVkZXMoJ1xcdCcpO1xyXG4gICAgICAgICAgICBpZiAoIWhhc0RlbGltaXRlcnMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignW0NzdkNvbnZlcnRlcl0gQ29udGVudCBhcHBlYXJzIHRvIGxhY2sgcHJvcGVyIENTViBkZWxpbWl0ZXJzJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJz4gRmlsZSBkb2VzIG5vdCBhcHBlYXIgdG8gYmUgYSB2YWxpZCBDU1YgKG5vIGRlbGltaXRlcnMgZm91bmQpLic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEVuaGFuY2VkIHBhcnNpbmcgd2l0aCBiZXR0ZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgICAgICAgICAgbGV0IHJlY29yZHM7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW0NzdkNvbnZlcnRlcl0gUGFyc2luZyBDU1Ygd2l0aCBvcHRpb25zOmAsIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNraXBfZW1wdHlfbGluZXM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdHJpbTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICByZWxheF9jb2x1bW5fY291bnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uKG9wdGlvbnMuY3N2T3B0aW9ucyB8fCB7fSlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZWNvcmRzID0gcGFyc2UoY29udGVudCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc2tpcF9lbXB0eV9saW5lczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0cmltOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlbGF4X2NvbHVtbl9jb3VudDogdHJ1ZSwgLy8gSGFuZGxlIGluY29uc2lzdGVudCBjb2x1bW4gY291bnRzXHJcbiAgICAgICAgICAgICAgICAgICAgLi4ub3B0aW9ucy5jc3ZPcHRpb25zXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtDc3ZDb252ZXJ0ZXJdIENTViBwYXJzaW5nIHN1Y2Nlc3NmdWwsIGZvdW5kICR7cmVjb3Jkcz8ubGVuZ3RoIHx8IDB9IHJlY29yZHNgKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0NzdkNvbnZlcnRlcl0gQ1NWIHBhcnNpbmcgZmFpbGVkOicsIHBhcnNlRXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0NzdkNvbnZlcnRlcl0gRmlyc3QgMjAwIGNoYXJhY3RlcnMgb2YgcHJvYmxlbWF0aWMgY29udGVudDonLCBjb250ZW50LnN1YnN0cmluZygwLCAyMDApKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgPiBFcnJvciBwYXJzaW5nIENTVjogJHtwYXJzZUVycm9yLm1lc3NhZ2V9XFxuXFxuXFxgXFxgXFxgXFxuRmlyc3QgMTAwIGNoYXJhY3RlcnMgb2YgY29udGVudDpcXG4ke2NvbnRlbnQuc3Vic3RyaW5nKDAsIDEwMCl9Li4uXFxuXFxgXFxgXFxgYDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSGFuZGxlIGVtcHR5IHJlY29yZHNcclxuICAgICAgICAgICAgaWYgKCFyZWNvcmRzIHx8IHJlY29yZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tDc3ZDb252ZXJ0ZXJdIE5vIHJlY29yZHMgZm91bmQgYWZ0ZXIgcGFyc2luZycpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICc+IE5vIGRhdGEgZm91bmQgaW4gQ1NWIGZpbGUuJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSGFuZGxlIG1pc3NpbmcgaGVhZGVyc1xyXG4gICAgICAgICAgICBpZiAoIXJlY29yZHNbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignW0NzdkNvbnZlcnRlcl0gRmlyc3QgcmVjb3JkIGlzIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICc+IENTViBmaWxlIGhhcyBpbnZhbGlkIHN0cnVjdHVyZS4nO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gT2JqZWN0LmtleXMocmVjb3Jkc1swXSk7XHJcbiAgICAgICAgICAgIGlmIChoZWFkZXJzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbQ3N2Q29udmVydGVyXSBObyBjb2x1bW5zIGZvdW5kIGluIHBhcnNlZCBkYXRhJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJz4gTm8gY29sdW1ucyBmb3VuZCBpbiBDU1YgZmlsZS4nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIEdldCB0aGUgb3JpZ2luYWwgZmlsZW5hbWUgd2l0aG91dCBleHRlbnNpb25cclxuICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBvcHRpb25zLm9yaWdpbmFsRmlsZU5hbWUgfHwgb3B0aW9ucy5uYW1lIHx8ICdjc3YtZGF0YSc7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVUaXRsZSA9IGZpbGVOYW1lLnJlcGxhY2UoL1xcLlteLy5dKyQvLCAnJyk7IC8vIFJlbW92ZSBmaWxlIGV4dGVuc2lvbiBpZiBwcmVzZW50XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBHZXQgY3VycmVudCBkYXRldGltZVxyXG4gICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBjb252ZXJ0ZWREYXRlID0gbm93LnRvSVNPU3RyaW5nKCkuc3BsaXQoJy4nKVswXS5yZXBsYWNlKCdUJywgJyAnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEJ1aWxkIG1hcmtkb3duIHdpdGggWUFNTCBmcm9udG1hdHRlclxyXG4gICAgICAgICAgICBsZXQgbWFya2Rvd24gPSBbXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEFkZCBzdGFuZGFyZGl6ZWQgZnJvbnRtYXR0ZXJcclxuICAgICAgICAgICAgbWFya2Rvd24ucHVzaCgnLS0tJyk7XHJcbiAgICAgICAgICAgIG1hcmtkb3duLnB1c2goYHRpdGxlOiAke2ZpbGVUaXRsZX1gKTtcclxuICAgICAgICAgICAgbWFya2Rvd24ucHVzaChgY29udmVydGVkOiAke2NvbnZlcnRlZERhdGV9YCk7XHJcbiAgICAgICAgICAgIG1hcmtkb3duLnB1c2goJ3R5cGU6IGNzdicpO1xyXG4gICAgICAgICAgICBtYXJrZG93bi5wdXNoKCctLS0nKTtcclxuICAgICAgICAgICAgbWFya2Rvd24ucHVzaCgnJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgdGFibGUgbWV0YWRhdGEgYXMgYSBub3RlXHJcbiAgICAgICAgICAgIG1hcmtkb3duLnB1c2goYD4gQ1NWIERhdGEke29wdGlvbnMucHJldmlldyA/ICcgKFByZXZpZXcpJyA6ICcnfWApO1xyXG4gICAgICAgICAgICBtYXJrZG93bi5wdXNoKGA+IC0gQ29sdW1uczogJHtoZWFkZXJzLmxlbmd0aH1gKTtcclxuICAgICAgICAgICAgbWFya2Rvd24ucHVzaChgPiAtIFJvd3M6ICR7cmVjb3Jkcy5sZW5ndGh9YCk7XHJcbiAgICAgICAgICAgIG1hcmtkb3duLnB1c2goJycpO1xyXG5cclxuICAgICAgICAgICAgLy8gQnVpbGQgdGFibGUgaGVhZGVyXHJcbiAgICAgICAgICAgIG1hcmtkb3duLnB1c2goJ3wgJyArIGhlYWRlcnMuam9pbignIHwgJykgKyAnIHwnKTtcclxuICAgICAgICAgICAgbWFya2Rvd24ucHVzaCgnfCAnICsgaGVhZGVycy5tYXAoKCkgPT4gJy0tLScpLmpvaW4oJyB8ICcpICsgJyB8Jyk7XHJcblxyXG4gICAgICAgICAgICAvLyBCdWlsZCB0YWJsZSByb3dzIHdpdGggZW5oYW5jZWQgZXJyb3IgaGFuZGxpbmdcclxuICAgICAgICAgICAgcmVjb3Jkcy5mb3JFYWNoKChyZWNvcmQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvdyA9IGhlYWRlcnMubWFwKGhlYWRlciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gcmVjb3JkW2hlYWRlcl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgbnVsbC91bmRlZmluZWQgdmFsdWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbCA9PT0gbnVsbCB8fCBjZWxsID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFc2NhcGUgcGlwZSBjaGFyYWN0ZXJzIGFuZCBoYW5kbGUgbGluZSBicmVha3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsLnRvU3RyaW5nKCkucmVwbGFjZSgvXFx8L2csICdcXFxcfCcpLnJlcGxhY2UoL1xcbi9nLCAnPGJyPicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjZWxsRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgW0NzdkNvbnZlcnRlcl0gRXJyb3IgcHJvY2Vzc2luZyBjZWxsIGluIGNvbHVtbiBcIiR7aGVhZGVyfVwiIGF0IHJvdyAke2luZGV4fTpgLCBjZWxsRXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2Rvd24ucHVzaCgnfCAnICsgcm93LmpvaW4oJyB8ICcpICsgJyB8Jyk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChyb3dFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgW0NzdkNvbnZlcnRlcl0gRXJyb3IgcHJvY2Vzc2luZyByb3cgJHtpbmRleH06YCwgcm93RXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNraXAgcHJvYmxlbWF0aWMgcm93cyBpbnN0ZWFkIG9mIGZhaWxpbmcgdGhlIGVudGlyZSBjb252ZXJzaW9uXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbWFya2Rvd24uam9pbignXFxuJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQ3N2Q29udmVydGVyXSBNYXJrZG93biBnZW5lcmF0aW9uIGNvbXBsZXRlLCBsZW5ndGg6ICR7cmVzdWx0Lmxlbmd0aH0gYnl0ZXNgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ3N2Q29udmVydGVyXSBNYXJrZG93biBjb252ZXJzaW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDc3ZDb252ZXJ0ZXJdIEVycm9yIGRldGFpbHM6JywgZXJyb3Iuc3RhY2sgfHwgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVjayBpZiB0aGlzIGNvbnZlcnRlciBzdXBwb3J0cyB0aGUgZ2l2ZW4gZmlsZVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVQYXRoIC0gUGF0aCB0byBmaWxlXHJcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiBzdXBwb3J0ZWRcclxuICAgICAqL1xyXG4gICAgc3VwcG9ydHNGaWxlKGZpbGVQYXRoKSB7XHJcbiAgICAgICAgY29uc3QgZXh0ID0gcGF0aC5leHRuYW1lKGZpbGVQYXRoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN1cHBvcnRlZEV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCBjb252ZXJ0ZXIgaW5mb3JtYXRpb25cclxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IENvbnZlcnRlciBkZXRhaWxzXHJcbiAgICAgKi9cclxuICAgIGdldEluZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogJ0NTViBDb252ZXJ0ZXInLFxyXG4gICAgICAgICAgICBleHRlbnNpb25zOiB0aGlzLnN1cHBvcnRlZEV4dGVuc2lvbnMsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ29udmVydHMgQ1NWIGZpbGVzIHRvIG1hcmtkb3duIHRhYmxlcycsXHJcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgIGVuY29kaW5nOiAnRmlsZSBlbmNvZGluZyAoZGVmYXVsdDogdXRmOCknLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdPcHRpb25hbCB0YWJsZSB0aXRsZScsXHJcbiAgICAgICAgICAgICAgICBjc3ZPcHRpb25zOiAnQWRkaXRpb25hbCBDU1YgcGFyc2luZyBvcHRpb25zJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDc3ZDb252ZXJ0ZXI7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU07RUFBRUM7QUFBTSxDQUFDLEdBQUdELE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUMzQyxNQUFNRSxXQUFXLEdBQUdGLE9BQU8sQ0FBQyxt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